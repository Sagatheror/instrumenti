<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- Шрифты Google -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
<!-- Иконки Font Awesome 6 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Библиотеки -->
<script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
<style>
  :root {
    /* Светлая тема */
    --bg-primary: #f8fafc;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f1f5f9;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-tertiary: #94a3b8;
    --accent-primary: #3b82f6;
    --accent-secondary: #8b5cf6;
    --accent-success: #10b981;
    --accent-warning: #f59e0b;
    --accent-danger: #ef4444;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;
    --radius-xl: 24px;
    --transition-fast: 150ms;
    --transition-normal: 250ms;
    --transition-slow: 350ms;
  }

  .dark-theme {
    /* Тёмная тема */
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-tertiary: #94a3b8;
    --accent-primary: #60a5fa;
    --accent-secondary: #a78bfa;
    --accent-success: #34d399;
    --accent-warning: #fbbf24;
    --accent-danger: #f87171;
    --border-color: #475569;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
  }

  * {
    margin: 0;
  padding: 0;
  box-sizing: border-box;
  transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform, filter;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 500ms;
  }

  body {
    font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, 
    var(--bg-primary) 0%, 
    color-mix(in srgb, var(--bg-primary) 90%, var(--accent-primary) 10%) 100%);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.1s,
              color 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;
  position: relative;
  overflow-x: hidden;
  }
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(var(--accent-primary-rgb), 0.05) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(var(--accent-secondary-rgb), 0.05) 0%, transparent 20%),
    radial-gradient(circle at 50% 50%, rgba(var(--accent-warning-rgb), 0.03) 0%, transparent 30%);
  z-index: -1;
  pointer-events: none;
}
  /* Основной контейнер */
  .app-container {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 24px;
    padding: 24px;
    max-width: 1600px;
    margin: 0 auto;
    min-height: 100vh;
  }

  /* Боковая панель */
  .sidebar {
    background: linear-gradient(180deg, 
    var(--bg-secondary) 0%,
    color-mix(in srgb, var(--bg-secondary) 95%, var(--accent-primary) 5%) 100%);
    border-radius: var(--radius-xl);
    padding: 24px;
    box-shadow: var(--shadow-lg);
    height: fit-content;
    position: sticky;
    top: 24px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 32px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
  }

  .logo-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }

  .logo-text {
    font-size: 20px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .nav-section {
    margin-bottom: 28px;
  }

  .nav-title {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-tertiary);
    margin-bottom: 12px;
    font-weight: 600;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 1s cubic-bezier(0.34, 1.56, 0.64, 1);
    margin-bottom: 4px;
    cursor: pointer;
    border: 1px solid transparent;
    background: none;
    width: 100%;
    text-align: left;
    font-family: inherit;
    font-size: 14px;
  }

  .nav-item:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border-color: var(--accent-primary);
  transform: translateX(5px);
  box-shadow: 
    0 4px 12px rgba(59, 130, 246, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
  }

  .nav-item.active {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    box-shadow: var(--shadow-md);
    position: relative;
  overflow: hidden;
  }
.nav-item.active::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    45deg,
    transparent 30%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 70%
  );
  animation: shine 2s infinite linear;
}

@keyframes shine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}
  .nav-item i {
    width: 20px;
    font-size: 16px;
  }

  /* Основной контент */
  .main-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* Верхняя панель */
  .top-bar {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    padding: 20px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-lg);
    flex-wrap: wrap;
    gap: 16px;
  }

  .page-title {
    font-size: 24px;
    font-weight: 700;
  }

  .page-subtitle {
    font-size: 14px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  .actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  /* Карточки функций */
  .function-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
  }

  .card {
    background: linear-gradient(145deg, 
    var(--bg-secondary) 0%,
    color-mix(in srgb, var(--bg-secondary) 98%, var(--accent-primary) 2%) 100%);
    border-radius: var(--radius-xl);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 24px;
    box-shadow: var(--shadow-lg);
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;
  }
.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  transition: left 0.7s ease;
}
.dark-theme .card::before {
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.05),
    transparent
  );
}

.card:hover::before {
  left: 100%;
}
  .card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .card-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }

  .card-title {
    font-size: 18px;
    font-weight: 600;
  }

  .card-description {
    font-size: 14px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  /* Формы */
  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  .form-control {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: var(--text-primary);
    transition: all var(--transition-fast);
  }

  .form-control:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 40px;
  }

  .form-textarea {
    min-height: 100px;
    resize: vertical;
  }

  /* Кнопки */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    white-space: nowrap;
    position: relative;
  overflow: hidden;
  }
.btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.btn:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(20, 20);
    opacity: 0;
  }
}
  .btn-primary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    box-shadow: var(--shadow-md);
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }

  .btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    box-shadow: var(--shadow-md);
  }

  .btn-secondary:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }

  .btn-success {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    box-shadow: var(--shadow-md);
  }
 .btn-success:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }
  .btn-warning {
    background: var(--accent-warning);
    color: white;
    box-shadow: var(--shadow-md);
  }
  .btn-warning:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }
  .btn-danger {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    box-shadow: var(--shadow-md);
  }
.btn-danger:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }
  .btn-info {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    box-shadow: var(--shadow-md);
  }
.btn-info:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
  }
  .btn-sm {
    padding: 8px 12px;
    font-size: 13px;
  }

  .btn-icon {
    width: 40px;
    height: 40px;
    padding: 0;
    justify-content: center;
  }

  .btn-full {
    width: 100%;
  }

  /* Таблица */
  .table-container {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    margin-top: 24px;
  }

  .table-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-title {
    font-size: 18px;
    font-weight: 600;
  }

  .table-actions {
    display: flex;
    gap: 8px;
  }

  .table-wrapper {
    overflow-x: auto;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
    font-size: 13px;
  }

  .data-table th {
    background: var(--bg-tertiary);
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 16px 20px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
  }

  .data-table td {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    font-size: 14px;
  }

  .data-table tr:hover {
    background: var(--bg-tertiary);
  }

  .data-table .editable-cell {
    position: relative;
  }

  .data-table .editable-cell:focus {
    outline: 2px solid var(--accent-primary);
    border-radius: var(--radius-sm);
  }

  /* Переключатель темы */
  .theme-toggle {
    position: relative;
  width: 80px;
  height: 40px;
  display: inline-block;
  cursor: pointer;
  border-radius: 50px;
  overflow: hidden;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.1),
    inset 0 2px 4px rgba(255, 255, 255, 0.1);
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  transform-style: preserve-3d;
  perspective: 1000px;
  }
.theme-toggle:hover {
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.15),
    inset 0 2px 4px rgba(255, 255, 255, 0.2);
}
.theme-toggle:active {
  transform: translateY(0) scale(0.98);
}
  .theme-toggle input {
    opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
  }

  .theme-slider {
    position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, 
    #fbbf24 0%, 
    #f59e0b 25%, 
    #f97316 50%, 
    #ea580c 100%);
  border-radius: 50px;
  transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow: hidden;
  z-index: 1;
  }

  .theme-slider:before {
    position: absolute;
  content: "";
  height: 32px;
  width: 32px;
  left: 4px;
  bottom: 4px;
  background: linear-gradient(135deg, #ffffff, #fef3c7);
  border-radius: 50%;
  transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  color: #f59e0b;
  z-index: 3;
  box-shadow: 
    0 4px 12px rgba(251, 191, 36, 0.4),
    0 0 0 2px rgba(255, 255, 255, 0.8),
    inset 0 2px 4px rgba(255, 255, 255, 0.8);
  transform: rotate(0deg);
  animation: sunGlow 3s ease-in-out infinite;
  }
.theme-slider:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, 
    #4f46e5 0%, 
    #7c3aed 25%, 
    #9333ea 50%, 
    #a855f7 100%);
  border-radius: 50px;
  opacity: 0;
  transition: opacity 0.6s ease;
  z-index: 0;
}
.theme-slider .icon-container {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  pointer-events: none;
  z-index: 2;
}

.theme-slider .icon-container i {
  font-size: 16px;
  transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.theme-slider .icon-container .sun-icon {
  color: #ffffff;
  text-shadow: 0 0 10px rgba(251, 191, 36, 0.8);
  animation: sunPulse 2s ease-in-out infinite;
}

.theme-slider .icon-container .moon-icon {
  color: #fef3c7;
  text-shadow: 0 0 10px rgba(167, 139, 250, 0.8);
  animation: moonGlow 3s ease-in-out infinite;
}
  input:checked + .theme-slider {
  background: linear-gradient(135deg, 
    #4f46e5 0%, 
    #7c3aed 25%, 
    #9333ea 50%, 
    #a855f7 100%);
}

input:checked + .theme-slider:before {
  transform: translateX(40px) rotate(720deg);
  content: "\f186";
  color: #a78bfa;
  background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
  box-shadow: 
    0 4px 16px rgba(167, 139, 250, 0.5),
    0 0 0 3px rgba(255, 255, 255, 0.1),
    inset 0 2px 4px rgba(255, 255, 255, 0.3);
  animation: moonGlow 3s ease-in-out infinite;
}

input:checked + .theme-slider .sun-icon {
  opacity: 0.3;
  transform: scale(0.8);
}

input:checked + .theme-slider .moon-icon {
  opacity: 1;
  transform: scale(1.4) rotate(360deg);
  animation: moonPulse 2s ease-in-out infinite;
}
input:not(:checked) + .theme-slider {
  background: linear-gradient(135deg, 
    #fbbf24 0%, 
    #f59e0b 25%, 
    #f97316 50%, 
    #ea580c 100%);
}

input:not(:checked) + .theme-slider:before {
  transform: translateX(0) rotate(0deg);
  content: "\f185";
  color: #f59e0b;
  background: linear-gradient(135deg, #ffffff, #fef3c7);
  box-shadow: 
    0 4px 16px rgba(251, 191, 36, 0.5),
    0 0 0 3px rgba(255, 255, 255, 0.9),
    inset 0 2px 4px rgba(255, 255, 255, 0.9);
  animation: sunGlow 3s ease-in-out infinite;
}
input:not(:checked) + .theme-slider .sun-icon {
  opacity: 1;
  transform: scale(1.4) rotate(0deg);
  animation: sunPulse 2s ease-in-out infinite;
}

input:not(:checked) + .theme-slider .moon-icon {
  opacity: 0.3;
  transform: scale(0.8);
}
@keyframes sunGlow {
  0%, 100% {
    box-shadow: 
      0 4px 12px rgba(251, 191, 36, 0.4),
      0 0 0 2px rgba(255, 255, 255, 0.8),
      inset 0 2px 4px rgba(255, 255, 255, 0.8);
  }
  50% {
    box-shadow: 
      0 4px 20px rgba(251, 191, 36, 0.6),
      0 0 0 3px rgba(255, 255, 255, 0.9),
      inset 0 2px 4px rgba(255, 255, 255, 0.9);
  }
}

@keyframes moonGlow {
  0%, 100% {
    box-shadow: 
      0 4px 12px rgba(167, 139, 250, 0.4),
      0 0 0 2px rgba(255, 255, 255, 0.1),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
  }
  50% {
    box-shadow: 
      0 4px 20px rgba(167, 139, 250, 0.6),
      0 0 0 3px rgba(255, 255, 255, 0.2),
      inset 0 2px 4px rgba(255, 255, 255, 0.4);
  }
}
.stars {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50px;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.6s ease;
  z-index: 0;
}

.star {
  position: absolute;
  background: white;
  border-radius: 50%;
  opacity: 0;
}

input:checked + .theme-slider .stars {
  opacity: 1;
}
.dark-theme .theme-toggle {
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.3),
    inset 0 2px 4px rgba(255, 255, 255, 0.05),
    0 0 20px rgba(99, 102, 241, 0.3);
}
.theme-toggle::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(135deg, 
    #fbbf24, #f59e0b, #7c3aed, #4f46e5);
  border-radius: 52px;
  z-index: -1;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.theme-toggle:hover::before {
  opacity: 1;
  animation: borderRotate 3s linear infinite;
}

@keyframes borderRotate {
  0% { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(360deg); }
}
.particles {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50px;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 0;
}

.particle {
  position: absolute;
  background: white;
  border-radius: 50%;
  opacity: 0;
}

.theme-toggle:hover .particles {
  opacity: 0.3;
}
  /* Уведомления */
  .notification {
    position: fixed;
    top: 24px;
    right: 24px;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 16px 20px;
    box-shadow: var(--shadow-xl);
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateX(120%);
    transition: transform var(--transition-normal);
    z-index: 1000;
    border-left: 4px solid var(--accent-success);
  }

  .notification.show {
    transform: translateX(0);
  }

  .notification-icon {
    width: 24px;
    height: 24px;
    background: var(--accent-success);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
  }

  .notification-error {
    border-left-color: var(--accent-danger);
  }

  .notification-error .notification-icon {
    background: var(--accent-danger);
  }

  /* Модальные окна */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(4px);
  }

  .modal.show {
    display: flex;
  }

  .modal-content {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    padding: 32px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-xl);
  }

  .modal-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
  }

  .modal-title {
    font-size: 20px;
    font-weight: 600;
  }

  .modal-close {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    font-size: 40px;
    padding: 4px;
  }

  /* Спиннер */
  .spinner {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    z-index: 3000;
    backdrop-filter: blur(4px);
  }

  .spinner.show {
    display: flex;
  }

  .spinner-circle {
    width: 60px;
    height: 60px;
    border: 4px solid var(--border-color);
    border-top-color: var(--accent-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Адаптивность */
  @media (max-width: 1024px) {
    .app-container {
      grid-template-columns: 1fr;
    }
    
    .sidebar {
      position: static;
    }
    
    .actions {
      justify-content: center;
    }
  }

  @media (max-width: 768px) {
    .app-container {
      padding: 16px;
    }
    
    .function-cards {
      grid-template-columns: 1fr;
    }
    
    .top-bar {
      flex-direction: column;
      align-items: stretch;
    }
    
    .actions {
      justify-content: center;
    }
  }

  @media (max-width: 480px) {
    .actions {
      gap: 4px;
    }
    
    .btn {
      padding: 8px 12px;
      font-size: 13px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
    }
  }

  /* Стили для футера */
  .footer {
    text-align: center;
    padding: 20px;
    color: var(--text-secondary);
    font-size: 14px;
    margin-top: 40px;
    border-top: 1px solid var(--border-color);
  }

  /* Стили для changelog */
  .changelog-entry {
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 12px;
    border-left: 4px solid var(--accent-primary);
  }

  .changelog-version {
    font-weight: 600;
    font-size: 16px;
    color: var(--text-primary);
  }

  .changelog-date {
    font-size: 12px;
    color: var(--text-secondary);
    margin-left: 8px;
  }

  .changelog-type {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    margin-left: 8px;
    background: var(--accent-primary);
    color: white;
  }

  .changelog-type.added {
    background: var(--accent-success);
  }

  .changelog-type.fixed {
    background: var(--accent-warning);
  }

  .changelog-type.changed {
    background: var(--accent-secondary);
  }

  /* Стили для инструкции */
  .instruction-step {
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    padding: 20px;
    margin-bottom: 16px;
  }

  .step-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    border-radius: 50%;
    font-weight: 600;
    margin-right: 12px;
  }

  .step-title {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 8px;
  }

  .step-content {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  /* Стили для загрузки файла */
  .file-upload {
    border: 2px dashed var(--border-color);
    border-radius: var(--radius-lg);
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-normal);
  }

  .file-upload:hover {
    border-color: var(--accent-primary);
    background: var(--bg-tertiary);
  }

  .file-upload-icon {
    font-size: 48px;
    color: var(--accent-primary);
    margin-bottom: 16px;
  }

  .file-upload-text {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .file-upload-hint {
    font-size: 14px;
    color: var(--text-secondary);
  }

  /* Стили для статистики */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 24px;
  }

  .stat-card {
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    padding: 20px;
    text-align: center;
  }

  .stat-value {
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .stat-label {
    font-size: 14px;
    color: var(--text-secondary);
    margin-top: 4px;
  }

  /* ===== СТИЛИ ДЛЯ БАГ-РЕПОРТА (ИЗ ВТОРОГО КОДА) ===== */
  
  /* Стили для скроллинга в модальном окне баг-репорта */
  #bugModal .modal-content {
    max-width: 650px;
    max-height: 85vh;
    padding: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-xl);
    animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    flex-direction: column;
  }

  #bugModal .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
    max-height: calc(85vh - 80px);
  }

  #bugModal .modal-header {
    position: sticky;
    top: 0;
    padding: 1.5rem 2rem;
    margin-bottom: 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 10;
    flex-shrink: 0;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  }

  /* Стилизация скроллбара внутри модального окна */
  #bugModal .modal-body::-webkit-scrollbar {
    width: 8px;
  }

  #bugModal .modal-body::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 4px;
    margin: 4px 0;
  }

  #bugModal .modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--accent-primary), var(--accent-secondary));
    border-radius: 4px;
    border: 2px solid var(--bg-secondary);
  }

  #bugModal .modal-body::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(var(--accent-primary), var(--accent-secondary));
  }

  /* Улучшаем видимость при скролле */
  #bugModal .modal-body {
    scrollbar-width: thin;
    scrollbar-color: var(--accent-primary) var(--bg-tertiary);
  }

  /* Добавляем тень при скролле */
  #bugModal .modal-header {
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  #bugModal .modal-title {
    color: white;
    font-size: 1.75rem;
    font-weight: 700;
  }

  .bug-form-group {
    margin-bottom: 1.75rem;
  }

  .bug-form-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
  }

  .bug-form-label i {
    color: var(--accent-danger);
    font-size: 1.1rem;
  }

  /* Красивое текстовое поле */
  #bugDescription {
    width: 100%;
    min-height: 180px;
    max-height: 300px;
    padding: 1.5rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    resize: vertical;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  #bugDescription::-webkit-scrollbar {
    width: 6px;
  }

  #bugDescription::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 3px;
  }

  #bugDescription::-webkit-scrollbar-thumb {
    background: var(--accent-primary);
    border-radius: 3px;
  }

  #bugDescription:focus {
    outline: none;
    border-color: var(--accent-danger);
    box-shadow: 
      0 0 0 4px rgba(239, 68, 68, 0.1),
      inset 0 2px 4px rgba(0, 0, 0, 0.05);
    background: var(--bg-tertiary);
    transform: translateY(-1px);
  }

  /* Placeholder стилизация */
  #bugDescription::placeholder {
    color: var(--text-tertiary);
    font-style: italic;
    opacity: 0.7;
  }

  /* Счетчик символов */
  .char-counter {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-align: right;
    margin-top: 0.5rem;
  }

  .char-counter.warning {
    color: var(--accent-warning);
  }

  .char-counter.error {
    color: var(--accent-danger);
  }

  /* Анимация при фокусе */
  @keyframes pulse-border {
    0%, 100% { border-color: var(--border-color); }
    50% { border-color: var(--accent-primary); }
  }

  #bugDescription:focus {
    animation: pulse-border 2s infinite;
  }

  /* Стили для кнопок баг-репорта */
  .bug-form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
  }

  #sendBugBtn {
    background: linear-gradient(135deg, var(--accent-danger), #ff6b6b);
    color: white;
    padding: 0.875rem 2rem;
    font-weight: 600;
    font-size: 1rem;
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  #sendBugBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
  }

  #sendBugBtn:hover::before {
    left: 100%;
  }

  #sendBugBtn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #ff6b6b, var(--accent-danger));
  }

  #sendBugBtn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  #sendBugBtn:disabled:hover {
    box-shadow: none;
  }

  #checkStatusBtn {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    padding: 0.875rem 1.5rem;
    font-weight: 600;
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #checkStatusBtn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  #cancelBugBtn {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    padding: 0.875rem 1.5rem;
    font-weight: 600;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #cancelBugBtn:hover {
    background: var(--bg-primary);
    transform: translateY(-2px);
  }

  /* Стили для поля ввода имени */
  #userName {
    width: 100%;
    padding: 1rem 1.25rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  #userName:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 
        0 0 0 4px rgba(67, 97, 238, 0.1),
        inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
  }

  #userName::placeholder {
    color: var(--text-tertiary);
    font-style: italic;
  }

  .char-hint {
    font-size: 0.875rem;
    margin-top: 0.5rem;
    transition: color 0.3s ease;
  }

  .char-hint.text-gray-500 {
    color: var(--text-tertiary);
  }

  .char-hint.text-warning {
    color: var(--accent-warning);
    font-weight: 600;
  }

  .char-hint.text-success {
    color: var(--accent-success);
    font-weight: 600;
  }

  .char-counter-container {
    margin-top: 0.5rem;
  }

  /* Анимации */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Модальное окно для поиска Bug ID */
  #bugIdModal .modal-content {
    max-width: 500px;
    animation: slideUp 0.4s ease-out;
  }
/* Стили для скроллинга в модальном окне проверки Bug ID - такие же как в баг-репорте */
#bugIdModal .modal-content {
    max-width: 650px;
    max-height: 85vh;
    padding: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-xl);
    animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    flex-direction: column;
}

#bugIdModal .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
    max-height: calc(85vh - 80px);
}

#bugIdModal .modal-header {
    position: sticky;
    top: 0;
    padding: 1.5rem 2rem;
    margin-bottom: 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 10;
    flex-shrink: 0;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
}

/* Стилизация скроллбара внутри модального окна проверки Bug ID */
#bugIdModal .modal-body::-webkit-scrollbar {
    width: 8px;
}

#bugIdModal .modal-body::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 4px;
    margin: 4px 0;
}

#bugIdModal .modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--accent-primary), var(--accent-secondary));
    border-radius: 4px;
    border: 2px solid var(--bg-secondary);
}

#bugIdModal .modal-body::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(var(--accent-primary), var(--accent-secondary));
}

/* Улучшаем видимость при скролле */
#bugIdModal .modal-body {
    scrollbar-width: thin;
    scrollbar-color: var(--accent-primary) var(--bg-tertiary);
}

/* Добавляем тень при скролле */
#bugIdModal .modal-header {
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

#bugIdModal .modal-title {
    color: white;
    font-size: 1.75rem;
    font-weight: 700;
}

/* Специфичные стили для содержимого внутри #bugIdModal */
#bugIdModal .bug-id-input-group {
    position: relative;
    margin-bottom: 1.5rem;
}

#bugIdModal .bug-id-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-size: 1.2rem;
}

#bugIdModal #bugIdInput {
    width: 100%;
    padding: 1.25rem 1.5rem 1.25rem 3rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.1rem;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    letter-spacing: 0.5px;
}

#bugIdModal #bugIdInput:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 
        0 0 0 4px rgba(67, 97, 238, 0.1),
        inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
}

/* Список последних Bug ID */
#bugIdModal #recentBugIds {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
    padding: 0.75rem;
    margin-bottom: 1.5rem;
}

/* Стилизация скроллбара для списка Bug ID */
#bugIdModal #recentBugIds::-webkit-scrollbar {
    width: 6px;
}

#bugIdModal #recentBugIds::-webkit-scrollbar-track {
    background: var(--bg-primary);
    border-radius: 3px;
}

#bugIdModal #recentBugIds::-webkit-scrollbar-thumb {
    background: var(--accent-primary);
    border-radius: 3px;
}

#bugIdModal #recentBugIds::-webkit-scrollbar-thumb:hover {
    background: var(--accent-secondary);
}

#bugIdModal .recent-bugs-section {
    margin-bottom: 1.5rem;
}

#bugIdModal .recent-bugs-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
}

/* Кнопки в модальном окне проверки Bug ID */
#bugIdModal .bug-id-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

#bugIdModal #searchBugId {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    padding: 0.875rem 2rem;
    font-weight: 600;
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
}

#bugIdModal #searchBugId:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

#bugIdModal #closeBugIdModalBtn {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    padding: 0.875rem 1.5rem;
    font-weight: 600;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
}

#bugIdModal #closeBugIdModalBtn:hover {
    background: var(--bg-primary);
    transform: translateY(-2px);
}

/* Результаты поиска */
#bugIdModal #bugStatusResult {
    margin-bottom: 1.5rem;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
}
  .bug-id-input-group {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .bug-id-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--accent-primary);
    font-size: 1.2rem;
  }

  #bugIdInput {
    width: 100%;
    padding: 1.25rem 1.5rem 1.25rem 3rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.1rem;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    letter-spacing: 0.5px;
  }

  #bugIdInput:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 
      0 0 0 4px rgba(67, 97, 238, 0.1),
      inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transform: translateY(-1px);
  }

  /* Список последних Bug ID */
  #recentBugIds {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
    padding: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .recent-bugs-section {
    margin-bottom: 1.5rem;
  }

  .recent-bugs-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
  }

  /* Элементы истории */
  .bug-history-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.875rem 1rem;
    margin-bottom: 0.5rem;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .bug-history-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: linear-gradient(var(--accent-primary), var(--accent-secondary));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .bug-history-item:hover::before {
    opacity: 1;
  }

  .bug-history-item:hover {
    transform: translateX(5px);
    box-shadow: var(--shadow-md);
    border-color: var(--accent-primary);
  }

  .bug-history-item:active {
    transform: translateX(5px) scale(0.98);
  }

  .bug-history-id {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    color: var(--accent-primary);
    font-size: 0.95rem;
  }

  .bug-history-date {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    margin-top: 0.25rem;
  }

  .bug-history-user {
    font-size: 0.75rem;
    color: var(--text-tertiary);
  }

  .bug-history-arrow {
    color: var(--text-tertiary);
    font-size: 0.875rem;
    transition: transform 0.3s ease;
  }

  .bug-history-item:hover .bug-history-arrow {
    transform: translateX(3px);
    color: var(--accent-primary);
  }

  /* Результаты поиска - ИСПРАВЛЕННЫЙ СТИЛЬ */
  #bugStatusResult {
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-primary));
    border-left: 4px solid var(--accent-primary);
    animation: slideUp 0.4s ease;
    margin-bottom: 1.5rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
    box-sizing: border-box;
  }

  #bugStatusResult .status-success,
  #bugStatusResult .status-error {
    width: 100%;
    overflow: hidden;
  }

  /* Анимация поиска */
  @keyframes searching {
    0% { transform: translateX(-10px); opacity: 0.5; }
    100% { transform: translateX(10px); opacity: 1; }
  }

  .searching {
    animation: searching 0.5s ease-in-out infinite alternate;
  }

  /* Кнопки модального окна */
  .bug-id-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
  }

  #searchBugId {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    padding: 0.875rem 2rem;
    font-weight: 600;
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #searchBugId:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  #searchBugId:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  #closeBugIdModalBtn {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    padding: 0.875rem 1.5rem;
    font-weight: 600;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #closeBugIdModalBtn:hover {
    background: var(--bg-primary);
    transform: translateY(-2px);
  }

  /* Индикатор поиска */
  .searching-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    text-align: center;
  }

  .searching-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid var(--border-color);
    border-top-color: var(--accent-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
  }

  .searching-text {
    color: var(--text-tertiary);
    font-size: 0.95rem;
    word-break: break-all;
  }

  /* Стили для улучшенного changelog */
  #changelogModal .modal-content {
    max-width: 800px;
    max-height: 85vh;
    padding: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-primary));
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-xl);
  }

  #changelogModal .modal-header {
    background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
    padding: 1.75rem 2.5rem;
    margin-bottom: 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  #changelogModal .modal-title {
    color: white;
    font-size: 1.75rem;
    font-weight: 700;
  }

  #changelogModal .modal-title i {
    font-size: 1.5rem;
    background: rgba(255, 255, 255, 0.25);
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
  }

  #changelogContent {
    max-height: calc(85vh - 100px);
    overflow-y: auto;
    padding: 2rem;
  }

  /* Стили для улучшенной инструкции */
  #instructionModal .modal-content {
    max-width: 800px;
    max-height: 85vh;
    padding: 0;
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-primary));
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-xl);
  }

  #instructionModal .modal-header {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    padding: 1.75rem 2.5rem;
    margin-bottom: 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  #instructionModal .modal-title {
    color: white;
    font-size: 1.75rem;
    font-weight: 700;
  }

  #instructionModal .modal-title i {
    font-size: 1.5rem;
    background: rgba(255, 255, 255, 0.25);
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
  }

  #instructionContent {
    max-height: calc(85vh - 100px);
    overflow-y: auto;
    padding: 2rem;
  }

  /* Стили для снега */
  .snow-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9997;
    overflow: hidden;
  }

  .snowflake {
    position: absolute;
    background: white;
    border-radius: 50%;
    opacity: 0.9;
    filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5));
  }

  /* Анимации для снега */
  @keyframes snowFall {
    0% {
      transform: translateY(-10px) translateX(0);
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) translateX(20px);
      opacity: 0;
    }
  }

  @keyframes snowSway {
    0%, 100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(15px);
    }
  }
  .theme-transition-active {
  animation: themePulse 0.5s ease;
}

@keyframes themePulse {
  0% { opacity: 0.95; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}
.page-transition {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bg-primary);
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}
sidebar, .top-bar, .card, .table-container, .nav-item, .btn, .modal-content {
  transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s,
              border-color 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s,
              box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s,
              transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
}
@keyframes waveExpand {
  0% {
    width: 0;
    height: 0;
    opacity: 1;
    filter: blur(0px);
  }
  50% {
    opacity: 0.6;
    filter: blur(2px);
  }
  100% {
    width: 200vmax;
    height: 200vmax;
    opacity: 0;
    filter: blur(4px);
  }
}

/* Эффект мерцания звезд для темной темы */
@keyframes starTwinkle {
  0%, 100% {
    opacity: 0.3;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}
.theme-text-transition {
  background: linear-gradient(90deg, 
    var(--accent-warning), 
    var(--accent-primary), 
    var(--accent-secondary));
  background-size: 200% 200%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: gradientShift 2s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.theme-transition-active .sidebar,
.theme-transition-active .top-bar,
.theme-transition-active .card {
  animation: themePulse 1.2s ease;
}

/* Эффект свечения для иконок в темной теме */
.dark-theme .nav-item.active i,
.dark-theme .btn-primary i {
  filter: drop-shadow(0 0 3px rgba(96, 165, 250, 0.5));
  animation: iconGlow 3s ease-in-out infinite;
}

@keyframes iconGlow {
  0%, 100% {
    filter: drop-shadow(0 0 3px rgba(96, 165, 250, 0.5));
  }
  50% {
    filter: drop-shadow(0 0 6px rgba(96, 165, 250, 0.8));
  }
}
/* Весенняя тема */
.spring-theme {
  --accent-primary: #10b981;
  --accent-secondary: #34d399;
  --accent-warning: #f59e0b;
  --border-color: #a7f3d0;
}

/* Для светлой темы - яркие весенние цвета */
.spring-theme:not(.dark-theme) .sidebar {
  background: linear-gradient(135deg, #f0fdf4, #dcfce7);
}

.spring-theme:not(.dark-theme) .top-bar {
  background: linear-gradient(135deg, #f0fdf4, #dcfce7);
}

.spring-theme:not(.dark-theme) .card {
  background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
  border: 1px solid #a7f3d0;
}

.spring-theme:not(.dark-theme) .nav-item.active {
  background: linear-gradient(135deg, #10b981, #34d399);
}

.spring-theme:not(.dark-theme) .btn-primary {
  background: linear-gradient(135deg, #10b981, #34d399);
  color: white;
}

/* Для темной темы - более темные, но все еще весенние цвета */
.spring-theme.dark-theme .sidebar {
  background: linear-gradient(135deg, #064e3b, #047857);
}

.spring-theme.dark-theme .top-bar {
  background: linear-gradient(135deg, #064e3b, #047857);
}

.spring-theme.dark-theme .card {
  background: linear-gradient(135deg, #065f46, #059669);
  border: 1px solid #10b981;
}

.spring-theme.dark-theme .nav-item.active {
  background: linear-gradient(135deg, #10b981, #34d399);
}

.spring-theme.dark-theme .btn-primary {
  background: linear-gradient(135deg, #10b981, #34d399);
  color: white;
}

/* Облака для темной темы */
.dark-theme .spring-cloud {
  background: rgba(240, 253, 244, 0.9); /* Более светлые облака в темной теме */
  box-shadow: 
    0 0 20px rgba(240, 253, 244, 0.3),
    inset 0 0 20px rgba(255, 255, 255, 0.2);
}

/* Подснежники для темной темы */
.dark-theme .spring-snowdrop:before {
  background: linear-gradient(to bottom, #10b981, #047857);
}

.dark-theme .spring-snowdrop:after {
  background: radial-gradient(circle at 30% 30%, #fef3c7, #f59e0b);
  box-shadow: 0 0 5px rgba(254, 243, 199, 0.7);
}

/* Текст для темной темы с весенним оформлением */
.spring-theme.dark-theme .card-title,
.spring-theme.dark-theme .card-description,
.spring-theme.dark-theme .form-label,
.spring-theme.dark-theme .page-title,
.spring-theme.dark-theme .page-subtitle,
.spring-theme.dark-theme .nav-title,
.spring-theme.dark-theme .nav-item:not(.active),
.spring-theme.dark-theme .table-title,
.spring-theme.dark-theme .footer {
  color: #f0fdf4 !important; /* Светло-зеленый текст для лучшей читаемости */
}

.spring-theme.dark-theme .form-control,
.spring-theme.dark-theme .form-select,
.spring-theme.dark-theme #bugDescription,
.spring-theme.dark-theme #userName,
.spring-theme.dark-theme #bugIdInput {
  background: #022c22 !important; /* Темно-зеленый фон для полей ввода */
  color: #f0fdf4 !important;
  border-color: #10b981 !important;
}

.spring-theme.dark-theme .file-upload {
  border-color: #10b981 !important;
  background: #065f46 !important;
}

.spring-theme.dark-theme .file-upload:hover {
  background: #047857 !important;
}

.spring-theme.dark-theme .stat-card {
  background: #064e3b !important;
}

.spring-theme.dark-theme .btn-secondary,
.spring-theme.dark-theme .btn-info,
.spring-theme.dark-theme .btn-success:not(.spring-theme .btn-success),
.spring-theme.dark-theme .btn-danger {
  background: #065f46 !important;
  color: #f0fdf4 !important;
  border-color: #10b981 !important;
}

.spring-theme.dark-theme .btn-secondary:hover,
.spring-theme.dark-theme .btn-info:hover,
.spring-theme.dark-theme .btn-success:not(.spring-theme .btn-success):hover,
.spring-theme.dark-theme .btn-danger:hover {
  background: #047857 !important;
}

/* Модальные окна для темной темы с весенним оформлением */
.spring-theme.dark-theme .modal-content {
  background: linear-gradient(135deg, #064e3b, #047857) !important;
  border-color: #10b981 !important;
}

.spring-theme.dark-theme .modal-header {
  background: linear-gradient(135deg, #10b981, #34d399) !important;
}

/* Таблица для темной темы с весенним оформлением */
.spring-theme.dark-theme .table-container {
  background: linear-gradient(135deg, #064e3b, #047857) !important;
  border-color: #10b981 !important;
}

.spring-theme.dark-theme .data-table th {
  background: #065f46 !important;
  color: #f0fdf4 !important;
}

.spring-theme.dark-theme .data-table td {
  background: #022c22 !important;
  color: #f0fdf4 !important;
  border-color: #10b981 !important;
}

.spring-theme.dark-theme .data-table tr:hover {
  background: #064e3b !important;
}

/* Уведомления для темной темы с весенним оформлением */
.spring-theme.dark-theme .notification {
  background: #065f46 !important;
  border-left-color: #10b981 !important;
  color: #f0fdf4 !important;
}

/* Чанжлог и инструкции для темной темы */
.spring-theme.dark-theme #changelogContent,
.spring-theme.dark-theme #instructionContent {
  background: #022c22 !important;
  color: #f0fdf4 !important;
}

.spring-theme.dark-theme .changelog-entry,
.spring-theme.dark-theme .instruction-step {
  background: #064e3b !important;
  border-color: #10b981 !important;
}

/* Спиннер для темной темы с весенним оформлением */
.spring-theme.dark-theme .spinner-circle {
  border-color: #065f46 !important;
  border-top-color: #10b981 !important;
}
.spring-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9996;
  overflow: hidden;
}
.spring-cloud {
  position: fixed;
  width: 120px;
  height: 40px;
  background: white;
  border-radius: 50px;
  opacity: 0.8;
  filter: blur(1px);
  z-index: 9995;
  pointer-events: none;
  box-shadow: 
    0 0 20px rgba(255, 255, 255, 0.5),
    inset 0 0 20px rgba(255, 255, 255, 0.3);
  transition: opacity 2s ease;
}

.spring-cloud:before,
.spring-cloud:after {
  content: '';
  position: absolute;
  border-radius: 50%;
  background: inherit;
  box-shadow: inherit;
}

.spring-cloud:before {
  width: 50px;
  height: 50px;
  top: -20px;
  left: 15px;
}

.spring-cloud:after {
  width: 40px;
  height: 40px;
  top: -15px;
  right: 20px;
}
.spring-cloud.large:before {
  width: 70px;
  height: 70px;
  top: -30px;
  left: 10px;
}

.spring-cloud.large:after {
  width: 60px;
  height: 60px;
  top: -25px;
  right: 15px;
}

.spring-cloud.large::before {
  content: '';
  position: absolute;
  width: 50px;
  height: 50px;
  background: inherit;
  border-radius: 50%;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
}
</style>
</head>
<body>
  <!-- Уведомления -->
  <div id="notification" class="notification">
    <div class="notification-icon">
      <i class="fas fa-check"></i>
    </div>
    <span id="notification-message"></span>
  </div>

  <!-- Спиннер -->
  <div id="spinner" class="spinner">
    <div class="spinner-circle"></div>
  </div>

  <!-- Модальное окно баг-репорта -->
  <div id="bugModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="card-icon">
          <i class="fas fa-bug"></i>
        </div>
        <h3 class="modal-title">Сообщить о проблеме</h3>
        <button class="modal-close" id="closeBugModal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Новое поле для ввода имени -->
        <div class="bug-form-group">
          <label class="bug-form-label">
            <i class="fas fa-user"></i>
            <span>Ваше имя</span>
          </label>
          <input type="text" 
                 id="userName" 
                 class="form-control"
                 placeholder="Введите ваше имя"
                 maxlength="50">
          <div class="char-hint text-gray-500" id="nameCharCounter">0/50 символов</div>
        </div>
        
        <div class="bug-form-group">
          <label class="bug-form-label">
            <i class="fas fa-exclamation-circle"></i>
            <span>Опишите проблему или предложение</span>
          </label>
          <textarea id="bugDescription" 
                    rows="6" 
                    placeholder="Опишите подробно проблему или ваше предложение. Чем больше деталей, тем быстрее мы сможем помочь!"></textarea>
          <div class="char-counter-container">
            <div class="char-hint text-gray-500" id="descCharCounter">0 символов (минимум 10)</div>
          </div>
        </div>
        
        <div class="bug-form-actions">
          <button class="btn btn-secondary" id="checkStatusBtn">
            <i class="fas fa-search"></i>
            <span>Проверить статус</span>
          </button>
          <button class="btn btn-secondary" id="cancelBugBtn">
            <i class="fas fa-times"></i>
            <span>Отмена</span>
          </button>
          <button class="btn btn-primary" id="sendBugBtn" disabled>
            <i class="fas fa-paper-plane"></i>
            <span>Отправить отчет</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Модальное окно инструкции -->
  <div id="instructionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="card-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <h3 class="modal-title">Инструкция по работе</h3>
        <button class="modal-close" id="closeInstructionModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="instructionContent">
        <!-- Контент инструкции будет загружен динамически -->
      </div>
    </div>
  </div>

  <!-- Модальное окно changelog -->
  <div id="changelogModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="card-icon">
          <i class="fas fa-history"></i>
        </div>
        <h3 class="modal-title">История изменений</h3>
        <button class="modal-close" id="closeChangelogModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="changelogContent">
        <!-- Контент changelog будет загружен динамически -->
      </div>
    </div>
  </div>

  <!-- Модальное окно для поиска Bug ID -->
  <div class="modal" id="bugIdModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-search"></i>
          <span>Проверка статуса Bug ID</span>
        </h2>
        <button class="modal-close" id="closeBugIdModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="bug-id-input-group">
          <i class="fas fa-bug bug-id-icon"></i>
          <input type="text" 
                 id="bugIdInput" 
                 placeholder="Введите Bug ID (например: BUG-123456789)"
                 class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20">
        </div>
        
        <div class="recent-bugs-section">
          <div class="recent-bugs-title">
            <i class="fas fa-history"></i>
            <span>Недавние Bug ID</span>
          </div>
          <div id="recentBugIds">
            <!-- История будет загружена динамически -->
          </div>
        </div>
        
        <div id="bugStatusResult">
          <!-- Результаты поиска будут отображаться здесь -->
        </div>
        
        <div class="bug-id-actions">
          <button class="btn btn-primary" id="searchBugId">
            <i class="fas fa-search"></i>
            <span>Найти статус</span>
          </button>
          <button class="btn btn-secondary" id="closeBugIdModalBtn">
            <i class="fas fa-times"></i>
            <span>Закрыть</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Основной контейнер -->
  <div class="app-container">
    <!-- Боковая панель -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-table"></i>
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-title">Основное</div>
        <button class="nav-item active" onclick="showSection('file-section')">
          <i class="fas fa-file-csv"></i>
          Файл
        </button>
        <button class="nav-item" onclick="showSection('edit-section')">
          <i class="fas fa-edit"></i>
          Редактирование
        </button>
        <button class="nav-item" onclick="showSection('search-section')">
          <i class="fas fa-search"></i>
          Поиск
        </button>
      </div>

      <div class="nav-section">
        <div class="nav-title">Инструменты</div>
        <button class="nav-item" onclick="showSection('insert-section')">
          <i class="fas fa-plus-circle"></i>
          Вставка
        </button>
        <button class="nav-item" onclick="showSection('stats-section')">
          <i class="fas fa-chart-bar"></i>
          Статистика
        </button>
      </div>

     <div class="nav-section">
  <div class="nav-title">Настройки</div>
  <div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px;">
    <i class="fas fa-palette"></i>
    <span style="flex: 1; color: var(--text-secondary);">Тема</span>
    <label class="theme-toggle" id="themeToggleContainer">
      <input type="checkbox" id="themeToggle">
      <span class="theme-slider">
        <div class="icon-container">
          <i class="fas fa-sun sun-icon"></i>
          <i class="fas fa-moon moon-icon"></i>
        </div>
        <div class="stars" id="starsContainer"></div>
        <div class="particles" id="particlesContainer"></div>
      </span>
    </label>
  </div>
</div>

      <div style="margin-top: 32px;">
        <button class="btn btn-primary btn-full" onclick="saveChanges()">
          <i class="fas fa-save"></i>
          Сохранить изменения
        </button>
      </div>
    </aside>

    <!-- Основной контент -->
    <main class="main-content">
      <!-- Верхняя панель -->
      <header class="top-bar">
        <div>
          <h1 class="page-title" id="currentSectionTitle">Загрузка файла</h1>
          <p class="page-subtitle" id="currentSectionDescription">Загрузите CSV-файл для начала работы</p>
        </div>
        <div class="actions">
          <!-- Кнопка инструкции -->
          <button class="btn btn-info btn-sm" id="instructionBtn" title="Инструкция">
            <i class="fas fa-question-circle"></i>
            <span class="btn-text">Помощь</span>
          </button>
          
          <!-- Кнопка changelog -->
          <button class="btn btn-secondary btn-sm" id="changelogBtn" title="История изменений">
            <i class="fas fa-history"></i>
            <span class="btn-text">Changelog</span>
          </button>
          
          <!-- Кнопка баг-репорта -->
          <button class="btn btn-danger btn-sm" id="bugReportBtn" title="Сообщить о проблеме">
            <i class="fas fa-bug"></i>
            <span class="btn-text">Баг</span>
          </button>
          
          <!-- Кнопка снега -->
          <button class="btn btn-warning btn-sm" id="snowToggleBtn" title="Включить/выключить снег">
            <i class="fas fa-snowflake"></i>
            <span class="btn-text" id="snowText">Снег</span>
          </button>
          <button class="btn btn-success btn-sm" id="springToggleBtn" title="Включить/выключить весеннее оформление">
  <i class="fas fa-seedling"></i>
  <span class="btn-text" id="springText">Весна</span>
</button>
          <!-- Кнопка переключения интерфейса -->
          <button class="btn btn-secondary btn-sm" id="interfaceToggleBtn" title="Переключить интерфейс">
            <i class="fas fa-exchange-alt"></i>
            <span class="btn-text" id="interfaceText">Сменить интерфейс</span>
          </button>
        </div>
      </header>

      <!-- Секция файла -->
      <section id="file-section" class="function-cards">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-columns"></i>
            </div>
            <div>
              <h3 class="card-title">Выбор колонки</h3>
              <p class="card-description">Выберите колонку для работы с данными</p>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Колонка для редактирования</label>
            <select id="columnSelect" class="form-control form-select">
              <option value="15">Details - Основное описание</option>
              <option value="16">Description - Расширенное описание</option>
            </select>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-upload"></i>
            </div>
            <div>
              <h3 class="card-title">Загрузка файла</h3>
              <p class="card-description">Загрузите CSV-файл для работы</p>
            </div>
          </div>
          <div class="file-upload" onclick="document.getElementById('fileInput').click()">
            <div class="file-upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="file-upload-text">Нажмите для загрузки файла</div>
            <div class="file-upload-hint">или перетащите файл сюда</div>
          </div>
          <input type="file" id="fileInput" accept=".csv" style="display: none;">
        </div>
      </section>

      <!-- Секция редактирования -->
      <section id="edit-section" class="function-cards" style="display: none;">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-exchange-alt"></i>
            </div>
            <div>
              <h3 class="card-title">Замена содержимого</h3>
              <p class="card-description">Найдите и замените текст или HTML</p>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Режим замены</label>
            <select id="modeSelect" class="form-control form-select">
              <option value="html">Заменить HTML</option>
              <option value="text">Заменить текст</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Искомое значение</label>
            <input type="text" id="searchHtml" class="form-control" placeholder="Введите текст для поиска...">
          </div>
          <div class="form-group">
            <label class="form-label">Новое значение</label>
            <input type="text" id="replaceHtml" class="form-control" placeholder="Введите текст для замены...">
          </div>
          <button class="btn btn-primary btn-full" onclick="replaceContent()">
            <i class="fas fa-sync-alt"></i>
            Выполнить замену
          </button>
        </div>
      </section>

      <!-- Секция поиска -->
      <section id="search-section" class="function-cards" style="display: none;">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-search"></i>
            </div>
            <div>
              <h3 class="card-title">Поиск по кодам 1С</h3>
              <p class="card-description">Фильтрация данных по кодам 1С</p>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Коды 1С для поиска</label>
            <input type="text" id="codesSearch" class="form-control" placeholder="Введите коды через запятую или пробел...">
          </div>
          <button class="btn btn-primary btn-full" onclick="searchCodes()">
            <i class="fas fa-search"></i>
            Найти
          </button>
          <button class="btn btn-secondary btn-full" onclick="clearSearch()" style="margin-top: 8px;">
            <i class="fas fa-times"></i>
            Сбросить фильтр
          </button>
        </div>
      </section>

      <!-- Секция вставки -->
      <section id="insert-section" class="function-cards" style="display: none;">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-plus"></i>
            </div>
            <div>
              <h3 class="card-title">Добавление текста</h3>
              <p class="card-description">Добавьте текст или HTML в ячейки</p>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Текст для вставки</label>
            <input type="text" id="insertText" class="form-control" placeholder="Введите текст для добавления...">
          </div>
          <div class="form-group">
            <label class="form-label">Тип содержимого</label>
            <select id="insertType" class="form-control form-select">
              <option value="text">Текст</option>
              <option value="html">HTML</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Позиция вставки</label>
            <select id="insertPosition" class="form-control form-select">
              <option value="start">В начало</option>
              <option value="end">В конец</option>
            </select>
          </div>
          <button class="btn btn-primary btn-full" onclick="insertContent()">
            <i class="fas fa-plus-circle"></i>
            Добавить
          </button>
        </div>
      </section>

      <!-- Секция статистики -->
      <section id="stats-section" class="function-cards" style="display: none;">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-chart-pie"></i>
            </div>
            <div>
              <h3 class="card-title">Статистика данных</h3>
              <p class="card-description">Общая информация о загруженных данных</p>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="statTotalRows">0</div>
              <div class="stat-label">Всего строк</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statVisibleRows">0</div>
              <div class="stat-label">Отображается</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statEditedRows">0</div>
              <div class="stat-label">Изменено</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="statFileSize">0 KB</div>
              <div class="stat-label">Размер файла</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Таблица данных -->
      <div class="table-container" id="tableContainer" style="display: none;">
        <div class="table-header">
          <h3 class="table-title">Предпросмотр данных</h3>
          <div class="table-actions">
            <button class="btn btn-sm btn-secondary" onclick="exportTableToCSV()">
              <i class="fas fa-download"></i>
              Экспорт
            </button>
            <button class="btn btn-sm btn-secondary" onclick="refreshTable()">
              <i class="fas fa-redo"></i>
              Обновить
            </button>
          </div>
        </div>
        <div class="table-wrapper">
          <table class="data-table" id="dataTable">
            <thead>
              <tr>
                <th>Код 1С</th>
                <th>Описание</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Данные будут вставлены сюда -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Футер -->
      <footer class="footer">
        <p>Создатель: EmPsOn &copy; 2025</p>
      </footer>
    </main>
  </div>

  <!-- Контейнер для снега -->
  <div class="snow-container" id="snowContainer"></div>
<div class="spring-container" id="springContainer"></div>
  <script>
    // Глобальные переменные
    let csvData = [];
    let headers = [];
    let selectedColumnIndex = 15;
    let editedRows = new Set();
    let snowActive = false;
    let snowInterval = null;
    let bugIdHistory = [];

    // Инициализация при загрузке
    document.addEventListener('DOMContentLoaded', function() {
      updateSpringButton();
      // Настройка переключателя темы
      const themeToggle = document.getElementById('themeToggle');
const themeToggleContainer = document.getElementById('themeToggleContainer');
const starsContainer = document.getElementById('starsContainer');
const particlesContainer = document.getElementById('particlesContainer');
const savedTheme = localStorage.getItem('theme');
function createStars() {
  starsContainer.innerHTML = '';
  const isDark = document.body.classList.contains('dark-theme');
  
  for (let i = 0; i < 20; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    
    // Разные типы звезд
    const starType = Math.random();
    let size, opacity, animationDelay;
    
    if (starType < 0.3) {
      // Большие яркие звезды
      size = Math.random() * 3 + 2;
      opacity = Math.random() * 0.7 + 0.3;
      animationDelay = Math.random() * 2;
    } else if (starType < 0.7) {
      // Средние звезды
      size = Math.random() * 2 + 1;
      opacity = Math.random() * 0.5 + 0.2;
      animationDelay = Math.random() * 3;
    } else {
      // Мелкие тусклые звезды
      size = Math.random() * 1 + 0.5;
      opacity = Math.random() * 0.3 + 0.1;
      animationDelay = Math.random() * 4;
    }
    
    star.style.cssText = `
      width: ${size}px;
      height: ${size}px;
      left: ${Math.random() * 100}%;
      top: ${Math.random() * 100}%;
      opacity: ${opacity};
      background: ${isDark ? '#ffffff' : '#fef3c7'};
      box-shadow: ${isDark ? '0 0 4px rgba(255, 255, 255, 0.5)' : '0 0 4px rgba(251, 191, 36, 0.5)'};
      animation: starTwinkle ${Math.random() * 4 + 2}s ease-in-out infinite ${animationDelay}s;
    `;
    
    starsContainer.appendChild(star);
  }
}

// Создаем частицы для эффекта при наведении
function createParticles() {
  particlesContainer.innerHTML = '';
  for (let i = 0; i < 8; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.cssText = `
      width: ${Math.random() * 3 + 1}px;
      height: ${Math.random() * 3 + 1}px;
      left: ${Math.random() * 100}%;
      top: ${Math.random() * 100}%;
      background: ${i % 2 === 0 ? '#fbbf24' : '#7c3aed'};
      opacity: ${Math.random() * 0.4 + 0.1};
    `;
    particlesContainer.appendChild(particle);
  }
}
// Функция для плавного переключения темы
function toggleThemeWithAnimation(isDark) {
  // Создаем эффект морфинга для текста
  const pageTitle = document.querySelector('.page-title');
  const pageSubtitle = document.querySelector('.page-subtitle');
  const originalTitle = pageTitle.textContent;
  const originalSubtitle = pageSubtitle.textContent;
  
  // Временно меняем текст для эффекта
  pageTitle.classList.add('theme-text-transition');
  pageSubtitle.classList.add('theme-text-transition');
  
  // Создаем волновой эффект из центра переключателя
  const toggleRect = themeToggleContainer.getBoundingClientRect();
  const centerX = toggleRect.left + toggleRect.width / 2;
  const centerY = toggleRect.top + toggleRect.height / 2;
  
  const wave = document.createElement('div');
  wave.style.cssText = `
    position: fixed;
    top: ${centerY}px;
    left: ${centerX}px;
    width: 0;
    height: 0;
    background: radial-gradient(circle, 
      ${isDark ? 'rgba(79, 70, 229, 0.4)' : 'rgba(251, 191, 36, 0.4)'}, 
      transparent 70%);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 9998;
    pointer-events: none;
    animation: waveExpand 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  `;
  
  document.body.appendChild(wave);
  
  // Создаем частицы для эффекта перехода
  createTransitionParticles(isDark, centerX, centerY);
  
  // Добавляем класс для общей анимации перехода
  document.body.classList.add('theme-transition-active');
  
  // Меняем тему с небольшой задержкой для синхронизации
  setTimeout(() => {
    if (isDark) {
      document.body.classList.add('dark-theme');
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.classList.remove('dark-theme');
      localStorage.setItem('theme', 'light');
    }
    
    // Обновляем звездочки
    createStars();
  }, 300);
  
  // Убираем эффекты после завершения
  setTimeout(() => {
    wave.remove();
    pageTitle.classList.remove('theme-text-transition');
    pageSubtitle.classList.remove('theme-text-transition');
    document.body.classList.remove('theme-transition-active');
  }, 1200);
}

function createTransitionParticles(isDark, centerX, centerY) {
  const particleCount = 20;
  const colors = isDark 
    ? ['#7c3aed', '#4f46e5', '#6366f1', '#8b5cf6']
    : ['#fbbf24', '#f59e0b', '#f97316', '#ea580c'];
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    const angle = (i / particleCount) * Math.PI * 2;
    const distance = 60 + Math.random() * 40;
    const size = Math.random() * 4 + 2;
    const color = colors[Math.floor(Math.random() * colors.length)];
    const duration = 800 + Math.random() * 400;
    
    particle.style.cssText = `
      position: fixed;
      width: ${size}px;
      height: ${size}px;
      background: ${color};
      border-radius: 50%;
      left: ${centerX}px;
      top: ${centerY}px;
      z-index: 9997;
      pointer-events: none;
      box-shadow: 0 0 8px ${color};
      opacity: 0.8;
    `;
    
    document.body.appendChild(particle);
    
    // Анимация частицы
    particle.animate([
      {
        transform: 'translate(0, 0) scale(1) rotate(0deg)',
        opacity: 0.8
      },
      {
        transform: `
          translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) 
          scale(0) rotate(${Math.random() * 360}deg)
        `,
        opacity: 0
      }
    ], {
      duration: duration,
      easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
    }).onfinish = () => {
      particle.remove();
    };
  }
}
function createWaveEffect(isDark) {
  const wave = document.createElement('div');
  wave.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, 
      ${isDark ? 'rgba(79, 70, 229, 0.8)' : 'rgba(251, 191, 36, 0.8)'}, 
      transparent 70%);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 9998;
    pointer-events: none;
    animation: waveExpand 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  `;
  
  document.body.appendChild(wave);
  
  setTimeout(() => {
    wave.remove();
  }, 1000);
}
function createParticleEffect(isDark) {
  const toggleRect = themeToggleContainer.getBoundingClientRect();
  const centerX = toggleRect.left + toggleRect.width / 2;
  const centerY = toggleRect.top + toggleRect.height / 2;
  
  for (let i = 0; i < 12; i++) {
    const particle = document.createElement('div');
    const angle = (i / 12) * Math.PI * 2;
    const distance = 30;
    const color = isDark ? 
      `hsl(${280 + Math.random() * 40}, 100%, 70%)` : 
      `hsl(${40 + Math.random() * 20}, 100%, 60%)`;
    
    particle.style.cssText = `
      position: fixed;
      width: ${Math.random() * 4 + 2}px;
      height: ${Math.random() * 4 + 2}px;
      background: ${color};
      border-radius: 50%;
      left: ${centerX}px;
      top: ${centerY}px;
      z-index: 9997;
      pointer-events: none;
      box-shadow: 0 0 10px ${color};
    `;
    
    document.body.appendChild(particle);
    
    // Анимация частицы
    particle.animate([
      {
        transform: 'translate(0, 0) scale(1)',
        opacity: 1
      },
      {
        transform: `
          translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) 
          scale(0)
        `,
        opacity: 0
      }
    ], {
      duration: 800,
      easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
    }).onfinish = () => {
      particle.remove();
    };
  }
}
// CSS для анимации перехода
const style = document.createElement('style');
style.textContent = `
  @keyframes waveExpand {
    0% {
      width: 0;
      height: 0;
      opacity: 1;
    }
    100% {
      width: 200vw;
      height: 200vw;
      opacity: 0;
    }
  }
  
  @keyframes themeTransition {
    0% {
      opacity: 0;
      clip-path: circle(0% at 50% 50%);
    }
    50% {
      opacity: 0.7;
      clip-path: circle(100% at 50% 50%);
    }
    100% {
      opacity: 0;
      clip-path: circle(100% at 50% 50%);
    }
  }
  
  /* Плавная анимация для всех элементов с задержками */
  body {
    transition: 
      background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.1s,
      color 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;
  }
  
  .nav-item, .btn {
    transition: 
      all 0.4s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
  }
  
  /* Эффект свечения для иконок */
  .dark-theme .nav-item i,
  .dark-theme .btn i {
    filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.3));
    transition: filter 0.5s ease;
  }
  
  .dark-theme .logo-icon {
    box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
  }
  
  /* Эффект градиентного текста при переключении */
  .theme-text-transition {
    background: linear-gradient(90deg, 
      var(--accent-warning), 
      var(--accent-primary), 
      var(--accent-secondary));
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: gradientShift 2s ease infinite;
  }
  
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
`;
document.head.appendChild(style);

// Инициализация темы
if (savedTheme === 'dark') {
  document.body.classList.add('dark-theme');
  themeToggle.checked = true;
}

// Создаем звездочки и частицы при загрузке
createStars();
createParticles();

// Обработчик переключения темы
themeToggle.addEventListener('change', function() {
  const isDark = this.checked;
  
  // Плавное переключение темы
  toggleThemeWithAnimation(isDark);
  
  // Показываем уведомление
  showNotification(`Тема изменена на ${isDark ? 'тёмную' : 'светлую'}`, 'info');
});
// Добавляем обработчик для клавиатуры (Alt+T для переключения темы)
document.addEventListener('keydown', function(e) {
  if (e.altKey && e.key === 't') {
    e.preventDefault();
    themeToggle.click();
  }
});
themeToggleContainer.addEventListener('mouseenter', function() {
  createParticles();
  
  // Анимация частиц
  const particles = particlesContainer.querySelectorAll('.particle');
  particles.forEach((particle, index) => {
    const angle = (index / particles.length) * Math.PI * 2;
    const distance = 15;
    
    particle.animate([
      {
        transform: 'translate(0, 0) scale(1)',
        opacity: particle.style.opacity
      },
      {
        transform: `
          translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)
          scale(0.5)
        `,
        opacity: 0
      }
    ], {
      duration: 800,
      easing: 'ease-out',
      delay: index * 50
    });
  });
});

// Обновляем звездочки при изменении размера окна
window.addEventListener('resize', createStars);
      // Загрузка changelog
      loadChangelogFromSheet();
      
      // Загрузка инструкции
      loadInstruction();
      
      // Показать инструкцию при первом посещении
      if (!localStorage.getItem('instructionShown')) {
        setTimeout(() => {
          showInstructionModal();
          localStorage.setItem('instructionShown', 'true');
        }, 1000);
      }

      // Настройка загрузки файла
      document.getElementById('fileInput').addEventListener('change', handleFileUpload);
      
      // Настройка выбора колонки
      document.getElementById('columnSelect').addEventListener('change', function(e) {
        selectedColumnIndex = parseInt(e.target.value);
        renderTable();
        updateStats();
      });

      // Загружаем историю Bug ID
      const stored = localStorage.getItem('bugIdHistory');
      if (stored) {
        try {
          bugIdHistory = JSON.parse(stored);
          bugIdHistory = bugIdHistory.map(entry => ({
            id: entry.id,
            timestamp: new Date(entry.timestamp),
            userName: entry.userName || 'Неизвестно'
          }));
        } catch(e) {
          bugIdHistory = [];
        }
      }

      // Обработчики для модальных окон
      document.getElementById('instructionBtn').addEventListener('click', showInstructionModal);
      document.getElementById('changelogBtn').addEventListener('click', showChangelogModal);
      document.getElementById('bugReportBtn').addEventListener('click', () => {
        document.getElementById('bugModal').classList.add('show');
        updateSendButtonState();
      });
      document.getElementById('snowToggleBtn').addEventListener('click', toggleSnow);
      document.getElementById('interfaceToggleBtn').addEventListener('click', toggleInterface);

      // Обработчики для баг-репорта
      document.getElementById('checkStatusBtn').addEventListener('click', () => {
        document.getElementById('bugModal').classList.remove('show');
        document.getElementById('bugIdModal').classList.add('show');
        showLastBugIds();
      });

      document.getElementById('searchBugId').addEventListener('click', searchBugStatus);
      
      document.getElementById('cancelBugBtn').addEventListener('click', () => {
        document.getElementById('bugModal').classList.remove('show');
      });

      document.getElementById('sendBugBtn').addEventListener('click', sendBugReport);

      // Обработчики для полей баг-репорта
      document.getElementById('userName').addEventListener('input', updateSendButtonState);
      document.getElementById('bugDescription').addEventListener('input', updateSendButtonState);

      // Закрытие модальных окон
      document.getElementById('closeInstructionModal').addEventListener('click', () => {
        document.getElementById('instructionModal').classList.remove('show');
      });

      document.getElementById('closeChangelogModal').addEventListener('click', () => {
        document.getElementById('changelogModal').classList.remove('show');
      });

      document.getElementById('closeBugModal').addEventListener('click', () => {
        document.getElementById('bugModal').classList.remove('show');
      });

      document.getElementById('closeBugIdModal').addEventListener('click', () => {
        document.getElementById('bugIdModal').classList.remove('show');
      });

      document.getElementById('closeBugIdModalBtn').addEventListener('click', () => {
        document.getElementById('bugIdModal').classList.remove('show');
      });

      // Enter для поиска Bug ID
      document.getElementById('bugIdInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          searchBugStatus();
        }
      });

      // Запустить снег, если сезон
      if (isSnowPeriod()) {
        startSnow();
        updateSnowButton();
      }

      // Добавляем обработку drag and drop для файла
      const fileUpload = document.querySelector('.file-upload');
      
      fileUpload.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = 'var(--accent-primary)';
        this.style.background = 'var(--bg-tertiary)';
      });
      
      fileUpload.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.style.borderColor = 'var(--border-color)';
        this.style.background = '';
      });
      
      fileUpload.addEventListener('drop', function(e) {
        e.preventDefault();
        this.style.borderColor = 'var(--border-color)';
        this.style.background = '';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
            // Создаем искусственное событие change для input
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            document.getElementById('fileInput').files = dataTransfer.files;
            
            // Триггерим событие change
            const event = new Event('change', { bubbles: true });
            document.getElementById('fileInput').dispatchEvent(event);
            
            showNotification('Файл загружен через drag & drop');
          } else {
            showNotification('Пожалуйста, загрузите CSV файл', 'error');
          }
        }
      });

      // Добавляем горячие клавиши
      document.addEventListener('keydown', function(e) {
        // Ctrl+S для сохранения
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          saveChanges();
        }
        
        // Ctrl+F для поиска
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
          e.preventDefault();
          showSection('search-section');
          document.getElementById('codesSearch').focus();
        }
        
        // Ctrl+H для замены
        if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
          e.preventDefault();
          showSection('edit-section');
          document.getElementById('searchHtml').focus();
        }
        
        // Ctrl+I для вставки
        if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
          e.preventDefault();
          showSection('insert-section');
          document.getElementById('insertText').focus();
        }
        
        // Escape для закрытия модальных окон
        if (e.key === 'Escape') {
          document.getElementById('bugModal').classList.remove('show');
          document.getElementById('instructionModal').classList.remove('show');
          document.getElementById('changelogModal').classList.remove('show');
          document.getElementById('bugIdModal').classList.remove('show');
        }
      });
    });

    // Функции для отображения секций
    const sections = {
      'file-section': {
        title: 'Загрузка файла',
        description: 'Загрузите CSV-файл для начала работы'
      },
      'edit-section': {
        title: 'Редактирование',
        description: 'Найдите и замените текст в данных'
      },
      'search-section': {
        title: 'Поиск',
        description: 'Фильтрация данных по кодам 1С'
      },
      'insert-section': {
        title: 'Вставка',
        description: 'Добавление текста в ячейки'
      },
      'stats-section': {
        title: 'Статистика',
        description: 'Общая информация о данных'
      }
    };

    function showSection(sectionId) {
      // Скрыть все секции
      document.querySelectorAll('.function-cards').forEach(section => {
        section.style.display = 'none';
      });
      
      // Показать выбранную секцию
      document.getElementById(sectionId).style.display = 'grid';
      
      // Обновить заголовок
      const section = sections[sectionId];
      document.getElementById('currentSectionTitle').textContent = section.title;
      document.getElementById('currentSectionDescription').textContent = section.description;
      
      // Обновить активный элемент навигации
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
    }

    // Функции для работы с файлами
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      showSpinner();
      
      Papa.parse(file, {
        header: false,
        skipEmptyLines: true,
        delimiter: ';',
        complete: function(results) {
          const rawHeaders = results.data[0];
          const priorityPromoIndex = rawHeaders.indexOf('PriorityPromo');
          
          headers = rawHeaders.filter((_, idx) => idx !== priorityPromoIndex);
          
          csvData = results.data.slice(1).map(row => {
            const obj = {};
            headers.forEach(header => {
              const originalIndex = rawHeaders.indexOf(header);
              obj[header] = row[originalIndex] || '';
            });
            obj._visible = true;
            obj._edited = false;
            return obj;
          });
          
          renderTable();
          updateStats();
          showNotification('Файл успешно загружен');
          hideSpinner();
          
          // Показать таблицу
          document.getElementById('tableContainer').style.display = 'block';
        },
        error: function(err) {
          showNotification('Ошибка при загрузке файла', 'error');
          hideSpinner();
        }
      });
    }

    // Функции для работы с таблицей
    function renderTable() {
      const tableBody = document.getElementById('tableBody');
      if (!tableBody) return;
      
      tableBody.innerHTML = '';
      
      const colName = headers[selectedColumnIndex];
      
      csvData.forEach((row, index) => {
        if (row._visible === false) return;
        
        const tr = document.createElement('tr');
        
        // Ячейка с кодом 1С
        const tdCode = document.createElement('td');
        tdCode.textContent = row['ItemID'] || '';
        tdCode.style.fontFamily = "'JetBrains Mono', monospace";
        tdCode.style.fontWeight = '500';
        
        // Ячейка с описанием (редактируемая)
        const tdDesc = document.createElement('td');
        tdDesc.className = 'editable-cell';
        tdDesc.contentEditable = true;
        tdDesc.innerHTML = row[colName] || '';
        tdDesc.style.position = 'relative';
        
        // Добавить индикатор редактирования
        if (row._edited) {
          tdDesc.style.borderLeft = '3px solid var(--accent-success)';
        }
        
        // Обработчик изменений
        tdDesc.addEventListener('blur', function() {
          const newValue = this.innerHTML;
          if (newValue !== row[colName]) {
            row[colName] = newValue;
            row._edited = true;
            editedRows.add(index);
            updateStats();
            this.style.borderLeft = '3px solid var(--accent-success)';
          }
        });
        
        tr.appendChild(tdCode);
        tr.appendChild(tdDesc);
        tableBody.appendChild(tr);
      });
    }

    // Функции для операций с данными
    function replaceContent() {
      const mode = document.getElementById('modeSelect').value;
      const searchVal = document.getElementById('searchHtml').value.trim();
      const replaceVal = document.getElementById('replaceHtml').value;
      
      if (!headers.length || !csvData.length) {
        showNotification('Загрузите файл перед выполнением операций', 'error');
        return;
      }
      
      if (!searchVal) {
        showNotification('Введите значение для поиска', 'error');
        return;
      }
      
      let count = 0;
      const colName = headers[selectedColumnIndex];
      
      csvData.forEach((row, index) => {
        if (row._visible !== true) return;
        
        const cellContent = row[colName] || '';
        if (cellContent.includes(searchVal)) {
          const regex = new RegExp(searchVal.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
          row[colName] = cellContent.replace(regex, replaceVal);
          row._edited = true;
          editedRows.add(index);
          count++;
        }
      });
      
      renderTable();
      updateStats();
      showNotification(`Заменено ${count} ячеек`);
    }

    function searchCodes() {
      const input = document.getElementById('codesSearch').value.trim();
      
      if (!headers.length) {
        showNotification('Загрузите файл перед поиском', 'error');
        return;
      }
      
      if (!input) {
        csvData.forEach(row => row._visible = true);
        renderTable();
        updateStats();
        showNotification('Показаны все строки');
        return;
      }
      
      const codes = input.split(/[\s,]+/).filter(c => c);
      let count = 0;
      
      csvData.forEach(row => {
        const cellVal = row[headers[11]] || '';
        if (codes.some(code => cellVal.includes(code))) {
          row._visible = true;
          count++;
        } else {
          row._visible = false;
        }
      });
      
      renderTable();
      updateStats();
      showNotification(`Найдено ${count} строк`);
    }

    function clearSearch() {
      document.getElementById('codesSearch').value = '';
      csvData.forEach(row => row._visible = true);
      renderTable();
      updateStats();
      showNotification('Фильтр сброшен');
    }

    function insertContent() {
      const content = document.getElementById('insertText').value;
      const type = document.getElementById('insertType').value;
      const position = document.getElementById('insertPosition').value;
      
      if (!content) {
        showNotification('Введите текст для вставки', 'error');
        return;
      }
      
      let count = 0;
      const colName = headers[selectedColumnIndex];
      
      csvData.forEach((row, index) => {
        if (row._visible !== true) return;
        
        if (position === 'start') {
          row[colName] = content + (row[colName] || '');
        } else {
          row[colName] = (row[colName] || '') + content;
        }
        
        row._edited = true;
        editedRows.add(index);
        count++;
      });
      
      renderTable();
      updateStats();
      showNotification(`Добавлено в ${count} строк`);
    }

    // Функции для сохранения
    function saveChanges() {
      if (!headers.length || !csvData.length) {
        showNotification('Нет данных для сохранения', 'error');
        return;
      }
      
      const columnIndex = selectedColumnIndex;
      const itemIdIndex = 11;
      const columnHeader = headers[columnIndex];
      const itemIdHeader = headers[itemIdIndex];
      
      const csvRows = [];
      csvRows.push(`${itemIdHeader};${columnHeader}`);
      
      csvData.forEach(row => {
        if (row._visible === false) return;
        
        let cellItemID = row['ItemID'] || '';
        let cellSelected = row[headers[selectedColumnIndex]] || '';
        
        if (typeof cellItemID === 'string' && /[;"\n]/.test(cellItemID)) {
          cellItemID = `"${cellItemID.replace(/"/g, '""')}"`;
        }
        if (typeof cellSelected === 'string' && /[;"\n]/.test(cellSelected)) {
          cellSelected = `"${cellSelected.replace(/"/g, '""')}"`;
        }
        
        csvRows.push(`${cellItemID};${cellSelected}`);
      });
      
      const csvString = csvRows.join('\n');
      const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'edited_data.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      showNotification('Файл успешно сохранен');
    }

    // Функции для уведомлений
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const messageEl = document.getElementById('notification-message');
      
      messageEl.textContent = message;
      notification.className = 'notification';
      
      if (type === 'error') {
        notification.classList.add('notification-error');
        notification.querySelector('.notification-icon').innerHTML = '<i class="fas fa-exclamation"></i>';
      } else {
        notification.querySelector('.notification-icon').innerHTML = '<i class="fas fa-check"></i>';
      }
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Функции для спиннера
    function showSpinner() {
      document.getElementById('spinner').classList.add('show');
    }

    function hideSpinner() {
      document.getElementById('spinner').classList.remove('show');
    }

    // Функции для статистики
    function updateStats() {
      const totalRows = csvData.length;
      const visibleRows = csvData.filter(row => row._visible !== false).length;
      const editedCount = editedRows.size;
      
      document.getElementById('statTotalRows').textContent = totalRows;
      document.getElementById('statVisibleRows').textContent = visibleRows;
      document.getElementById('statEditedRows').textContent = editedCount;
      
      // Обновление размера файла
      if (csvData.length > 0) {
        const fileSize = Math.round(JSON.stringify(csvData).length / 1024);
        document.getElementById('statFileSize').textContent = `${fileSize} KB`;
      }
    }

    // Функции для снега
    function toggleSnow() {
      if (snowActive) {
        stopSnow();
      } else {
        startSnow();
      }
      updateSnowButton();
    }

    function startSnow() {
      if (snowActive) return;
      snowActive = true;
      
      const container = document.getElementById('snowContainer');
      container.innerHTML = '';
      
      snowInterval = setInterval(() => {
        for (let i = 0; i < 3; i++) {
          createSnowflake();
        }
      }, 200);
      
      showNotification('Снегопад включен');
    }

    function stopSnow() {
      if (!snowActive) return;
      snowActive = false;
      
      clearInterval(snowInterval);
      document.getElementById('snowContainer').innerHTML = '';
      
      showNotification('Снегопад выключен');
    }

    function updateSnowButton() {
      const snowBtn = document.getElementById('snowToggleBtn');
      const snowText = document.getElementById('snowText');
      
      if (snowActive) {
        snowBtn.classList.remove('btn-warning');
        snowBtn.classList.add('btn-success');
        snowText.textContent = 'Выкл. снег';
        snowBtn.title = 'Выключить снегопад';
      } else {
        snowBtn.classList.remove('btn-success');
        snowBtn.classList.add('btn-warning');
        snowText.textContent = 'Снег';
        snowBtn.title = 'Включить снегопад';
      }
    }

    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.className = 'snowflake';
      
      const size = Math.random() * 6 + 2;
      const isDark = document.body.classList.contains('dark-theme');
      
      snowflake.style.width = `${size}px`;
      snowflake.style.height = `${size}px`;
      snowflake.style.left = `${Math.random() * 100}%`;
      snowflake.style.opacity = Math.random() * 0.8 + 0.2;
      snowflake.style.backgroundColor = isDark ? '#e2e8f0' : '#ffffff';
      
      const duration = 5000 + Math.random() * 5000;
      const drift = Math.random() * 100 - 50;
      
      snowflake.animate([
        { transform: 'translateY(-10px) translateX(0)', opacity: snowflake.style.opacity },
        { transform: `translateY(${window.innerHeight + 20}px) translateX(${drift}px)`, opacity: 0 }
      ], {
        duration: duration,
        easing: 'linear'
      }).onfinish = () => {
        snowflake.remove();
      };
      
      document.getElementById('snowContainer').appendChild(snowflake);
    }

    function isSnowPeriod() {
      const now = new Date();
      const month = now.getMonth() + 1;
      return month === 12 || month === 1 || month === 2;
    }

    // Функции для changelog
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/11i0Nwwbw09aJQFNkztrAUfx0G8PXzUfg1sZyjeIKjxQ/gviz/tq?sheet=Лист1';

    function loadChangelogFromSheet() {
      fetch(SHEET_URL)
        .then(response => response.text())
        .then(text => {
          try {
            const jsonData = JSON.parse(text.substring(47).slice(0, -2));
            const rows = jsonData.table.rows;
            let changelogHtml = '';
            
            rows.forEach(row => {
              const version = row.c[0]?.v || '1.0';
              const rawDate = row.c[1]?.v || '';
              const type = row.c[2]?.v?.trim() || 'Общее';
              const description = row.c[3]?.v || '';
              
              // Форматирование даты
              let formattedDate = rawDate;
              const dateMatch = /Date\((\d+),\s*(\d+),\s*(\d+)\)/.exec(rawDate);
              if (dateMatch) {
                const year = parseInt(dateMatch[1]);
                const month = parseInt(dateMatch[2]) + 1;
                const day = parseInt(dateMatch[3]);
                formattedDate = `${day.toString().padStart(2, '0')}.${month.toString().padStart(2, '0')}.${year.toString().slice(-2)}`;
              }
              
              // Определение класса типа
              let typeClass = 'changed';
              if (type.includes('Добавлено')) typeClass = 'added';
              if (type.includes('Исправлено')) typeClass = 'fixed';
              
              changelogHtml += `
                <div class="changelog-entry">
                  <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span class="changelog-version">Версия ${version}</span>
                    <span class="changelog-date">${formattedDate}</span>
                    <span class="changelog-type ${typeClass}">${type}</span>
                  </div>
                  <div style="font-size: 14px; color: var(--text-secondary);">
                    ${description.replace(/\n/g, '<br>')}
                  </div>
                </div>
              `;
            });
            
            document.getElementById('changelogContent').innerHTML = changelogHtml;
          } catch (error) {
            document.getElementById('changelogContent').innerHTML = 
              '<p style="text-align: center; color: var(--text-secondary);">Не удалось загрузить историю изменений</p>';
          }
        })
        .catch(() => {
          document.getElementById('changelogContent').innerHTML = 
            '<p style="text-align: center; color: var(--text-secondary);">Ошибка загрузки истории изменений</p>';
        });
    }

    // Функция отправки баг-репорта
    const BUG_REPORT_URL = 'https://script.google.com/macros/s/AKfycbyMukNiNzcTtsmydQQJZeJJpVL3lsI17Oy8h_kDliY4WJybvSDZxM6-MS8GFzniKbuu/exec';

    function sendBugReport() {
      const description = document.getElementById('bugDescription').value.trim();
      const userName = document.getElementById('userName').value.trim();
      const minLength = 10;
      
      // Проверка имени
      if (!userName) {
        showNotification('Пожалуйста, введите ваше имя', 'error');
        return;
      }
      
      if (userName.length < 2) {
        showNotification('Имя должно содержать минимум 2 символа', 'error');
        return;
      }
      
      if (!description) {
        showNotification('Пожалуйста, опишите проблему', 'error');
        return;
      }
      
      if (description.length < minLength) {
        showNotification(`Описание должно содержать минимум ${minLength} символов`, 'error');
        return;
      }
      
      const bugId = 'BUG-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
      const sourceLink = window.location.href;
      const fullDescription = `
Имя отправителя: ${userName}
Описание проблемы: ${description}
Источник: ${sourceLink}
Bug ID: ${bugId}
Дата отправки: ${new Date().toLocaleString('ru-RU')}
      `;
      
      showSpinner();
      
      fetch(BUG_REPORT_URL, {
        method: 'POST',
        contentType: 'application/json',
        body: JSON.stringify({
          description: fullDescription, 
          bugId: bugId,
          userName: userName
        })
      })
      .then(response => response.json())
      .then(data => {
        hideSpinner();
        if (data.result === 'success') {
          bugIdHistory.unshift({
            id: bugId,
            timestamp: new Date(),
            userName: userName
          });
          if (bugIdHistory.length > 20) bugIdHistory.pop();
          localStorage.setItem('bugIdHistory', JSON.stringify(bugIdHistory));
          
          showNotification(`Сообщение отправлено. Bug ID: ${bugId}`, 'success');
          
          // Очищаем форму
          document.getElementById('bugDescription').value = '';
          document.getElementById('userName').value = '';
          updateSendButtonState();
          
          document.getElementById('bugModal').classList.remove('show');
        } else {
          showNotification('Произошла ошибка при отправке сообщения', 'error');
        }
      })
      .catch(() => {
        hideSpinner();
        showNotification('Ошибка сети при отправке сообщения', 'error');
      });
    }

    function updateSendButtonState() {
      const description = document.getElementById('bugDescription').value.trim();
      const userName = document.getElementById('userName').value.trim();
      const sendBtn = document.getElementById('sendBugBtn');
      const minLength = 10;
      
      // Обновляем счетчик символов для имени
      const nameCounter = document.getElementById('nameCharCounter');
      if (nameCounter) {
        nameCounter.textContent = `${userName.length}/50 символов`;
        nameCounter.className = 'char-hint ' + 
          (userName.length === 0 ? 'text-gray-500' : 
           userName.length < 2 ? 'text-warning' : 'text-success');
      }
      
      // Обновляем счетчик символов для описания
      const descCounter = document.getElementById('descCharCounter');
      if (descCounter) {
        descCounter.textContent = `${description.length} символов (минимум ${minLength})`;
        descCounter.className = 'char-hint ' + 
          (description.length === 0 ? 'text-gray-500' : 
           description.length < minLength ? 'text-warning' : 'text-success');
      }
      
      // Включаем кнопку только если оба поля заполнены правильно
      sendBtn.disabled = !(userName.length >= 2 && description.length >= minLength);
    }

    function showLastBugIds() {
      const recentBugs = bugIdHistory.slice(0, 5);
      const container = document.getElementById('recentBugIds');
      
      if (recentBugs.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <p>Нет истории Bug ID</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      recentBugs.forEach(entry => {
        const dateStr = entry.timestamp.toLocaleString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const timeAgo = getTimeAgo(entry.timestamp);
        
        html += `
          <div class="bug-history-item" onclick="fillBugId('${entry.id}')">
            <div>
              <div class="bug-history-id">${entry.id}</div>
              <div class="bug-history-date">${dateStr} (${timeAgo})</div>
              ${entry.userName ? `<div class="bug-history-user">От: ${entry.userName}</div>` : ''}
            </div>
            <i class="fas fa-arrow-right bug-history-arrow"></i>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    function getTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'только что';
      if (diffMins < 60) return `${diffMins} мин назад`;
      if (diffHours < 24) return `${diffHours} ч назад`;
      if (diffDays === 1) return 'вчера';
      if (diffDays < 7) return `${diffDays} дн назад`;
      return 'более недели назад';
    }

    function fillBugId(bugId) {
      document.getElementById('bugIdInput').value = bugId;
      document.getElementById('bugIdInput').focus();
    }

    function searchBugStatus() {
      const bugId = document.getElementById('bugIdInput').value.trim();
      if (!bugId) {
        showNotification('Пожалуйста, введите Bug ID.', 'info');
        return;
      }
      fetchBugStatus(bugId);
    }

    // ИСПРАВЛЕННАЯ ФУНКЦИЯ ДЛЯ ПРОВЕРКИ СТАТУСА БАГ-РЕПОРТА
    function fetchBugStatus(bugId) {
      const resultDiv = document.getElementById('bugStatusResult');
      resultDiv.innerHTML = `
        <div class="searching-indicator">
          <div class="searching-spinner"></div>
          <div class="searching-text">Ищем статус для ${bugId}...</div>
        </div>
      `;
      
      const sheetUrl = 'https://docs.google.com/spreadsheets/d/1IGnuwozgAb-cwD-pr7aeMHTX80J06mV8F0IJ9KLmTSk/gviz/tq?sheet=Лист2';

      fetch(sheetUrl)
        .then(res => res.text())
        .then(text => {
          try {
            const jsonText = text.substring(47).slice(0, -2);
            const jsonData = JSON.parse(jsonText);
            const rows = jsonData.table.rows;
            
            let found = false;
            let status = '';
            let date = '';
            
            for (const row of rows) {
              const cols = row.c;
              if (cols && cols.length >= 5) {
                const currentBugId = cols[4].v ? cols[4].v.trim() : '';
                if (currentBugId === bugId) {
                  status = cols[2] ? cols[2].v : 'Нет статуса';
                  date = cols[1] ? cols[1].v : '';
                  found = true;
                  break;
                }
              }
            }
            
            if (found) {
              // Упрощенный вывод - только статус и Bug ID
              resultDiv.innerHTML = `
                <div class="status-success">
                  <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-check-circle" style="color: var(--accent-success); font-size: 1.5rem;"></i>
                    <div>
                      <div style="font-weight: 600; color: var(--accent-success); font-size: 0.95rem; word-break: break-word;">Bug ID найден</div>
                      <div style="font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); font-size: 0.9rem; word-break: break-all;">${bugId}</div>
                    </div>
                  </div>
                  <div style="background: var(--bg-primary); padding: 1rem; margin-top: 1rem;">
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <span style="color: var(--text-tertiary); font-size: 0.9rem; min-width: 60px;">Статус:</span>
                        <span style="font-weight: 600; color: var(--accent-success); text-align: right; word-break: break-word; flex: 1;">${status}</span>
                      </div>
                  </div>
                </div>`;
            } else {
              resultDiv.innerHTML = `
                <div class="status-error">
                  <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                    <i class="fas fa-times-circle" style="color: var(--accent-danger); font-size: 1.5rem;"></i>
                    <div>
                      <div style="font-weight: 600; color: var(--accent-danger); font-size: 0.95rem; word-break: break-word;">Bug ID не найден</div>
                      <div style="font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); font-size: 0.9rem; word-break: break-all;">${bugId}</div>
                    </div>
                  </div>
                  <div style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem; word-break: break-word;">
                    Проверьте правильность введенного ID или обратитесь к администратору.
                  </div>
                </div>`;
            }
          } catch (error) {
            resultDiv.innerHTML = `
              <div class="status-error">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                  <i class="fas fa-exclamation-triangle" style="color: var(--accent-warning); font-size: 1.5rem;"></i>
                  <div>
                    <div style="font-weight: 600; color: var(--accent-warning); font-size: 0.95rem; word-break: break-word;">Ошибка загрузки данных</div>
                  </div>
                </div>
                <div style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem; word-break: break-word;">
                  Не удалось загрузить данные с сервера. Попробуйте позже.
                </div>
              </div>`;
          }
        })
        .catch(() => {
          resultDiv.innerHTML = `
            <div class="status-error">
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <i class="fas fa-exclamation-triangle" style="color: var(--accent-warning); font-size: 1.5rem;"></i>
                <div>
                  <div style="font-weight: 600; color: var(--accent-warning); font-size: 0.95rem; word-break: break-word;">Ошибка сети</div>
                </div>
              </div>
              <div style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem; word-break: break-word;">
                Проверьте подключение к интернету и попробуйте снова.
              </div>
            </div>`;
        });
    }

    // Функции для инструкции
    function loadInstruction() {
      const instructionContent = document.getElementById('instructionContent');
      instructionContent.innerHTML = `
        <div style="max-height: 60vh; overflow-y: auto; padding: 1.5rem; font-family: 'Inter', sans-serif; color: var(--text-secondary); line-height: 1.6;">
          <h2 style="text-align: center; margin-bottom: 1.5rem; font-weight: 700; color: var(--text-primary);">🚀 Руководство по использованию</h2>
          <p style="text-align: center; margin-bottom: 2rem; font-size: 1.1rem; color: var(--text-tertiary);">
            Добро пожаловать! Этот инструмент поможет вам анализировать и визуализировать данные эффективно и просто.
          </p>
          
          <!-- Шаг 1 -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">1</span>
              Загрузка файла
            </h3>
            <div class="step-content">
              Выберите CSV-файл для работы. После загрузки данные автоматически отобразятся в таблице.
            </div>
          </div>
          
          <!-- Шаг 2 -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">2</span>
              Выбор колонки
            </h3>
            <div class="step-content">
              Выберите колонку для работы: <strong>Details</strong> (основное описание) или <strong>Description</strong> (расширенное описание).
            </div>
          </div>
          
          <!-- Шаг 3 -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">3</span>
              Редактирование данных
            </h3>
            <div class="step-content">
              Используйте режим замены для поиска и замены текста, или добавьте новый текст в начало/конец ячеек.
            </div>
          </div>
          
          <!-- Шаг 4 -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">4</span>
              Поиск по кодам
            </h3>
            <div class="step-content">
              Введите коды 1С через запятую или пробел для фильтрации данных в таблице.
            </div>
          </div>
          
          <!-- Шаг 5 -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">5</span>
              Сохранение
            </h3>
            <div class="step-content">
              Нажмите кнопку "Сохранить изменения" для экспорта обработанных данных в CSV-файл.
            </div>
          </div>
          
          <!-- Горячие клавиши -->
          <div class="instruction-step">
            <h3 class="step-title">
              <span class="step-number">6</span>
              Горячие клавиши
            </h3>
            <div class="step-content">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                <div>
                  <strong>Ctrl+S</strong> - Сохранить файл
                </div>
                <div>
                  <strong>Ctrl+F</strong> - Поиск по кодам
                </div>
                <div>
                  <strong>Ctrl+H</strong> - Замена текста
                </div>
                <div>
                  <strong>Ctrl+I</strong> - Вставка текста
                </div>
                <div>
                  <strong>Escape</strong> - Закрыть окна
                </div>
              </div>
            </div>
          </div>
          
          <!-- Дополнительные функции -->
          <div style="margin-top: 3rem;">
            <h3 style="color: var(--accent-primary); margin-bottom: 1.5rem; font-size: 1.3rem; text-align: center;">
              <i class="fas fa-star"></i> Дополнительные возможности
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
              <div style="background: var(--bg-tertiary); padding: 1.25rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                <strong><i class="fas fa-history"></i> История изменений</strong>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-tertiary);">Следите за обновлениями сайта</p>
              </div>
              <div style="background: var(--bg-tertiary); padding: 1.25rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                <strong><i class="fas fa-moon"></i> Темная тема</strong>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-tertiary);">Переключение для комфортной работы</p>
              </div>
              <div style="background: var(--bg-tertiary); padding: 1.25rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                <strong><i class="fas fa-comment-dots"></i> Обратная связь</strong>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-tertiary);">Сообщайте о проблемах и предложениях</p>
              </div>
              <div style="background: var(--bg-tertiary); padding: 1.25rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                <strong><i class="fas fa-snowflake"></i> Сезонные эффекты</strong>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-tertiary);">Праздничное настроение зимой</p>
              </div>
            </div>
          </div>
          
          <!-- Призыв к действию -->
          <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-primary" onclick="hideInstructionModal()">
              <span>Начать работу</span>
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>
          
          <!-- Контактная информация -->
          <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); text-align: center; font-size: 0.9rem; color: var(--text-tertiary);">
            <p>Нужна помощь? Обращайтесь к администратору системы</p>
            <p style="margin-top: 0.5rem;">Версия 2.0 • Последнее обновление: ${new Date().toLocaleDateString('ru-RU')}</p>
          </div>
        </div>
      `;
    }

    function showInstructionModal() {
      document.getElementById('instructionModal').classList.add('show');
    }

    function hideInstructionModal() {
      document.getElementById('instructionModal').classList.remove('show');
    }

    function showChangelogModal() {
      document.getElementById('changelogModal').classList.add('show');
    }

    // ===== Переключение интерфейсов =====
    function toggleInterface() {
      const currentPage = window.location.pathname;
      
      if (currentPage.includes('description.html') || currentPage.includes('index.html')) {
        // Если мы на старом интерфейсе, переключаемся на новый
        localStorage.setItem('preferredInterface', 'new');
        window.open('description-new.html', '_self');
      } else if (currentPage.includes('description-new.html')) {
        // Если мы на новом интерфейсе, переключаемся на старый
        localStorage.setItem('preferredInterface', 'old');
        window.open('description.html', '_self');
      }
      
      showNotification('Интерфейс переключен', 'info');
    }

    // Вспомогательные функции
    function refreshTable() {
      renderTable();
      showNotification('Таблица обновлена');
    }

    function exportTableToCSV() {
      if (!csvData.length) {
        showNotification('Нет данных для экспорта', 'error');
        return;
      }
      saveChanges();
    }
    let springActive = false;
let springInterval = null;
let cloudInterval = null;
let snowdropInterval = null;
let activeSnowdrops = [];

// Добавьте обработчик для кнопки весны (в DOMContentLoaded):
document.getElementById('springToggleBtn').addEventListener('click', toggleSpring);

// Обновите функцию toggleSpring:
function toggleSpring() {
  if (springActive) {
    stopSpring();
  } else {
    startSpring();
  }
  updateSpringButton();
}

function startSpring() {
  if (springActive) return;
  
  // Проверяем, сейчас ли весенний период
  if (!isSpringPeriod()) {
    showNotification('Весеннее оформление доступно только с 1 марта по 31 мая', 'info');
    updateSpringButton();
    return;
  }
  
  springActive = true;
  
  // Сохраняем состояние в localStorage
  localStorage.setItem('springEnabled', 'true');
  
  // Добавляем класс весенней темы к body
  document.body.classList.add('spring-theme');
  
  // Запускаем создание облаков
  createClouds();
  cloudInterval = setInterval(createCloud, 5000);
  showNotification('Весеннее настроение включено 🌸');
}

function updateSpringButton() {
  const springBtn = document.getElementById('springToggleBtn');
  const springText = document.getElementById('springText');
  
  // Проверяем, сейчас ли весенний период
  const isSpringNow = isSpringPeriod();
  
  // Если не весна, скрываем кнопку
  if (!isSpringNow && springActive) {
    // Если весеннее оформление активно, но не весенний период - выключаем
    stopSpring();
  }
  
  // Показываем/скрываем кнопку в зависимости от сезона
  if (isSpringNow) {
    springBtn.style.display = 'inline-flex';
    
    if (springActive) {
      springBtn.classList.remove('btn-success');
      springBtn.classList.add('btn-warning');
      springText.textContent = 'Выкл. весну';
      springBtn.title = 'Выключить весеннее оформление';
    } else {
      springBtn.classList.remove('btn-warning');
      springBtn.classList.add('btn-success');
      springText.textContent = 'Весна';
      springBtn.title = 'Включить весеннее оформление';
    }
  } else {
    springBtn.style.display = 'none';
  }
}

// Функция для создания облаков
function createClouds() {
  // Создаем несколько начальных облаков
  for (let i = 0; i < 5; i++) {
    setTimeout(() => createCloud(), i * 1000);
  }
}

function createCloud() {
  // Проверяем, активна ли весенняя тема
  if (!springActive) return;
  
  const cloud = document.createElement('div');
  cloud.className = 'spring-cloud';
  
  // Случайные параметры для облака
  const size = Math.random() * 80 + 100;
  const height = Math.random() * 70 + 10;
  const speed = Math.random() * 0.1 + 0.05;
  
  // Проверяем, активна ли темная тема
  const isDark = document.body.classList.contains('dark-theme');
  
  // Настройки в зависимости от типа облака и темы
  let cloudConfig = {
    opacity: isDark ? 0.8 : 0.7,
    blur: 1
  };
  
  cloud.style.width = `${size}px`;
  cloud.style.height = `${size * 0.35}px`;
  cloud.style.top = `${height}%`;
  cloud.style.left = `-${size}px`;
  cloud.style.opacity = '0'; // Начинаем с прозрачности 0
  cloud.style.filter = `blur(${cloudConfig.blur}px)`;
  cloud.style.transition = 'opacity 0.5s ease'; // Добавляем transition для плавного появления
  
  // Разные цвета облаков в зависимости от темы
  if (isDark) {
    const lightness = Math.random() * 15 + 85;
    const saturation = Math.random() * 10 + 60;
    cloud.style.background = `hsla(120, ${saturation}%, ${lightness}%, 0.9)`;
  } else {
    const hue = Math.random() * 20 + 180;
    const saturation = Math.random() * 20 + 70;
    const lightness = Math.random() * 10 + 90;
    cloud.style.background = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  }
  
  document.getElementById('springContainer').appendChild(cloud);
  
  // Плавное появление облака
  setTimeout(() => {
    if (cloud.parentNode && springActive) {
      cloud.style.opacity = cloudConfig.opacity;
    }
  }, 10);
  
  // Анимация движения облака
  const duration = (window.innerWidth + size) / speed * 2;
  const verticalMovement = Math.random() * 20 - 10;
  
  const animation = cloud.animate([
    { 
      transform: 'translateX(0) translateY(0)', 
      opacity: cloudConfig.opacity 
    },
    { 
      transform: `translateX(${window.innerWidth + size}px) translateY(${verticalMovement}px)`, 
      opacity: 0 
    }
  ], {
    duration: duration,
    easing: 'linear'
  });
  
  animation.onfinish = () => {
    if (cloud.parentNode) {
      cloud.remove();
    }
  };
  
  // Также добавляем плавное изменение прозрачности во время движения
  setTimeout(() => {
    if (cloud.parentNode && springActive) {
      cloud.animate([
        { opacity: cloudConfig.opacity },
        { opacity: cloudConfig.opacity * 0.7 },
        { opacity: cloudConfig.opacity }
      ], {
        duration: 5000,
        iterations: Infinity,
        easing: 'ease-in-out'
      });
    }
  }, 1000);
}
window.addEventListener('resize', function() {
  if (springActive) {
    // При изменении размера окна пересоздаем облака
    document.querySelectorAll('.spring-cloud').forEach(cloud => cloud.remove());
    createClouds();
  }
});
function stopSpring() {
  if (!springActive) return;
  springActive = false;
  
  // Сохраняем состояние в localStorage
  localStorage.setItem('springEnabled', 'false');
  
  // Убираем класс весенней темы
  document.body.classList.remove('spring-theme');
  
  // Останавливаем создание новых облаков
  clearInterval(cloudInterval);
  
  // Плавно скрываем существующие облака
  document.querySelectorAll('.spring-cloud').forEach(cloud => {
    cloud.style.transition = 'opacity 1s ease';
    cloud.style.opacity = '0';
    
    // Удаляем облако после анимации
    setTimeout(() => {
      if (cloud.parentNode) {
        cloud.remove();
      }
    }, 100);
  });
  
  showNotification('Весеннее оформление выключено');
}
function isSpringPeriod() {
  const now = new Date();
  const month = now.getMonth() + 1; // 1-12
  const day = now.getDate(); // 1-31
  
  // Если март (3), апрель (4) или май (5)
  if (month >= 3 && month <= 5) {
    // Проверяем границы месяцев
    if (month === 3) {
      return day >= 1; // С 1 марта
    } else if (month === 5) {
      return day <= 31; // До 31 мая
    }
    return true; // Апрель полностью входит
  }
  return false;
}

  </script>
</body>
</html>
