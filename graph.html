<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- –°—Ç–∏–ª—å -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

/* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
:root {
  --font-family: 'Inter', sans-serif;
  --border-radius: 16px;
  --shadow: rgba(0, 0, 0, 0.2);
  --primary-gradient: linear-gradient(135deg, #667eea, #764ba2);
  --accent-gradient: linear-gradient(135deg, #89f7fe, #66a6ff);
  --background-gradient: linear-gradient(135deg, #f0f2f5, #d9e2ef);
  --text-color: #222;
  --bg-color: #fff;
  --border-color: #ddd;
  --hover-bg-color: #f9f9f9;
  --label-color: #222;
  --chart-bg-color: #fafafa;
  --button-bg: linear-gradient(135deg, #667eea, #764ba2);
  --button-hover-bg: linear-gradient(135deg, #5a9, #4a8);
  --result-bg: linear-gradient(135deg, #e0f7fa, #b2ebf2);
  --chart-text-color: #222;
  --font-size-base: 16px;
  --changelog-header-color: #2c3e50; /* —Ü–≤–µ—Ç –≤–µ—Ä—Å–∏–∏ */
  --changelog-date-color: #7f8c8d;   /* —Ü–≤–µ—Ç –¥–∞—Ç—ã */
  --changelog-type-bg: #3498db;      /* —Ñ–æ–Ω —Ç–∏–ø–∞ */
  --changelog-entry-bg: #f9f9f9;     /* —Ñ–æ–Ω –∑–∞–ø–∏—Å–∏ */
  --changelog-entry-text: #333;      /* —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∏ */
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark {
  --text-color: #eee;
  --bg-color: #2b2b2b;
  --border-color: #555;
  --hover-bg-color: #444;
  --label-color: #ddd;
  --chart-bg-color: #3a3a3a;
  --button-bg: linear-gradient(135deg, #444, #222);
  --result-bg: linear-gradient(135deg, #555, #333);
  --chart-text-color: #eee;
  --changelog-version-color: #2c3e50;
  --changelog-date-color: #7f8c8d;
  --changelog-type-bg: #3498db;
  --changelog-entry-bg: #444;
  --changelog-entry-color: #eee;
}
/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
body {
  margin: 0;
  font-family: var(--font-family);
  background: var(--background-gradient);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  color: var(--text-color);
  transition: background 0.3s, color 0.3s;
}

/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä */
#footer {
  position: fixed;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-family: 'Arial', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  padding: 12px 20px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  border-radius: 16px 16px 0 0;
  backdrop-filter: blur(4px);
  transition: all 0.3s ease;
}

/* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã */
.theme-switch {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  border: none;
  padding: 12px 20px;
  border-radius: calc(var(--border-radius) * 1.2);
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 600;
  color: #fff;
  box-shadow: 0 4px 15px var(--shadow);
  transition: all 0.3s ease;
}
body.dark .theme-switch {
  background: linear-gradient(135deg, #444, #222);
}
.theme-switch:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞–ª –≤—Å—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º */
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  margin: 0;
}

.container {
  flex: 1; /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
  display: flex;
  flex-direction: column;
  padding: 30px;
  max-width: 1300px;
  margin: 0 auto;
  box-sizing: border-box;
  gap: 40px;
  /* –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è */
  width: 100%;
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.top-panel {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 20px;
}

/* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ + –∫–Ω–æ–ø–∫–∞ */
.file-zone {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}
.file-label {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 15px 25px;
  border-radius: calc(var(--border-radius));
  cursor: pointer;
  font-size: 1.3em;
  font-weight: 600;
  box-shadow: 0 4px 14px var(--shadow);
  transition: all 0.2s ease;
}
.file-label:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}
#csvFileInput {
  display: none;
}
#exportSOTBtn {
  margin-top: 12px;
  padding: 15px 25px;
  font-size: 1.3em;
  border: none;
  border-radius: calc(var(--border-radius));
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  cursor: pointer;
  box-shadow: 0 4px 14px var(--shadow);
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s ease;
}
#exportSOTBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}
/* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
  .back-btn {
    display: inline-block;
    margin: 65px 20px;
    padding: 15px 20px;
    font-size: 1.2em;
    font-weight: 600;
    color: #fff;
    background-color: #ff5722; /* —è—Ä–∫–∏–π —Ü–≤–µ—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è */
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s, transform 0.2s;
  }
  .back-btn:hover {
    background-color: #e64a19; /* —á—É—Ç—å —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    transform: translateY(-2px);
  }
/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
.settings {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  flex: 1;
}
.setting-box {
  background: var(--hover-bg-color);
  padding: 20px;
  border-radius: calc(var(--border-radius));
  box-shadow: 0 4px 14px var(--shadow);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 220px;
  transition: all 0.2s ease;
}
.setting-box:hover {
  box-shadow: 0 6px 20px var(--shadow);
}
.setting-box label {
  font-weight: 600;
  margin-bottom: 10px;
  font-size: 1.2em;
  color: var(--label-color);
  display: flex;
  align-items: center;
  gap: 8px;
}
.setting-box select {
  padding: 14px 20px;
  border-radius: calc(var(--border-radius));
  border: none;
  background: #fff;
  font-size: 1.2em;
  min-width: 150px;
  box-shadow: 0 2px 8px var(--shadow);
  cursor: pointer;
  transition: all 0.2s ease;
}
.setting-box select:hover {
  box-shadow: 0 4px 12px var(--shadow);
  outline: none;
}

/* –ì—Ä–∞—Ñ–∏–∫ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */
.chart-section {
  flex: 1; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –∑–∞–Ω—è—Ç—å –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–Ω—É—Ç—Ä–∏ .container */
  display: flex;
  flex-direction: column;
}
#chartTitle {
  margin-bottom: 15px;
  font-size: 2em;
  font-weight: 700;
  text-align: center;
  color: var(--label-color);
}
/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥—Ä–∞—Ñ–∏–∫–æ–º */
#chartContainer {
  flex: 1; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ */
  min-height: 300px; /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  width: 100%;
  background: var(--chart-bg-color);
  padding: 20px;
  border-radius: calc(var(--border-radius));
  box-shadow: inset 0 8px 16px rgba(0,0,0,0.05);
  box-sizing: border-box;
  display: flex;
  /* –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ */
}
#chartContainer canvas {
  width: 100% !important;
  height: 100% !important;
}
.buttons {
  display: flex;
  gap: 15px;
  margin-top: 15px;
}
.btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 12px 24px;
  font-size: 1.2em;
  border: none;
  border-radius: calc(var(--border-radius));
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s ease;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

/* –ò—Ç–æ–≥–æ–≤–∞—è –∑–æ–Ω–∞ */
#averageResult {
  margin-top: 40px;
  padding: 30px;
  background: var(--result-bg);
  border-radius: calc(var(--border-radius));
  font-weight: 600;
  color: var(--label-color);
  width: 90%;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}
#averageResult {
  max-width: 700px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 500px */
  max-height: 300px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 200px */
  overflow-y: auto;
  padding: 10 px; /* –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ */
  font-size: 1 em; /* –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ —à—Ä–∏—Ñ—Ç–∞ */
  background-color: #f0f0f0; /* –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ –∂–µ–ª–∞–Ω–∏—é */
  border-radius: 8px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}
#averageResult:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
#sotModal {
  display: none; 
  position: fixed; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  background: rgba(0,0,0,0.5);
  justify-content: center; 
  align-items: center; 
  z-index: 9999;
  opacity: 0;
  animation: fadeIn 0.3s forwards;
}
#sotModal.show {
  display: flex;
  opacity: 1;
}
#sotModal > div {
  background: #fff; 
  padding: 20px;
  max-width: 90%;
  width: 80%;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
#sotIframe {
  width: 100%; 
  height: 70vh; 
  border: none; 
  border-radius: 10px;
}
#closeSOTModal {
  align-self: center;
  padding: 10px 20px;
  font-size: 1.2em;
  border: none;
  border-radius: calc(var(--border-radius));
  background: #555;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s;
}
#closeSOTModal:hover {
  background: #333;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª–∫–∏ */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.changelog-version {
  font-weight: 600;
  font-size: 15px;
  color: var(--changelog-header-color);
}
.changelog-date {
  font-size: 13px;
  color: var(--changelog-date-color);
}
.changelog-type {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  color: #fff;
  background-color: var(--changelog-type-bg);
}

/* –§–æ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏ */
.changelog-entry {
  margin-bottom: 10px;
  padding: 12px 15px;
  background-color: var(--changelog-entry-bg);
  border-radius: 8px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
}
/* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–ª–æ–∫–∞ —Å–ª–µ–≤–∞ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Å—Ç–∏–ª–µ–º */
#changelogContainer {
  display: none; /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
  position: fixed; top: 70px; left: 20px; /* —Å–ª–µ–≤–∞ */
  width: 420px;
  max-height: 500px;
  overflow-y: auto;
  background: var(--chart-bg-color);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  z-index: 9999;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  transition: opacity 0.3s, transform 0.3s;
}
#changelogContainer.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}
#changelogContainer h4 {
  margin-top: 0;
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
  border-bottom: 2px solid #ddd;
  padding-bottom: 8px;
  color: var(--text-color);
}

/* –°—Ç–∏–ª—å –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ */
.changelog-entry {
  margin-bottom: 10px;
  padding: 12px 15px;
  background-color: var(--bg-color);
  border-radius: 8px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
}
.changelog-entry:hover {
  background-color: var(--hover-bg-color);
  transform: translateY(-2px);
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø–∏—Å–∏ */
.changelog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.changelog-version {
  font-weight: 600;
  font-size: 15px;
  color: var(--text-color);
}
.changelog-date {
  font-size: 13px;
  color: var(--text-color);
}
.changelog-type {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  color: #fff;
  background-color: #3498db;
}
/* –¶–≤–µ—Ç –¥–ª—è —Ç–∏–ø–æ–≤ */
.changelog-type.–î–æ–±–∞–≤–ª–µ–Ω–æ { background-color: #27ae60; }
.changelog-type.–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ { background-color: #f39c12; }
.changelog-type.–û–±—â–µ–µ { background-color: #8e44ad; }

#bugReportBtn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--section-bg);
  color: var(--text-color);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  padding: 0; /* —É–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
}

/* –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å font-size —É –∫–Ω–æ–ø–∫–∏, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —É –∏–∫–æ–Ω–∫–∏ */
#bugReportBtn i {
  display: block;
  margin: 0;
}
  .buttons {
    display: flex;
    justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    gap: 20px; /* –ú–µ–∂–∫–Ω–æ–ø–æ—á–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –ø–æ –∂–µ–ª–∞–Ω–∏—é */
  }

</style>
</head>
<body>
   <!-- –ù–æ–≤—ã–π —Ñ—É—Ç–µ—Ä -->
<div id="footer">
  <span>–°–æ–∑–¥–∞—Ç–µ–ª—å —Å–∞–π—Ç–∞: EmPsOn &copy; 2025</span>
</div>
<div style="margin-top: 15px; margin-left: 0px;">
  <button class="back-btn" onclick="window.open('index.html', '_self')">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
</div>
<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
<button class="theme-switch" id="themeToggle"><i class="fas fa-moon"></i></button>

<div class="container">
<!-- –ë–ª–æ–∫ changelog -->
<div style="position: fixed; top: 20px; left: 20px; z-index: 9999;">
  <button id="changelogToggle" style="padding:15px 30px; border:none; border-radius:8px; background:var(--primary-gradient); color:#fff; cursor:pointer; font-weight:600; font-size:20px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: background 0.3s;">
    Changelog
  </button>
</div>
<div id="changelogContainer">
  <h4 style="margin-top:0;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>
  <textarea id="changelogText" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π..."></textarea>
  <button id="saveChangelog"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
<!-- –ö–Ω–æ–ø–∫–∞ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞ -->
<div style="position: fixed; bottom: 70px; right: 10px; z-index: 9999;">
  <button id="bugReportBtn" style="
    background:#f44336; 
    color:#fff; 
    border:none; 
    border-radius:50%; 
    width:50px; 
    height:50px; 
    cursor:pointer; 
    box-shadow:0 4px 8px rgba(0,0,0,0.2); 
    display: flex; 
    align-items: center; 
    justify-content: center;
    padding: 0;
  ">
    <i class="fas fa-bug" style="font-size:24px; display: block; line-height: 1; text-align: center;"></i>
  </button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –±–∞–≥–∞ -->
<div id="bugModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10000;">
  <div style="background: var(--hover-bg-color); padding:20px; border-radius:8px; max-width:500px; width:90%; position:relative;">
    <h3>–°–æ–æ–±—â–∏—Ç—å –æ –±–∞–≥–µ</h3>
    <textarea id="bugDescription" style="width:99%; height:150px; padding:10px; border-radius:6px; border:1px solid #ccc; color: var(--text-color); background: var(--section-bg);"></textarea>
    <div style="margin-top:10px; display:flex; justify-content:flex-end;">
      <button id="sendBug" style="background:#4CAF50; color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; margin-right:10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="closeBugModal" style="background:#ccc; color:#000; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="top-panel">
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
    <div class="file-zone">
      <label class="file-label" id="exportSOTBtn">
        <i class="fas fa-file-upload"></i> –í—ã–≥—Ä—É–∑–∏—Ç—å –°–û–¢
      </label>
      <label class="file-label" for="csvFileInput">
        <i class="fas fa-upload"></i> –í—ã–±–µ—Ä–∏—Ç–µ CSV
      </label>
      <input type="file" id="csvFileInput" accept=".csv" />
    </div>
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings">
      <div class="setting-box">
        <label for="blockSelect"><i class="fa-solid fa-database"></i> –ë–ª–æ–∫</label>
        <select id="blockSelect"></select>
      </div>
      <div class="setting-box">
        <label for="toolSelect"><i class="fas fa-wrench"></i> –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</label>
        <select id="toolSelect"></select>
      </div>
      <div class="setting-box">
        <label for="modeSelect"><i class="fas fa-sliders-h"></i> –†–µ–∂–∏–º</label>
        <select id="modeSelect">
          <option value="all">–û–±—â–∏–π</option>
          <option value="individual">–ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</option>
        </select>
      </div>
      <div class="setting-box" id="employeeBox" style="display:none;">
        <label for="employeeSelect"><i class="fas fa-user"></i> –°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
        <select id="employeeSelect"></select>
      </div>
    </div>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ –∏ –∏—Ç–æ–≥ -->
  <div class="chart-section">
    <div id="chartTitle"><i class="fas fa-search"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    <div id="chartContainer">
      <canvas id="myChart"></canvas>
    </div>
    <div class="buttons">
      <button class="btn" id="refreshBtn"><i class="fas fa-rotate"></i> –û–±–Ω–æ–≤–∏—Ç—å</button>
      <button class="btn" id="topBtn"><i class="fas fa-star"></i> –¢–û–ü</button>
    </div>
    <div id="averageResult"></div>
  </div>

</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="sotModal">
  <div>
    <iframe id="sotIframe" src="https://s-o-t.ru/netcat/?catalogue=1&sub=1891833"></iframe>
    <button class="btn" id="closeSOTModal"><i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
let dataBlocks = {
    SOT: { labels: [], data: {} },
    PMK: { labels: [], data: {} },
    TORUDA: { labels: [], data: {} }
};
let currentBlock = null;
let currentTool = null;
let currentEmployee = null;
let chartInstance = null;
let currentLabels = [];
let currentDatasets = [];

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
const themeBtn = document.getElementById('themeToggle');
let darkMode = false;
themeBtn.onclick = () => {
  darkMode = !darkMode;
  document.body.classList.toggle('dark');
  document.body.classList.toggle('dark-theme', themeToggle.checked);
  themeBtn.innerHTML = darkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

  // –ú–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é --background-gradient
  if (darkMode) {
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #111, #222)'
    );
  } else {
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #f0f2f5, #d9e2ef)'
    );
  }

  updateChart();
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
document.getElementById('csvFileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    processCSV(e.target.result);
    document.getElementById('chartTitle').innerHTML = '<i class="fas fa-check-circle"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã';
    document.getElementById('averageResult').innerHTML = '';
    document.getElementById('modeSelect').value = 'all';
    toggleEmployeeSelection();
    updateChart();
  };
  reader.readAsText(file);
});

// –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã
function parseDate(str) {
  const parts = str.trim().split('.');
  if (parts.length !== 3) return null;
  let [d, m, y] = parts;
  if (y.length === 2) y = '20' + y;
  return `${y.padStart(4,'0')}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ CSV
function processCSV(text) {
  dataBlocks = {
    SOT: { labels: [], data: {} },
    PMK: { labels: [], data: {} },
    TORUDA: { labels: [], data: {} }
  };
  const lines = text.trim().split(/\r?\n/);
  const pmkIdx = lines.findIndex(l => l.includes("PMK"));
  const torIdx = lines.findIndex(l => l.includes("TORUDA"));

  const SOTLines = lines.slice(0, pmkIdx);
  const PMKLines = lines.slice(pmkIdx, torIdx);
  const TORUDALines = lines.slice(torIdx);

  ['SOT', 'PMK', 'TORUDA'].forEach(block => {
    let blockLines;
    if (block === 'SOT') blockLines = SOTLines;
    else if (block === 'PMK') blockLines = PMKLines;
    else blockLines = TORUDALines;

    const parsedData = {};
    const dateSet = new Set();

    for (const line of blockLines) {
      const cols = line.split(';').map(c => c.trim());
      if (cols.length < 7) continue;
      const [person, tool, , , , , dateStr] = cols;
      const dateLabel = parseDate(dateStr);
      if (!dateLabel) continue;
      dateSet.add(dateLabel);
      const values = [];
      for (let i = 2; i <= 5; i++) {
        const v = parseFloat(cols[i].replace(',', '.')) || 0;
        values.push(v);
      }
      const total = values.reduce((a, b) => a + b, 0);
      if (!parsedData[tool]) parsedData[tool] = {};
      if (!parsedData[tool][person]) parsedData[tool][person] = {};
      if (!parsedData[tool][person][dateLabel]) parsedData[tool][person][dateLabel] = 0;
      parsedData[tool][person][dateLabel] += total;
    }
    const labelsArr = Array.from(dateSet).sort((a, b) => new Date(a) - new Date(b));
    const dataPerTool = {};
    for (const t in parsedData) {
      dataPerTool[t] = {};
      for (const p in parsedData[t]) {
        dataPerTool[t][p] = Array(labelsArr.length).fill(0);
        labelsArr.forEach((d, i) => {
          if (parsedData[t][p][d] !== undefined) {
            dataPerTool[t][p][i] = parsedData[t][p][d];
          }
        });
      }
    }
    dataBlocks[block].labels = labelsArr;
    dataBlocks[block].data = dataPerTool;
  });
  updateBlockOptions();
  const firstBlock = Object.keys(dataBlocks)[0];
  if (firstBlock) {
    selectBlock(firstBlock);
    toggleEmployeeSelection();
    updateChart();
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã–±–æ—Ä–∞ –±–ª–æ–∫–∞
function updateBlockOptions() {
  const select = document.getElementById('blockSelect');
  select.innerHTML = '';
  for (const b in dataBlocks) {
    const option = document.createElement('option');
    option.value = b;
    option.textContent = b;
    select.appendChild(option);
  }
  select.onchange = () => {
    selectBlock(select.value);
    toggleEmployeeSelection();
    updateChart();
  };
}

// –í—ã–±–æ—Ä –±–ª–æ–∫–∞
function selectBlock(name) {
  currentBlock = name;
  const blockData = dataBlocks[name];
  const tools = Object.keys(blockData.data);
  const selectTool = document.getElementById('toolSelect');
  const selectEmp = document.getElementById('employeeSelect');

  selectTool.innerHTML = '';
  selectEmp.innerHTML = '';

  tools.forEach(t => {
    const opt = document.createElement('option');
    opt.value = t;
    opt.textContent = t;
    selectTool.appendChild(opt);
  });

  // —Å–æ–±–∏—Ä–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  const employees = new Set();
  tools.forEach(t => {
    Object.keys(blockData.data[t] || {}).forEach(e => employees.add(e));
  });
  const empArr = Array.from(employees).sort();

  empArr.forEach(e => {
    const opt = document.createElement('option');
    opt.value = e;
    opt.textContent = e;
    selectEmp.appendChild(opt);
  });

  document.getElementById('modeSelect').onchange = toggleEmployeeSelection;
  document.getElementById('toolSelect').onchange = () => {
    currentTool = document.getElementById('toolSelect').value;
    updateChart();
  };
  document.getElementById('employeeSelect').onchange = () => {
    currentEmployee = document.getElementById('employeeSelect').value;
    updateChart();
  };

  document.getElementById('modeSelect').value = 'all';
  toggleEmployeeSelection();

  if (tools.length > 0) {
    currentTool = tools[0];
    currentEmployee = empArr[0];
    document.getElementById('toolSelect').value = currentTool;
    document.getElementById('employeeSelect').value = currentEmployee;
    updateChart();
    document.getElementById('chartTitle').innerHTML = '<i class="fas fa-layer-group"></i> ' + name + ' | ' + currentTool;
  } else {
    if (chartInstance) chartInstance.destroy();
  }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
function toggleEmployeeSelection() {
  const mode = document.getElementById('modeSelect').value;
  document.getElementById('employeeBox').style.display = (mode === 'individual') ? 'flex' : 'none';
  updateChart();
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞
function getChartTextColor() {
  return darkMode ? '#fff' : '#000';
}


function updateChart() {
  const ctx = document.getElementById('myChart').getContext('2d');
  const mode = document.getElementById('modeSelect').value;
  const tool = document.getElementById('toolSelect').value;
  const employee = document.getElementById('employeeSelect').value;
  const blockData = dataBlocks[currentBlock];
  if (!blockData) return;
  const labels = blockData.labels;
  const textColor = getChartTextColor();

  currentLabels = labels;

  // –§–æ—Ä–º–∏—Ä—É–µ–º datasets
  if (!blockData.data[tool]) {
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –Ω–µ—Ç ‚Äî –æ—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
    if (chartInstance) {
      chartInstance.data.labels = labels;
      chartInstance.data.datasets = [];
      chartInstance.update();
    }
    return;
  }

  if (mode === 'all') {
    const persons = Object.keys(blockData.data[tool] || {});
    currentDatasets = persons.map((p, i) => ({
      label: p,
      data: blockData.data[tool][p],
      borderColor: getColor(i),
      backgroundColor: getColor(i, 0.2),
      borderWidth: 2,
      tension: 0.4,
      fill: true,
      pointBackgroundColor: getColor(i),
      pointBorderColor: '#fff'
    }));
  } else {
    if (employee && blockData.data[tool][employee]) {
      currentDatasets = [{
        label: employee,
        data: blockData.data[tool][employee],
        borderColor: getColor(0),
        backgroundColor: getColor(0, 0.2),
        borderWidth: 3,
        tension: 0.4,
        fill: true,
        pointBackgroundColor: getColor(0),
        pointBorderColor: '#fff'
      }];
    } else {
      currentDatasets = [];
    }
  }

  if (chartInstance) {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥—Ä–∞—Ñ–∏–∫
    chartInstance.data.labels = labels;
    chartInstance.data.datasets = currentDatasets;
    chartInstance.options.animation = {
      duration: 1500,
      easing: 'easeOutQuart'
    };
    chartInstance.update();
  } else {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ
    chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: currentDatasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: {
          duration: 1500,
          easing: 'easeOutQuart'
        },
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' },
              boxWidth: 20,
              boxHeight: 20,
              padding: 15
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: '#ccc',
            borderWidth: 1,
            padding: 10,
            caretSize: 8,
            cornerRadius: 4
          }
        },
        scales: {
          x: {
            ticks: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            },
            grid: {
              color: getGridColor(),
              drawBorder: false
            },
            title: {
              display: true,
              text: 'üìÖ –î–∞—Ç—ã',
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            }
          },
          y: {
            ticks: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' },
              beginAtZero: true
            },
            grid: {
              color: getGridColor(),
              drawBorder: false
            },
            title: {
              display: true,
              text: '–ó–Ω–∞—á–µ–Ω–∏–µ',
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            }
          }
        },
        layout: {
          padding: {
            top: 20,
            bottom: 20,
            left: 20,
            right: 20
          }
        }
      }
    });
  }
}
function getColor(idx, alpha=1) {
  const palette = [
    `rgba(255, 99, 132, ${alpha})`,
    `rgba(54, 162, 235, ${alpha})`,
    `rgba(255, 206, 86, ${alpha})`,
    `rgba(75, 192, 192, ${alpha})`,
    `rgba(153, 102, 255, ${alpha})`,
    `rgba(255, 159, 64, ${alpha})`,
    `rgba(199, 199, 199, ${alpha})`,
    `rgba(255, 99, 255, ${alpha})`,
    `rgba(0, 191, 255, ${alpha})`,
    `rgba(255, 215, 0, ${alpha})`
  ];
  return palette[idx % palette.length];
}

function getGridColor() {
  return getComputedStyle(document.body).getPropertyValue('--chart-text-color').trim();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
document.getElementById('refreshBtn').addEventListener('click', () => { updateChart(); });
document.getElementById('topBtn').addEventListener('click', showTopEmployees);
document.getElementById('exportSOTBtn').onclick = () => {
  document.getElementById('sotModal').classList.add('show');
};
document.getElementById('closeSOTModal').onclick = () => {
  document.getElementById('sotModal').classList.remove('show');
};
document.getElementById('sotModal').onclick = e => {
  if (e.target === document.getElementById('sotModal')) {
    document.getElementById('sotModal').classList.remove('show');
  }
};

// –¢–û–ü —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
function showTopEmployees() {
  if (!dataBlocks[currentBlock]) return;
  const blockData = dataBlocks[currentBlock];
  const tool = document.getElementById('toolSelect').value;
  const mode = document.getElementById('modeSelect').value;

  const sums = {};
  for (const emp in blockData.data[tool]) {
    sums[emp] = blockData.data[tool][emp].reduce((a, b) => a + b, 0);
  }

  const sorted = Object.entries(sums).sort((a, b) => b[1] - a[1]);
  const top3 = sorted.slice(0, 3);
  const trophyIcon = '<i class="fas fa-trophy" style="color: #FFD700; font-size: 1.8em; margin-right: 10px;"></i>';
const icons = [
  '<i class="fas fa-trophy" style="color:gold; font-size:1.4em;"></i>',
  '<i class="fas fa-medal" style="color:silver; font-size:1.4em;"></i>',
  '<i class="fas fa-award" style="color:#cd7f32; font-size:1.4em;"></i>'
];
  let html = `<h3>${trophyIcon} –¢–û–ü —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É: ${tool}</h3><ol style="list-style:none; padding-left:0;">`;
  top3.forEach((item, i) => {
    html += `<li style="margin:8px 0; font-size:1.4em;">${icons[i]} <strong>${item[0]}</strong> ‚Äî ${item[1].toFixed(2)}</li>`;
  });
  html += '</ol>';
  document.getElementById('averageResult').innerHTML = html;
}

const sheetUrl = 'https://docs.google.com/spreadsheets/d/11i0Nwwbw09aJQFNkztrAUfx0G8PXzUfg1sZyjeIKjxQ/gviz/tq?sheet=–õ–∏—Å—Ç2';

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
function loadChangelogFromSheet() {
  fetch(sheetUrl)
    .then(response => response.text())
    .then(text => {
      const jsonData = JSON.parse(text.substring(47).slice(0, -2));
      const rows = jsonData.table.rows;
      let entriesHtml = '';

      function formatDateToDDMMYY(dateStr) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ Date(...)
  const dateMatch = /Date\((\d+),\s*(\d+),\s*(\d+)\)/.exec(dateStr);
  if (dateMatch) {
    let year = parseInt(dateMatch[1], 10);
    let month = parseInt(dateMatch[2], 10); // –Ω—É–º–µ—Ä–∞—Ü–∏—è —Å 0
    let day = parseInt(dateMatch[3], 10);

    // –ú–µ—Å—è—Ü +1, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—Å—è—Ü
    month += 1;

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
    const dd = day.toString().padStart(2, '0');
    const mm = month.toString().padStart(2, '0');
    const yy = (year % 100).toString().padStart(2, '0');

    return `${dd}.${mm}.${yy}`;
  }
  // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é
  return dateStr;
}

      rows.forEach(row => {
        const version = row.c[0].v;
        const rawDate = row.c[1].v; // –∏—Å—Ö–æ–¥–Ω–∞—è –¥–∞—Ç–∞
        const date = formatDateToDDMMYY(rawDate); // –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –¥–¥.–º–º.–≥–≥
        console.log('–ò—Å—Ö–æ–¥–Ω–∞—è –¥–∞—Ç–∞:', rawDate, '–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–∞—è:', date); // –¥–æ–±–∞–≤—å—Ç–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        const type = row.c[2].v.trim();
        let description = row.c[3].v;

        // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è
        description = description.replace(/^‚Ä¢\s?/gm, '<li>‚Ä¢</li>');

        const descriptionHtml = description
          .split('\n')
          .map(line => line.trim().startsWith('‚Ä¢') ? `<li>${line.trim()}</li>` : `<p>${line.trim()}</p>`)
          .join('');

        entriesHtml += `
          <div class="changelog-entry">
            <div class="changelog-header">
              <div>
                <span class="changelog-version">–í–µ—Ä—Å–∏—è ${version}</span>
                <span class="changelog-date">[${date}]</span>
              </div>
              <div class="changelog-type ${type}">${type}</div>
            </div>
            <ul style="margin:0; padding-left:20px;">${descriptionHtml}</ul>
          </div>`;
      });

      const container = document.getElementById('changelogContainer');
      container.innerHTML = '<h4 style="margin-top:0;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>' + entriesHtml;
    })
    .catch(() => {
      document.getElementById('changelogContainer').innerHTML = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.';
    });
}

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
window.addEventListener('load', () => {
  loadChangelogFromSheet();
  // —Ç–∞–∫–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑ localStorage
  const savedChangelog = localStorage.getItem('changelog') || '';
  document.getElementById('changelogText').value = savedChangelog;
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Changelog"
const changelogBtn = document.getElementById('changelogToggle');
const changelogContainer = document.getElementById('changelogContainer');

changelogBtn.addEventListener('click', () => {
  if (changelogContainer.classList.contains('show')) {
    changelogContainer.classList.remove('show');
  } else {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏, –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º
    loadChangelogFromSheet();
    changelogContainer.classList.add('show');
  }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', () => {
  const savedChangelog = localStorage.getItem('changelog') || '';
  document.getElementById('changelogText').value = savedChangelog;
});
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞
document.getElementById('bugReportBtn').addEventListener('click', () => {
  document.getElementById('bugModal').style.display = 'flex';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞
document.getElementById('closeBugModal').addEventListener('click', () => {
  document.getElementById('bugModal').style.display = 'none';
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞–≥–∞
const BUG_REPORT_URL = 'https://script.google.com/macros/s/AKfycbyMukNiNzcTtsmydQQJZeJJpVL3lsI17Oy8h_kDliY4WJybvSDZxM6-MS8GFzniKbuu/exec';
document.getElementById('sendBug').addEventListener('click', () => {
  const description = document.getElementById('bugDescription').value.trim();
  if (description === '') {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É.');
    return;
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å
  fetch(BUG_REPORT_URL, {
    method: 'POST',
    contentType: 'application/json',
    body: JSON.stringify({description: description})
  })
  .then(response => response.json())
  .then(data => {
    if (data.result === 'success') {
      showNotification('–ë–∞–≥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
    } else {
      showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –±–∞–≥–∞.');
    }
  })
  .catch(() => {
    showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞.');
  });

  // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
  document.getElementById('bugDescription').value = '';
  document.getElementById('bugModal').style.display = 'none';
});
</script>
</body>
</html>
