<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- –°—Ç–∏–ª—å -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

/* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
:root {
  --font-family: 'Inter', sans-serif;
  --border-radius: 16px;
  --shadow: rgba(0, 0, 0, 0.2);
  --primary-gradient: linear-gradient(135deg, #667eea, #764ba2);
  --accent-gradient: linear-gradient(135deg, #89f7fe, #66a6ff);
  --background-gradient: linear-gradient(135deg, #f0f2f5, #d9e2ef);
  --text-color: #222;
  --bg-color: #fff;
  --border-color: #ddd;
  --hover-bg-color: #f9f9f9;
  --label-color: #222;
  --chart-bg-color: #fafafa;
  --button-bg: linear-gradient(135deg, #667eea, #764ba2);
  --button-hover-bg: linear-gradient(135deg, #5a9, #4a8);
  --result-bg: linear-gradient(135deg, #e0f7fa, #b2ebf2);
  --chart-text-color: #222;
  --font-size-base: 16px;
  --changelog-header-color: #2c3e50; /* —Ü–≤–µ—Ç –≤–µ—Ä—Å–∏–∏ */
  --changelog-date-color: #7f8c8d;   /* —Ü–≤–µ—Ç –¥–∞—Ç—ã */
  --changelog-type-bg: #3498db;      /* —Ñ–æ–Ω —Ç–∏–ø–∞ */
  --changelog-entry-bg: #f9f9f9;     /* —Ñ–æ–Ω –∑–∞–ø–∏—Å–∏ */
  --changelog-entry-text: #333;      /* —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∏ */
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark {
  --text-color: #eee;
  --bg-color: #2b2b2b;
  --border-color: #555;
  --hover-bg-color: #444;
  --label-color: #ddd;
  --chart-bg-color: #3a3a3a;
  --button-bg: linear-gradient(135deg, #444, #222);
  --result-bg: linear-gradient(135deg, #555, #333);
  --chart-text-color: #eee;
  --changelog-version-color: #2c3e50;
  --changelog-date-color: #7f8c8d;
  --changelog-type-bg: #3498db;
  --changelog-entry-bg: #444;
  --changelog-entry-color: #eee;
}
/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
body {
  margin: 0;
  font-family: var(--font-family);
  background: var(--background-gradient);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  color: var(--text-color);
  transition: background 0.3s, color 0.3s;
}

/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä */
#footer {
  position: fixed;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-family: 'Arial', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  padding: 12px 20px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  border-radius: 16px 16px 0 0;
  backdrop-filter: blur(4px);
  transition: all 0.3s ease;
}

/* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ç–µ–º—ã */
.theme-switch {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  border: none;
  padding: 12px 20px;
  border-radius: calc(var(--border-radius) * 1.2);
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 600;
  color: #fff;
  box-shadow: 0 4px 15px var(--shadow);
  transition: all 0.3s ease;
}
body.dark .theme-switch {
  background: linear-gradient(135deg, #444, #222);
}
.theme-switch:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞–ª –≤—Å—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º */
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  margin: 0;
}

.container {
  flex: 1; /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
  display: flex;
  flex-direction: column;
  padding: 0px;
  max-width: 1300px;
  margin: 0 auto;
  box-sizing: border-box;
  gap: 10px;
  /* –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è */
  width: 100%;
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.top-panel {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
}

/* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ + –∫–Ω–æ–ø–∫–∞ */
.file-zone {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}
.file-label {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 15px 25px;
  border-radius: calc(var(--border-radius));
  cursor: pointer;
  font-size: 1.3em;
  font-weight: 600;
  box-shadow: 0 4px 14px var(--shadow);
  transition: all 0.2s ease;
}
.file-label:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}
#csvFileInput {
  display: none;
}
#exportSOTBtn {
  margin-top: 12px;
  padding: 15px 25px;
  font-size: 1.3em;
  border: none;
  border-radius: calc(var(--border-radius));
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  cursor: pointer;
  box-shadow: 0 4px 14px var(--shadow);
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s ease;
}
#exportSOTBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px var(--shadow);
}
/* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
  .back-btn {
    display: inline-block;
    margin: 65px 20px;
    padding: 15px 20px;
    font-size: 1.2em;
    font-weight: 600;
    color: #fff;
    background-color: #ff5722; /* —è—Ä–∫–∏–π —Ü–≤–µ—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è */
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s, transform 0.2s;
  }
  .back-btn:hover {
    background-color: #e64a19; /* —á—É—Ç—å —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    transform: translateY(-2px);
  }
/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
.settings {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  flex: 1;
}
.setting-box {
  background: var(--hover-bg-color);
  padding: 20px;
  border-radius: calc(var(--border-radius));
  box-shadow: 0 4px 14px var(--shadow);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 220px;
  transition: all 0.2s ease;
}
.setting-box:hover {
  box-shadow: 0 6px 20px var(--shadow);
}
.setting-box label {
  font-weight: 600;
  margin-bottom: 10px;
  font-size: 1.2em;
  color: var(--label-color);
  display: flex;
  align-items: center;
  gap: 8px;
}
.setting-box select {
  padding: 14px 20px;
  border-radius: calc(var(--border-radius));
  border: none;
  background: #fff;
  font-size: 1.2em;
  min-width: 150px;
  box-shadow: 0 2px 8px var(--shadow);
  cursor: pointer;
  transition: all 0.2s ease;
}
.setting-box select:hover {
  box-shadow: 0 4px 12px var(--shadow);
  outline: none;
}

/* –ì—Ä–∞—Ñ–∏–∫ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */
.chart-section {
  flex: 1; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –∑–∞–Ω—è—Ç—å –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–Ω—É—Ç—Ä–∏ .container */
  display: flex;
  flex-direction: column;
}
#chartTitle {
  margin-bottom: 15px;
  font-size: 2em;
  font-weight: 700;
  text-align: center;
  color: var(--label-color);
}
/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥—Ä–∞—Ñ–∏–∫–æ–º */
#chartContainer {
  flex: 1; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –ø–æ –≤—ã—Å–æ—Ç–µ */
  min-height: 300px; /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  width: 100vh;
  background: var(--chart-bg-color);
  padding: 10px;
  border-radius: calc(var(--border-radius));
  box-shadow: inset 0 8px 16px rgba(0,0,0,0.05);
  box-sizing: border-box;
  display: flex;
  /* –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Ç—è–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ */
}
#chartContainer canvas {
  width: 100%;
  height: 100%;
}
.buttons {
  display: flex;
  gap: 15px;
  margin-top: 15px;
}
.btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  padding: 12px 24px;
  font-size: 1.2em;
  border: none;
  border-radius: calc(var(--border-radius));
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s ease;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

/* –ò—Ç–æ–≥–æ–≤–∞—è –∑–æ–Ω–∞ */
#averageResult {
  margin-top: 40px;
  padding: 30px;
  background: var(--result-bg);
  border-radius: calc(var(--border-radius));
  font-weight: 600;
  color: var(--label-color);
  width: 90%;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}
#averageResult {
  max-width: 700px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 500px */
  max-height: 300px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 200px */
  overflow-y: auto;
  padding: 10px; /* –∏—Å–ø—Ä–∞–≤–∏–ª: —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –ø—Ä–æ–±–µ–ª */
  font-size: 1em; /* —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –ø—Ä–æ–±–µ–ª */
  background-color: #f0f0f0; /* –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ –∂–µ–ª–∞–Ω–∏—é */
  border-radius: 8px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}
#averageResult:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
#sotModal {
  display: none; 
  position: fixed; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  background: rgba(0,0,0,0.5);
  justify-content: center; 
  align-items: center; 
  z-index: 9999;
  opacity: 0;
  animation: fadeIn 0.3s forwards;
}
#sotModal > div {
  background: var(--hover-bg-color);
  padding: 20px;
  border-radius: 8px;
  max-width: 1200px; /* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
  width: 95%; /* –ø–æ—á—Ç–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ */
  max-height: 80vh; /* –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—ã—Å–æ—Ç–µ ‚Äî 80% –æ–∫–Ω–∞ */
  height: auto; /* –≤—ã—Å–æ—Ç–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É */
  overflow: auto; /* –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
}
#sotModal.show {
  display: flex;
  opacity: 1;
}
#sotIframe {
  width: 100%; 
  max-width: 1200px;
  height: 70vh; 
  border: none; 
  border-radius: 10px;
}
#closeSOTModal {
  align-self: center;
  padding: 10px 20px;
  font-size: 1.2em;
  border: none;
  border-radius: calc(var(--border-radius));
  background: #555;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s;
}
#closeSOTModal:hover {
  background: #333;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª–∫–∏ */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.changelog-version {
  font-weight: 600;
  font-size: 15px;
  color: var(--changelog-header-color);
}
.changelog-date {
  font-size: 13px;
  color: var(--changelog-date-color);
}
.changelog-type {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  color: #fff;
  background-color: var(--changelog-type-bg);
}

/* –§–æ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏ */
.changelog-entry {
  margin-bottom: 10px;
  padding: 12px 15px;
  background-color: var(--changelog-entry-bg);
  border-radius: 8px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
}
/* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–ª–æ–∫–∞ —Å–ª–µ–≤–∞ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Å—Ç–∏–ª–µ–º */
#changelogContainer {
  display: none; /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
  position: fixed; top: 70px; left: 20px; /* —Å–ª–µ–≤–∞ */
  width: 420px;
  max-height: 500px;
  overflow-y: auto;
  background: var(--chart-bg-color);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  z-index: 9999;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  transition: opacity 0.3s, transform 0.3s;
}
#changelogContainer.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}
#changelogContainer h4 {
  margin-top: 0;
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
  border-bottom: 2px solid #ddd;
  padding-bottom: 8px;
  color: var(--text-color);
}

/* –°—Ç–∏–ª—å –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ */
.changelog-entry {
  margin-bottom: 10px;
  padding: 12px 15px;
  background-color: var(--bg-color);
  border-radius: 8px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
}
.changelog-entry:hover {
  background-color: var(--hover-bg-color);
  transform: translateY(-2px);
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø–∏—Å–∏ */
.changelog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.changelog-version {
  font-weight: 600;
  font-size: 15px;
  color: var(--text-color);
}
.changelog-date {
  font-size: 13px;
  color: var(--text-color);
}
.changelog-type {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  color: #fff;
  background-color: #3498db;
}
/* –¶–≤–µ—Ç –¥–ª—è —Ç–∏–ø–æ–≤ */
.changelog-type.–î–æ–±–∞–≤–ª–µ–Ω–æ { background-color: #27ae60; }
.changelog-type.–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ { background-color: #f39c12; }
.changelog-type.–û–±—â–µ–µ { background-color: #8e44ad; }

#bugReportBtn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--section-bg);
  color: var(--text-color);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  padding: 0; /* —É–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
}
/* –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å font-size —É –∫–Ω–æ–ø–∫–∏, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —É –∏–∫–æ–Ω–∫–∏ */
#bugReportBtn i {
  display: block;
  margin: 0;
}
  .buttons {
    display: flex;
    justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    gap: 20px; /* –ú–µ–∂–∫–Ω–æ–ø–æ—á–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –ø–æ –∂–µ–ª–∞–Ω–∏—é */
  }
h3 {
  font-size: 16px;
}
li {
  font-size: 16px;
}
p {
  font-size: 16px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  font-size: 0.95em;
  font-family: 'Arial', sans-serif;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px 12px;
  text-align: left;
}

th {
  background-color: #e0e0e0;
  font-weight: bold;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #f1f1f1;
}
body.dark table,
body.dark th,
body.dark td {
  background-color: var(--hover-bg-color);
  color: var(--text-color);
  border-color: var(--border-color);
}

/* –ú–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü, —á—Ç–æ–±—ã –æ–Ω–∏ —Ö–æ—Ä–æ—à–æ —Å–º–æ—Ç—Ä–µ–ª–∏—Å—å –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
body.dark th {
  background-color: transparent;
  border-color: var(--border-color);
}
body.dark #comparisonResult {
  background: var(--section-bg);
  color: var(--text-color);
  box-shadow: inset 0 4px 20px rgba(0,0,0,0.5);
  border: 1px solid #555;
}
#compareBtn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  font-size: 1.4em;
  padding: 15px 25px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: all 0.2s;
}
#compareBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
  @keyframes colorShift {
  0% {
    background-position: 0% 50%;
  }
  100% {
    background-position: 100% 50%;
  }
}
</style>
</head>
<body>
<div id="toastContainer" style="
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 15px;
  pointer-events: none;
"></div>
<!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ –≤–∏–¥–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<div id="instructionModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 9999;">
  <div style="
    background: var(--hover-bg-color);
    padding: 30px;
    max-width: 800px;
    width: 90%;
    max-height: 90%;
    overflow-y: auto;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    font-family: 'Inter', sans-serif;
    color: var(--text-color);
    position: relative;
  ">
    <h2 style="margin-top:0; font-size: 2em; text-align: center; color: var (--text-color);">
      <i class="fas fa-info-circle" style="color: var; margin-right:10px;"></i> –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    </h2>
    <p style="font-size: 1.1em; color: var(--text-color); line-height:1.6; text-align: center;">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ—Ç —Å–∞–π—Ç ‚Äî –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ù–∏–∂–µ ‚Äî –∫—Ä–∞—Ç–∫–∞—è, –Ω–æ —è—Ä–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –±—ã—Å—Ç—Ä–æ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑—ã.
    </p>
    <hr style="margin:20px 0; border: none; border-top: 2px solid #eee;">

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color: var(--text-color); display:flex; align-items:center;">
        <i class="fas fa-cloud-download-alt" style="margin-right:10px; color:#3498db;"></i> –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –°–û–¢
      </h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; color:var(--text-color);">
        <li style="margin-bottom:10px;"><strong>–ù–∞–∂–º–∏—Ç–µ "–í—ã–≥—Ä—É–∑–∏—Ç—å –°–û–¢"</strong>.</li>
        <li style="margin-bottom:10px;">–û—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ ‚Äî –≤—Ö–æ–¥–∏—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.</li>
        <li style="margin-bottom:10px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏.</li>
        <li style="margin-bottom:10px;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞.</li>
      </ul>
    </section>

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color:var(--text-color); display:flex; align-items:center;">
        <i class="fas fa-upload" style="margin-right:10px; color:#e67e22;"></i> –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ CSV
      </h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; var(--text-color);">
        <li style="margin-bottom:10px;">–ö–ª–∏–∫–Ω–∏—Ç–µ "–í—ã–±–µ—Ä–∏—Ç–µ CSV" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.</li>
        <li style="margin-bottom:10px;">–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Äî –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å.</li>
      </ul>
    </section>

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color:var(--text-color); display:flex; align-items:center;">
        <i class="fas fa-cogs" style="margin-right:10px; color:#1abc9c;"></i> –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      </h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; color:var(--text-color);">
        <li style="margin-bottom:10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∞–π—Ç, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Ä–µ–∂–∏–º –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).</li>
        <li style="margin-bottom:10px;">–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.</li>
      </ul>
    </section>

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color:var(--text-color); display:flex; align-items:center;">
        <i class="fas fa-chart-line" style="margin-right:10px; color:#9b59b6;"></i> –®–∞–≥ 4: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
      </h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; color:var(--text-color);">
        <li style="margin-bottom:10px;">–ì—Ä–∞—Ñ–∏–∫ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –¥–∏–Ω–∞–º–∏–∫–æ–π.</li>
        <li style="margin-bottom:10px;">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏.</li>
        <li style="margin-bottom:10px;">"–¢–û–ü" ‚Äî –ø–æ–∫–∞–∂–µ—Ç –ª—É—á—à–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</li>
        <li style="margin-bottom:10px;">"–ò—Ç–æ–≥–∏" ‚Äî –¥–∞—Å—Ç —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</li>
      </ul>
      <span style="
      background: linear-gradient(270deg, #ff0000, #ffa500, #ff0000);
      background-size: 600% 600%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 20px;
      font-weight: bold;
      padding: 0 10px;
      animation: colorShift 3s linear infinite;
      display: inline-block;
      margin-right: 10px;
    ">- NEW -</span> 
    <span style="font-size: 1.1em; color:var(--text-color);">–ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º CSV-—Ñ–∞–π–ª–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</br>
    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ CSV –≤ –ø–æ–ª–µ "–í—ã–±–µ—Ä–∏—Ç–µ CSV".</br>
    –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ—è–≤–∏—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–æ–∫ "–ü—Ä–µ–¥—ã–¥—É—â–∏–π" –∏ "–°–ª–µ–¥—É—é—â–∏–π".</span>
 
    </section>

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color:var(--text-color); display:flex; align-items:center;">
  <i class="fas fa-sync-alt" style="margin-right:10px; color:#e74c3c;"></i> 
    <span>–®–∞–≥ 5: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—ã–≥—Ä—É–∑–æ–∫</span>
    <span style="
    background: linear-gradient(270deg, #ff0000, #ffa500, #ff0000);
    background-size: 600% 600%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 1.8em;
    font-weight: bold;
    padding: 0 10px;
    animation: colorShift 3s linear infinite;
    display: inline-block;
    margin-right: 10px;
  ">- NEW -</span>
</h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; color:var(--text-color);">
        <li style="margin-bottom:10px;">–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–≤–∞ CSV —Ñ–∞–π–ª–∞ –∑–∞ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.</li>
        <li style="margin-bottom:10px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Ö –∏ –Ω–∞–∂–º–∏—Ç–µ "–°—Ä–∞–≤–Ω–∏—Ç—å —Ñ–∞–π–ª—ã".</li>
        <li style="margin-bottom:10px;">–í–∞–º –ø–æ–∫–∞–∂—É—Ç —Ç–∞–±–ª–∏—Ü—É —Å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∏ —Ä–∞–∑–Ω–∏—Ü–µ–π.</li>
      </ul>
   

    <section style="margin-bottom:20px;">
      <h3 style="font-size:1.4em; color:var(--text-color); display:flex; align-items:center;">
        <i class="fas fa-tools" style="margin-right:10px; color:#f39c12;"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      </h3>
      <ul style="list-style: none; padding:0; margin-left:0; font-size:1.1em; color:var(--text-color);">
        <li style="margin-bottom:10px;"><strong>Changelog</strong> ‚Äî —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ —Å–∞–π—Ç–∞.</li>
        <li style="margin-bottom:10px;"><strong>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</strong> ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ —Å—Ç–∏–ª—å –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–µ—á–µ—Ä–æ–º.</li>
        <li style="margin-bottom:10px;"><strong>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</strong> ‚Äî —Å–æ–æ–±—â–∏—Ç–µ –æ –±–∞–≥–µ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤, –Ω–∞–∂–∞–≤ –Ω–∞ –∂—É—á–∫–∞.</li>
        <li style="margin-bottom:10px;"><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</strong> ‚Äî –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–Ω–æ–≤–æ, –Ω–∞–∂–∞–≤ –Ω–∞ –∏–∫–æ–Ω–∫—É –≤–æ–ø—Ä–æ—Å–∏–∫–∞.</li>
      </ul>
    </section>

    <div style="text-align:center; margin-top:30px;">
      <button onclick="document.getElementById('instructionModal').style.display='none'" style="
        font-size:14px; padding:10px 20px; border:none; background:#4CAF50; color:#fff; border-radius:4px; cursor:pointer;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: background 0.3s, transform 0.2s;
      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)';">
        –ü–æ–Ω—è—Ç–Ω–æ, —Å–ø–∞—Å–∏–±–æ!
      </button>
    </div>
  </div>
</div>
  <!-- –ù–æ–≤—ã–π —Ñ—É—Ç–µ—Ä -->
<div id="footer">
  <span>–°–æ–∑–¥–∞—Ç–µ–ª—å —Å–∞–π—Ç–∞: EmPsOn &copy; 2025</span>
</div>
<div style="margin-top: 15px; margin-left: 0px;">
  <button class="back-btn" onclick="window.open('index.html', '_self')">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
</div>
<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
<button class="theme-switch" id="themeToggle"><i class="fas fa-moon"></i></button>

<div class="container">
<!-- –ë–ª–æ–∫ changelog -->
<div style="position: fixed; top: 20px; left: 20px; z-index: 9999;">
  <button id="changelogToggle" style="padding:15px 30px; border:none; border-radius:8px; background:var(--primary-gradient); color:#fff; cursor:pointer; font-weight:600; font-size:20px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: background 0.3s;">
    Changelog
  </button>
</div>
<div id="changelogContainer">
  <h4 style="margin-top:0;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>
  <textarea id="changelogText" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π..."></textarea>
  <button id="saveChangelog"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ -->
<div style="position: fixed; bottom: 70px; right: 10px; font-size: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; align-items: center;">
  <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å –∏–∫–æ–Ω–∫–æ–π Font Awesome -->
  <button onclick="document.getElementById('instructionModal').style.display='flex'" style="
    background:#f44336; 
    color:#fff; 
    border:none; 
    border-radius:50%; 
    width:50px; 
    height:50px; 
    cursor:pointer; 
    box-shadow:0 4px 8px rgba(0,0,0,0.2); 
    display: block; 
    align-items: center; 
    justify-content: center;
    padding: 0;
  ">
  <i class="fas fa-info-circle" style="margin-right: 0px; font-size: 28px;"></i> 
  <!-- –ö–Ω–æ–ø–∫–∞ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞ -->
  <button id="bugReportBtn" style="
    background:#f44336; 
    color:#fff; 
    border:none; 
    border-radius:50%; 
    width:50px; 
    height:50px; 
    cursor:pointer; 
    box-shadow:0 4px 8px rgba(0,0,0,0.2); 
    display: block; 
    align-items: center; 
    justify-content: center;
    padding: 0;
  ">
    <i class="fas fa-bug" style="font-size:24px; display: block; line-height: 1; text-align: center;"></i>
  </button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –±–∞–≥–∞ -->
<div id="bugModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:10000;">
  <div style="background: var(--hover-bg-color); padding:20px; border-radius:8px; max-width:500px; width:90%; position:relative;">
    <h3>–°–æ–æ–±—â–∏—Ç—å –æ –±–∞–≥–µ</h3>
    <textarea id="bugDescription" style="width:99%; height:150px; padding:10px; border-radius:6px; border:1px solid #ccc; color: var(--text-color); background: var(--section-bg);"></textarea>
    <div style="margin-top:10px; display:flex; justify-content:flex-end;">
      <button id="sendBug" style="background:#4CAF50; color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; margin-right:10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="closeBugModal" style="background:#ccc; color:#000; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="top-panel">
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
    <div class="file-zone">
      <label class="file-label" id="exportSOTBtn">
        <i class="fas fa-cloud-upload-alt"></i> –í—ã–≥—Ä—É–∑–∏—Ç—å –°–û–¢
      </label>
      <label class="file-label" for="csvFileInput">
        <i class="fas fa-file-csv"></i> –í—ã–±–µ—Ä–∏—Ç–µ CSV
      </label>
      <input type="file" id="csvFileInput" accept=".csv" multiple />
    </div>
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings">
      <div class="setting-box">
        <label for="blockSelect"><i class="fa-solid fa-database"></i> –°–∞–π—Ç</label>
        <select id="blockSelect">
          <option value="" disabled selected>–≤—ã–±–µ—Ä–∏—Ç–µ CSV</option>
        </select>
      </div>
      <div class="setting-box">
        <label for="toolSelect"><i class="fas fa-wrench"></i> –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</label>
        <select id="toolSelect">
          <option value="" disabled selected>–≤—ã–±–µ—Ä–∏—Ç–µ CSV</option>
        </select>
      </div>
      <div class="setting-box">
        <label for="modeSelect"><i class="fas fa-sliders-h"></i> –†–µ–∂–∏–º</label>
        <select id="modeSelect">
          <option value="all">–û–±—â–∏–π</option>
          <option value="individual">–ü–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</option>
        </select>
      </div>
      <div class="setting-box" id="employeeBox" style="display:none;">
        <label for="employeeSelect"><i class="fas fa-user"></i> –°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
        <select id="employeeSelect"></select>
      </div>
    </div>
  </div>
<div id="fileNamesContainer" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;">
  <!-- –ù–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
  <div id="fileList"></div>
</div>
  <!-- –ì—Ä–∞—Ñ–∏–∫ –∏ –∏—Ç–æ–≥ -->
  <div class="chart-section">
    <div id="chartTitle"><i class="fas fa-search"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
    <div id="chartContainer">
      <canvas id="myChart"></canvas>
    </div>
    <div style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
  <button id="prevGraph" class="btn"><i class="fas fa-chevron-left"></i> –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
  <button id="nextGraph" class="btn"><i class="fas fa-chevron-right"></i> –°–ª–µ–¥—É—é—â–∏–π</button>
</div>
    <div class="buttons">
      <button class="btn" id="refreshBtn"><i class="fas fa-rotate"></i> –û–±–Ω–æ–≤–∏—Ç—å</button>
      <button class="btn" id="topBtn"><i class="fas fa-star"></i> –¢–û–ü</button>
     <button class="btn" id="summaryBtn"><i class="fas fa-chart-pie"></i> –ò—Ç–æ–≥–∏</button>
    </div>
    <div id="averageResult"></div>
  </div>

</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="sotModal">
  <div>
    <iframe id="sotIframe" src="https://s-o-t.ru/netcat/?catalogue=1&sub=1891833"></iframe>
    <button class="btn" id="closeSOTModal"><i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
<label class="file-label" for="csvFileInput2" style="margin-left:20px; width: 200px;">
  <i class="fas fa-file-csv"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤—Ç–æ—Ä–æ–π CSV
</label>
<input type="file" id="csvFileInput2" accept=".csv" style="display:none;" />
<button id="compareBtn" style="
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  font-size: 1.4em;
  padding: 15px 25px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 20px;
  max-width: 200px;
  width: 100%;
  align-self: center;
" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 14px rgba(0,0,0,0.2)';">
  <i class="fas fa-code-compare"></i> –°—Ä–∞–≤–Ω–∏—Ç—å —Ñ–∞–π–ª—ã
</button>
<div id="comparisonResult" style="
  margin-top: 30px;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  max-height: 500px;
  overflow-y: auto;
  font-family: 'Arial', sans-serif;
  margin-bottom: 80px;
  transition: box-shadow 0.3s;
">
  <h3 style="margin-top:0; text-align:center; font-size:1.8em; color:var(--text-color);">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h3>
  <div style="margin-bottom: 20px; text-align: center;">
</div>
  <div id="comparisonContent" style="margin-top:10px; line-height:1.6;">
      <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç —Ç–∞–±–ª–∏—Ü—ã -->
  </div>
</div>
<script>
let dataBlocks = {
    SOT: { labels: [], data: {} },
    PMK: { labels: [], data: {} },
    TORUDA: { labels: [], data: {} }
};
let currentBlock = null;
let currentTool = null;
let currentEmployee = null;
let chartInstance = null;
let currentLabels = [];
let currentDatasets = [];
let csvFilesData = [];
let currentCsvIndex = -1; // –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
let fileNames = [];
function showNotification(message) {
  // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const notification = document.createElement('div');
  notification.innerText = message;
  notification.style.position = 'fixed';
  notification.style.top = '20px';
  notification.style.left = '50%';
  notification.style.transform = 'translateX(-50%)';
  notification.style.backgroundColor = 'rgba(0,0,0,0.8)';
  notification.style.color = '#fff';
  notification.style.padding = '15px 20px';
  notification.style.borderRadius = '8px';
  notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
  notification.style.zIndex = '10000';
  notification.style.fontSize = '14px';
  notification.style.opacity = '0';
  notification.style.transition = 'opacity 0.3s';

  document.body.appendChild(notification);

  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
  setTimeout(() => {
    notification.style.opacity = '1';
  }, 10);

  // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    notification.style.opacity = '0';
    setTimeout(() => {
      if (notification.parentNode) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 3000);
}
// =====================
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏–∑ localStorage
// =====================
let darkMode = false; // –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–º—ã
window.addEventListener('load', () => {
  const savedTheme = localStorage.getItem('theme');
  const themeBtn = document.getElementById('themeToggle');
  if (savedTheme === 'dark') {
    darkMode = true;
    document.body.classList.add('dark');
    themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #111, #222)'
    );
  } else {
    // —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
    darkMode = false;
    document.body.classList.remove('dark');
    themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #f0f2f5, #d9e2ef)'
    );
  }
  updateChart(); // –æ–±–Ω–æ–≤–∏–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ–¥ —Ç–µ–º—É
});

// =====================
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
// =====================
const themeBtn = document.getElementById('themeToggle');
themeBtn.onclick = () => {
  darkMode = !darkMode;
  if (darkMode) {
    document.body.classList.add('dark');
    themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #111, #222)'
    );
    localStorage.setItem('theme', 'dark');
  } else {
    document.body.classList.remove('dark');
    themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #f0f2f5, #d9e2ef)'
    );
    localStorage.setItem('theme', 'light');
  }
  updateChart();
  showToast('–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞');
};

// =====================
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
// =====================
const fileInput = document.getElementById('csvFileInput');
const blockSelect = document.getElementById('blockSelect');
const toolSelect = document.getElementById('toolSelect');
let fileChosen = false;
let savedToolSelection = ''; // –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
fileInput.addEventListener('change', () => {
  const files = fileInput.files;
  if (!files || files.length === 0) return;

  // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
  csvFilesData = [];
  fileNames = [];
  document.getElementById('fileNamesContainer').innerHTML = '';
  let loadedCount = 0;

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    if (!file.name.endsWith('.csv')) continue;

    fileNames.push(file.name); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞

    const reader = new FileReader();
    reader.onload = e => {
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ –º–∞—Å—Å–∏–≤
      csvFilesData.push(e.target.result);
      loadedCount++;
      
      // –ö–æ–≥–¥–∞ –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
      if (loadedCount === files.length) {
        currentCsvIndex = 0; // –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞
        processCSV(csvFilesData[currentCsvIndex]);
        updateGraphSwitchButtons();
        updateChart();

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–∞–π–ª–æ–≤
        renderFileNames();

        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        document.getElementById('chartTitle').innerHTML = '<i class="fas fa-check-circle"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã';
        document.getElementById('averageResult').innerHTML = '';
        document.getElementById('modeSelect').value = 'all';
        toggleEmployeeSelection();
        showToast(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${csvFilesData.length} —Ñ–∞–π–ª–∞(–æ–≤)`, 'success');
      }
    };
    reader.readAsText(file);
  }
  // –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –æ—á–∏—â–∞–µ–º –æ–ø—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  if (!fileChosen) {
    blockSelect.innerHTML = '';
    toolSelect.innerHTML = '';
  }
  fileChosen = true;
});

// =====================
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV
// =====================
function resetSelects() {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–ø—Ü–∏—é "–≤—ã–±–µ—Ä–∏—Ç–µ CSV"
  blockSelect.innerHTML = '<option value="" disabled selected>–≤—ã–±–µ—Ä–∏—Ç–µ CSV</option>';
  toolSelect.innerHTML = '<option value="" disabled selected>–≤—ã–±–µ—Ä–∏—Ç–µ CSV</option>';
}

function updateBlockOptions() {
  const select = document.getElementById('blockSelect');
  select.innerHTML = '';
  for (const b in dataBlocks) {
    const option = document.createElement('option');
    option.value = b;
    option.textContent = b;
    select.appendChild(option);
  }
  select.onchange = () => {
    selectBlock(select.value);
    toggleEmployeeSelection();
    updateChart();
  };
}

function selectBlock(name) {
  currentBlock = name;
  const blockData = dataBlocks[name];
  const tools = Object.keys(blockData.data);
  const selectTool = document.getElementById('toolSelect');
  const selectEmp = document.getElementById('employeeSelect');

  // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å
  const previousTool = savedToolSelection;

  selectTool.innerHTML = '';
  selectEmp.innerHTML = '';

  // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
  for (const t of tools) {
    const opt = document.createElement('option');
    opt.value = t;
    opt.textContent = t;
    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –µ–≥–æ
    if (t === previousTool) {
      opt.selected = true;
    }
    selectTool.appendChild(opt);
  }

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  const employees = new Set();
  tools.forEach(t => {
    Object.keys(blockData.data[t] || {}).forEach(e => employees.add(e));
  });
  const empArr = Array.from(employees).sort();

  empArr.forEach(e => {
    const opt = document.createElement('option');
    opt.value = e;
    opt.textContent = e;
    selectEmp.appendChild(opt);
  });

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
  selectTool.onchange = () => {
    currentTool = selectTool.value;
    savedToolSelection = currentTool; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    updateChart();
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  selectEmp.onchange = () => {
    currentEmployee = selectEmp.value;
    updateChart();
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∂–∏–º–∞
  document.getElementById('modeSelect').onchange = toggleEmployeeSelection;
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  document.getElementById('modeSelect').value = 'all';
  toggleEmployeeSelection();

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  if (tools.length > 0) {
    // –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –æ–Ω —É–∂–µ –≤—ã–±—Ä–∞–Ω
    if (savedToolSelection && tools.includes(savedToolSelection)) {
      currentTool = savedToolSelection;
    } else {
      currentTool = tools[0];
    }
    document.getElementById('toolSelect').value = currentTool;

    // –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    if (empArr.length > 0) {
      currentEmployee = empArr[0];
      document.getElementById('employeeSelect').value = currentEmployee;
    }

    updateChart();
    document.getElementById('chartTitle').innerHTML = '<i class="fas fa-layer-group"></i> ' + name + ' | ' + currentTool;
  } else {
    if (chartInstance) chartInstance.destroy();
  }
}

function toggleEmployeeSelection() {
  const mode = document.getElementById('modeSelect').value;
  document.getElementById('employeeBox').style.display = (mode === 'individual') ? 'flex' : 'none';
  updateChart();
}

function parseDate(str) {
  const parts = str.trim().split('.');
  if (parts.length !== 3) return null;
  let [d, m, y] = parts;
  if (y.length === 2) y = '20' + y;
  return `${y.padStart(4,'0')}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
}

function processCSV(text) {
  dataBlocks = {
    SOT: { labels: [], data: {} },
    PMK: { labels: [], data: {} },
    TORUDA: { labels: [], data: {} }
  };
  const lines = text.trim().split(/\r?\n/);
  const pmkIdx = lines.findIndex(l => l.includes("PMK"));
  const torIdx = lines.findIndex(l => l.includes("TORUDA"));

  const SOTLines = lines.slice(0, pmkIdx);
  const PMKLines = lines.slice(pmkIdx, torIdx);
  const TORUDALines = lines.slice(torIdx);

  ['SOT', 'PMK', 'TORUDA'].forEach(block => {
    let blockLines;
    if (block === 'SOT') blockLines = SOTLines;
    else if (block === 'PMK') blockLines = PMKLines;
    else blockLines = TORUDALines;

    const parsedData = {};
    const dateSet = new Set();

    for (const line of blockLines) {
      const cols = line.split(';').map(c => c.trim());
      if (cols.length < 7) continue;
      const [person, tool, , , , , dateStr] = cols;
      const dateLabel = parseDate(dateStr);
      if (!dateLabel) continue;
      dateSet.add(dateLabel);
      const values = [];
      for (let i = 2; i <= 5; i++) {
        const v = parseFloat(cols[i].replace(',', '.')) || 0;
        values.push(v);
      }
      const total = values.reduce((a, b) => a + b, 0);
      if (!parsedData[tool]) parsedData[tool] = {};
      if (!parsedData[tool][person]) parsedData[tool][person] = {};
      if (!parsedData[tool][person][dateLabel]) parsedData[tool][person][dateLabel] = 0;
      parsedData[tool][person][dateLabel] += total;
    }
    const labelsArr = Array.from(dateSet).sort((a, b) => new Date(a) - new Date(b));
    const dataPerTool = {};
    for (const t in parsedData) {
      dataPerTool[t] = {};
      for (const p in parsedData[t]) {
        dataPerTool[t][p] = Array(labelsArr.length).fill(0);
        labelsArr.forEach((d, i) => {
          if (parsedData[t][p][d] !== undefined) {
            dataPerTool[t][p][i] = parsedData[t][p][d];
          }
        });
      }
    }
    dataBlocks[block].labels = labelsArr;
    dataBlocks[block].data = dataPerTool;
  });
  showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
  updateBlockOptions();
  const firstBlock = Object.keys(dataBlocks)[0];
  if (firstBlock) {
    selectBlock(firstBlock);
    toggleEmployeeSelection();
    updateChart();
  }
}

function getChartTextColor() {
  return darkMode ? '#fff' : '#000';
}

function updateChart() {
  const ctx = document.getElementById('myChart').getContext('2d');
  const mode = document.getElementById('modeSelect').value;
  const tool = document.getElementById('toolSelect').value;
  const employee = document.getElementById('employeeSelect').value;
  const blockData = dataBlocks[currentBlock];

  if (!blockData) return;

  const labels = blockData.labels;
  const textColor = getChartTextColor();

  currentLabels = labels;

  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
  const titleElem = document.getElementById('chartTitle');
  if (currentBlock && currentTool) {
    titleElem.innerHTML = `<i class="fas fa-layer-group"></i>${currentBlock} | ${currentTool}`;
  } else {
    titleElem.innerHTML = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã';
  }

  if (mode === 'all') {
    const persons = Object.keys(blockData.data[tool] || {});
    currentDatasets = persons.map((p, i) => ({
      label: p,
      data: blockData.data[tool][p],
      borderColor: getColor(i),
      backgroundColor: getColor(i, 0.2),
      borderWidth: 2,
      tension: 0.4,
      fill: true,
      pointBackgroundColor: getColor(i),
      pointBorderColor: '#fff'
    }));
  } else {
    if (employee && blockData.data[tool][employee]) {
      currentDatasets = [{
        label: employee,
        data: blockData.data[tool][employee],
        borderColor: getColor(0),
        backgroundColor: getColor(0, 0.2),
        borderWidth: 3,
        tension: 0.4,
        fill: true,
        pointBackgroundColor: getColor(0),
        pointBorderColor: '#fff'
      }];
    } else {
      currentDatasets = [];
    }
  }

  if (chartInstance) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
    chartInstance.data.labels = labels;
    chartInstance.data.datasets = currentDatasets;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Ç–µ–º–µ
    chartInstance.options.plugins.title = {
      display: true,
      text: document.getElementById('chartTitle').innerText || '–ì—Ä–∞—Ñ–∏–∫',
      color: getChartTextColor(),
      font: { size: 16, weight: 'bold' }
    };

    chartInstance.options.plugins.title.color = getChartTextColor();
    chartInstance.options.plugins.legend.labels.color = getChartTextColor();
    chartInstance.options.scales.x.ticks.color = getChartTextColor();
    chartInstance.options.scales.y.ticks.color = getChartTextColor();
    chartInstance.options.scales.x.title.color = getChartTextColor();
    chartInstance.options.scales.y.title.color = getChartTextColor();

    chartInstance.update();
  } else {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
    chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: currentDatasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: {
          duration: 1500,
          easing: 'easeOutQuart'
        },
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: '#ccc',
            borderWidth: 1,
            padding: 10,
            caretSize: 8,
            cornerRadius: 4
          },
          title: {
            display: true,
            text: document.getElementById('chartTitle').innerText || '–ì—Ä–∞—Ñ–∏–∫',
            color: getChartTextColor(),
            font: {
              size: 16,
              weight: 'bold'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            },
            grid: {
              color: getGridColor(),
              drawBorder: false
            },
            title: {
              display: true,
              text: 'üìÖ –î–∞—Ç—ã',
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            }
          },
          y: {
            ticks: {
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            },
            grid: {
              color: getGridColor(),
              drawBorder: false
            },
            title: {
              display: true,
              text: '–ó–Ω–∞—á–µ–Ω–∏–µ',
              color: getChartTextColor(),
              font: { size: 14, weight: '600' }
            }
          }
        },
        layout: {
          padding: {
            top: 20,
            bottom: 20,
            left: 20,
            right: 20
          }
        }
      }
    });
  }
}

function getColor(idx, alpha=1) {
  const palette = [
    `rgba(255, 99, 132, ${alpha})`,
    `rgba(54, 162, 235, ${alpha})`,
    `rgba(255, 206, 86, ${alpha})`,
    `rgba(75, 192, 192, ${alpha})`,
    `rgba(153, 102, 255, ${alpha})`,
    `rgba(255, 159, 64, ${alpha})`,
    `rgba(199, 199, 199, ${alpha})`,
    `rgba(255, 99, 255, ${alpha})`,
    `rgba(0, 191, 255, ${alpha})`,
    `rgba(255, 215, 0, ${alpha})`
  ];
  return palette[idx % palette.length];
}

function getGridColor() {
  return getComputedStyle(document.body).getPropertyValue('--chart-text-color').trim();
}

// =====================
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
// =====================
document.getElementById('refreshBtn').addEventListener('click', () => { updateChart(); });
document.getElementById('topBtn').addEventListener('click', showTopEmployees);
document.getElementById('exportSOTBtn').onclick = () => {
  document.getElementById('sotModal').classList.add('show');
};
document.getElementById('closeSOTModal').onclick = () => {
  document.getElementById('sotModal').classList.remove('show');
};
document.getElementById('sotModal').onclick = e => {
  if (e.target === document.getElementById('sotModal')) {
    document.getElementById('sotModal').classList.remove('show');
  }
};

// –¢–û–ü —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
function showTopEmployees() {
  if (!dataBlocks[currentBlock]) return;
  const blockData = dataBlocks[currentBlock];
  const tool = document.getElementById('toolSelect').value;
  const mode = document.getElementById('modeSelect').value;

  const sums = {};
  for (const emp in blockData.data[tool]) {
    sums[emp] = blockData.data[tool][emp].reduce((a, b) => a + b, 0);
  }

  const sorted = Object.entries(sums).sort((a, b) => b[1] - a[1]);
  const top3 = sorted.slice(0, 3);
  const trophyIcon = '<i class="fas fa-trophy" style="color: #FFD700; font-size: 1.8em; margin-right: 10px;"></i>';
const icons = [
  '<i class="fas fa-trophy" style="color:gold; font-size:1.4em;"></i>',
  '<i class="fas fa-medal" style="color:silver; font-size:1.4em;"></i>',
  '<i class="fas fa-award" style="color:#cd7f32; font-size:1.4em;"></i>'
];
  let html = `<h3>${trophyIcon} –¢–û–ü —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É: ${tool}</h3><ol style="list-style:none; padding-left:0;">`;
  top3.forEach((item, i) => {
    html += `<li style="margin:8px 0; font-size:1.4em;">${icons[i]} <strong>${item[0]}</strong> ‚Äî ${item[1].toFixed(2)}</li>`;
  });
  html += '</ol>';
  document.getElementById('averageResult').innerHTML = html;
}
document.getElementById('summaryBtn').addEventListener('click', () => {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  const block = currentBlock;
  const mode = document.getElementById('modeSelect').value;
  const tool = document.getElementById('toolSelect').value;
  const blockData = dataBlocks[block];

  if (!blockData || !blockData.labels || !blockData.data || !blockData.data[tool]) {
    showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏—Ç–æ–≥–æ–≤.', 'error');
    return;
  }

  const labels = blockData.labels; // –¥–∞—Ç—ã
  const employeesData = blockData.data[tool]; // –≤—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–µ
  let html = '<h3 style="font-weight: 800; font-size: 20px;">–ò—Ç–æ–≥–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∑–∞ –ø–µ—Ä–∏–æ–¥</h3>';

  // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∏ —Å—á–∏—Ç–∞–µ–º —Å—É–º–º—ã
  let summaries = [];
  for (const emp in employeesData) {
    // –ï—Å–ª–∏ —Ä–µ–∂–∏–º "–ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É" –∏–ª–∏ "–æ–±—â–∏–π" ‚Äî —Å—á–∏—Ç–∞–µ–º
    let totalSum = 0;
    employeesData[emp].forEach(value => {
      totalSum += value;
    });
    summaries.push({ name: emp, sum: totalSum });
  }

  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—É–º–º–µ
  summaries.sort((a, b) => b.sum - a.sum);

  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É
  html += '<table style="width:100%; border-collapse: collapse; text-align: left;">';
  html += '<tr><th style="border:1px solid #ccc; padding:8px; font-weight: 800; font-size: 20px;">–§–∞–º–∏–ª–∏—è, –ò–º—è</th><th style="border:1px solid #ccc; padding:8px; font-weight: bold; font-size: 20px;">–°—É–º–º–∞</th></tr>';

  summaries.forEach(item => {
    html += `<tr>
      <td style="border:1px solid #ccc; padding:8px; font-weight: 500; font-size: 18px;">${item.name}</td>
      <td style="border:1px solid #ccc; padding:8px; font-weight: 500; font-size: 18px;">${item.sum.toFixed(2)}</td>
    </tr>`;
  });
  html += '</table>';

  // –í—ã–≤–æ–¥–∏–º
  document.getElementById('averageResult').innerHTML = html;
});
// =====================
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –≥—É–≥–ª —Ç–∞–±–ª–∏—Ü—ã
// =====================
const sheetUrl = 'https://docs.google.com/spreadsheets/d/11i0Nwwbw09aJQFNkztrAUfx0G8PXzUfg1sZyjeIKjxQ/gviz/tq?sheet=–õ–∏—Å—Ç2';

function loadChangelogFromSheet() {
  fetch(sheetUrl)
    .then(response => response.text())
    .then(text => {
      const jsonData = JSON.parse(text.substring(47).slice(0, -2));
      const rows = jsonData.table.rows;
      let entriesHtml = '';

      function formatDateToDDMMYY(dateStr) {
        const dateMatch = /Date\((\d+),\s*(\d+),\s*(\d+)\)/.exec(dateStr);
        if (dateMatch) {
          let year = parseInt(dateMatch[1], 10);
          let month = parseInt(dateMatch[2], 10);
          let day = parseInt(dateMatch[3], 10);
          month += 1;
          const dd = day.toString().padStart(2, '0');
          const mm = month.toString().padStart(2, '0');
          const yy = (year % 100).toString().padStart(2, '0');
          return `${dd}.${mm}.${yy}`;
        }
        return dateStr;
      }

      rows.forEach(row => {
        const version = row.c[0].v;
        const rawDate = row.c[1].v;
        const date = formatDateToDDMMYY(rawDate);
        const type = row.c[2].v.trim();
        let description = row.c[3].v;
        description = description.replace(/^‚Ä¢\s?/gm, '<li>‚Ä¢</li>');
        const descriptionHtml = description
          .split('\n')
          .map(line => line.trim().startsWith('‚Ä¢') ? `<li>${line.trim()}</li>` : `<p>${line.trim()}</p>`)
          .join('');
        entriesHtml += `
          <div class="changelog-entry">
            <div class="changelog-header">
              <div>
                <span class="changelog-version">–í–µ—Ä—Å–∏—è ${version}</span>
                <span class="changelog-date">[${date}]</span>
              </div>
              <div class="changelog-type ${type}">${type}</div>
            </div>
            <ul style="margin:0; padding-left:20px;">${descriptionHtml}</ul>
          </div>`;
      });
      document.getElementById('changelogContainer').innerHTML = '<h4 style="margin-top:0;">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h4>' + entriesHtml;
    })
    .catch(() => {
      document.getElementById('changelogContainer').innerHTML = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.';
    });
}

// =====================
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
// =====================
window.addEventListener('load', () => {
    document.getElementById('instructionModal').style.display = 'flex';
    const savedCsv = localStorage.getItem('csvData');
  if (savedCsv) {
    processCSV(savedCsv);
    document.getElementById('chartTitle').innerHTML = '<i class="fas fa-check-circle"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã';
    document.getElementById('averageResult').innerHTML = '';
    document.getElementById('modeSelect').value = 'all';
    toggleEmployeeSelection();
    updateChart();
  }
  loadChangelogFromSheet();
  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –∏–∑ localStorage
  const savedTheme = localStorage.getItem('theme');
  const themeBtn = document.getElementById('themeToggle');
  if (savedTheme === 'dark') {
    darkMode = true;
    document.body.classList.add('dark');
    themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #111, #222)'
    );
  } else {
    darkMode = false; 
    document.body.classList.remove('dark');
    themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
    document.documentElement.style.setProperty(
      '--background-gradient',
      'linear-gradient(135deg, #f0f2f5, #d9e2ef)'
    );
  }
  // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  updateChart();
});

// =====================
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Changelog"
const changelogBtn = document.getElementById('changelogToggle');
const changelogContainer = document.getElementById('changelogContainer');

changelogBtn.addEventListener('click', () => {
  if (changelogContainer.classList.contains('show')) {
    changelogContainer.classList.remove('show');
  } else {
    loadChangelogFromSheet();
    changelogContainer.classList.add('show');
    showToast('–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π');
  }
});

// =====================
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–Ω–∞ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞
// =====================
document.getElementById('bugReportBtn').addEventListener('click', () => {
  document.getElementById('bugModal').style.display = 'flex';
});
document.getElementById('closeBugModal').addEventListener('click', () => {
  document.getElementById('bugModal').style.display = 'none';
});
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞–≥–∞
const BUG_REPORT_URL = 'https://script.google.com/macros/s/AKfycbyMukNiNzcTtsmydQQJZeJJpVL3lsI17Oy8h_kDliY4WJybvSDZxM6-MS8GFzniKbuu/exec';
document.getElementById('sendBug').addEventListener('click', () => {
  const description = document.getElementById('bugDescription').value.trim();
  if (description === '') {
    showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É.', 'info');
    return;
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å
  fetch(BUG_REPORT_URL, {
    method: 'POST',
    contentType: 'application/json',
    body: JSON.stringify({description: description})
  })
  .then(response => response.json())
  .then(data => {
  console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
  if (data.result === 'success') {
    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è');
    showToast('–ë–∞–≥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
  } else {
    showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –±–∞–≥–∞', 'error');
  }
})

  // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
  document.getElementById('bugDescription').value = '';
  document.getElementById('bugModal').style.display = 'none';
});
// =====================
// –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
// =====================
window.addEventListener('scroll', () => {
  const themeBtn = document.getElementById('themeToggle');
  const changelogBtn = document.getElementById('changelogToggle');
  if (!themeBtn || !changelogBtn) return;

  const scrollY = window.scrollY || window.pageYOffset;
  const maxScroll = 300;
  const minOpacity = 0.3;
  const maxOpacity = 1;
  let opacityValue = maxOpacity - (scrollY / maxScroll) * (maxOpacity - minOpacity);
  if (opacityValue < minOpacity) opacityValue = minOpacity;
  if (opacityValue > maxOpacity) opacityValue = maxOpacity;
  themeBtn.style.opacity = opacityValue;
  changelogBtn.style.opacity = opacityValue;
});
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
const fileInput2 = document.getElementById('csvFileInput2');

fileInput2.addEventListener('change', () => {
  const file = fileInput2.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    dataBlocksSecond = { SOT: { labels: [], data: {} }, PMK: { labels: [], data: {} }, TORUDA: { labels: [], data: {} } };
    processCSVSecond(e.target.result);
    showToast('–í—Ç–æ—Ä–æ–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ. –ú–æ–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ', 'info');
  };
  reader.readAsText(file);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
function processCSVSecond(text) {
  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ processCSV, —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
  dataBlocksSecond = { SOT: { labels: [], data: {} }, PMK: { labels: [], data: {} }, TORUDA: { labels: [], data: {} } };
  const lines = text.trim().split(/\r?\n/);
  const pmkIdx = lines.findIndex(l => l.includes("PMK"));
  const torIdx = lines.findIndex(l => l.includes("TORUDA"));

  const SOTLines = lines.slice(0, pmkIdx);
  const PMKLines = lines.slice(pmkIdx, torIdx);
  const TORUDALines = lines.slice(torIdx);

  ['SOT', 'PMK', 'TORUDA'].forEach(block => {
    let blockLines;
    if (block === 'SOT') blockLines = SOTLines;
    else if (block === 'PMK') blockLines = PMKLines;
    else blockLines = TORUDALines;

    const parsedData = {};
    const dateSet = new Set();

    for (const line of blockLines) {
      const cols = line.split(';').map(c => c.trim());
      if (cols.length < 7) continue;
      const [person, tool, , , , , dateStr] = cols;
      const dateLabel = parseDate(dateStr);
      if (!dateLabel) continue;
      dateSet.add(dateLabel);
      const values = [];
      for (let i = 2; i <= 5; i++) {
        const v = parseFloat(cols[i].replace(',', '.')) || 0;
        values.push(v);
      }
      const total = values.reduce((a, b) => a + b, 0);
      if (!parsedData[tool]) parsedData[tool] = {};
      if (!parsedData[tool][person]) parsedData[tool][person] = {};
      if (!parsedData[tool][person][dateLabel]) parsedData[tool][person][dateLabel] = 0;
      parsedData[tool][person][dateLabel] += total;
    }
    const labelsArr = Array.from(dateSet).sort((a, b) => new Date(a) - new Date(b));
    const dataPerTool = {};
    for (const t in parsedData) {
      dataPerTool[t] = {};
      for (const p in parsedData[t]) {
        dataPerTool[t][p] = Array(labelsArr.length).fill(0);
        labelsArr.forEach((d, i) => {
          if (parsedData[t][p][d] !== undefined) {
            dataPerTool[t][p][i] = parsedData[t][p][d];
          }
        });
      }
    }
    dataBlocksSecond[block].labels = labelsArr;
    dataBlocksSecond[block].data = dataPerTool;
  });
}

function compareCSVData() {
  if (!dataBlocks || !dataBlocksSecond) {
    showToast('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è', 'info');
    return;
  }

  const container = document.getElementById('comparisonContent');
  container.innerHTML = ''; // –æ—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º

  for (const blockName in dataBlocks) {
    const block1 = dataBlocks[blockName];
    const block2 = dataBlocksSecond[blockName];
    if (!block1 || !block2) continue;

    // –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã–≤–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—É
    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';
    table.innerHTML = `
      <thead>
        <tr>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–°–∞–π—Ç</th>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–§–∞–π–ª 1</th>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–§–∞–π–ª 2</th>
          <th style="border:1px solid #ccc; padding:8px; background:var(--hover-bg-color);">–ò–∑–º–µ–Ω–µ–Ω–∏–µ (%)</th>
        </tr>
      </thead>
      <tbody></tbody>
    `;

    const tbody = table.querySelector('tbody');

    const tools = Object.keys(block1.data);
    tools.forEach(tool => {
      const employees1 = Object.keys(block1.data[tool] || {});
      const employees2 = Object.keys(block2.data[tool] || {});
      const allEmployees = new Set([...employees1, ...employees2]);
      
      allEmployees.forEach(employee => {
        const data1 = (block1.data[tool][employee] || Array(block1.labels.length).fill(0));
        const data2 = (block2.data[tool][employee] || Array(block2.labels.length).fill(0));
        const sum1 = data1.reduce((a, b) => a + b, 0);
        const sum2 = data2.reduce((a, b) => a + b, 0);
        const percentChange = sum1 === 0 ? (sum2 === 0 ? 0 : 100) : ((sum2 - sum1) / sum1) * 100;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="border:1px solid #ccc; padding:8px;">${blockName}</td>
          <td style="border:1px solid #ccc; padding:8px;">${tool}</td>
          <td style="border:1px solid #ccc; padding:8px;">${employee}</td>
          <td style="border:1px solid #ccc; padding:8px; text-align:right;">${sum1.toFixed(2)}</td>
          <td style="border:1px solid #ccc; padding:8px; text-align:right;">${sum2.toFixed(2)}</td>
          <td style="border:1px solid #ccc; padding:8px; text-align:right;">${percentChange.toFixed(2)}%</td>
        `;
        tbody.appendChild(row);
      });
    });

    container.appendChild(table);
  }
  showToast('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
}
document.getElementById('compareBtn')?.addEventListener('click', compareCSVData);
// –û–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞
const dropZoneCSV = document.querySelector('.file-zone');
const inputCSV = document.getElementById('csvFileInput');

dropZoneCSV.addEventListener('dragover', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV.style.border = '2px dashed #333'; // –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
});
dropZoneCSV.addEventListener('dragleave', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV.style.border = ''; // —É–±—Ä–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç
});
dropZoneCSV.addEventListener('drop', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV.style.border = '';

  if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
    const file = e.dataTransfer.files[0];
    if (file && file.name.endsWith('.csv')) {
      inputCSV.files = e.dataTransfer.files; // –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Ñ–∞–π–ª—ã
      // —Ç—Ä–∏–≥–≥–µ—Ä–∏–º change —Å–æ–±—ã—Ç–∏–µ, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª
      inputCSV.dispatchEvent(new Event('change'));
    } else {
      showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ—Ç—â–∏—Ç–µ CSV-—Ñ–∞–π–ª.', 'info');
    }
  }
});

// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
const inputCSV2 = document.getElementById('csvFileInput2');
const dropZoneCSV2 = document.querySelector('label[for="csvFileInput2"]');

dropZoneCSV2.addEventListener('dragover', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV2.style.border = '2px dashed #333';
});
dropZoneCSV2.addEventListener('dragleave', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV2.style.border = '';
});
dropZoneCSV2.addEventListener('drop', (e) => {
  e.preventDefault();
  e.stopPropagation();
  dropZoneCSV2.style.border = '';

  if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
    const file = e.dataTransfer.files[0];
    if (file && file.name.endsWith('.csv')) {
      inputCSV2.files = e.dataTransfer.files;
      inputCSV2.dispatchEvent(new Event('change'));
    } else {
      showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ CSV-—Ñ–∞–π–ª', 'info');
    }
  }
});
function showToast(message, type='info') {
  const container = document.getElementById('toastContainer');

  const toast = document.createElement('div');
  toast.style.minWidth = '350px';
  toast.style.maxWidth = '400px';
  toast.style.padding = '16px 24px';
  toast.style.borderRadius = '12px';
  toast.style.boxShadow = '0 8px 20px rgba(0,0,0,0.3)';
  toast.style.display = 'flex';
  toast.style.alignItems = 'center';
  toast.style.justifyContent = 'space-between';
  toast.style.background = 'linear-gradient(135deg, #667eea, #764ba2)'; // –≥—Ä–∞–¥–∏–µ–Ω—Ç
  toast.style.color = '#fff';
  toast.style.fontSize = '1.2em';
  toast.style.fontWeight = '600';
  toast.style.transition = 'opacity 0.4s, transform 0.4s, box-shadow 0.4s';
  toast.style.pointerEvents = 'auto';
  toast.style.transform = 'translateY(-30px)';
  toast.style.opacity = '0';

  // –ò–∫–æ–Ω–∫–∏ –∏ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
  let iconHTML = '';
  let bgColor = '';
  switch (type) {
    case 'success':
      bgColor = 'linear-gradient(135deg, #00b09b, #96c93d)';
      iconHTML = '<i class="fas fa-check-circle" style="margin-right:10px; font-size:1.4em; color:#fff;"></i>';
      break;
    case 'error':
      bgColor = 'linear-gradient(135deg, #f85032, #e73827)';
      iconHTML = '<i class="fas fa-exclamation-triangle" style="margin-right:10px; font-size:1.4em; color:#fff;"></i>';
      break;
    case 'info':
    default:
      bgColor = 'linear-gradient(135deg, #36d1dc, #5b86b5)';
      iconHTML = '<i class="fas fa-info-circle" style="margin-right:10px; font-size:1.4em; color:#fff;"></i>';
      break;
  }

  toast.style.background = bgColor;

  toast.innerHTML = `
    <div style="display:flex; align-items:center;">
      ${iconHTML}
      <div style="flex:1;">${message}</div>
    </div>
    <button style="
      margin-left:15px;
      background: transparent;
      border: none;
      color: #fff;
      font-size:1.6em;
      cursor: pointer;
      line-height: 1;
      transition: color 0.2s;
    " aria-label="–ó–∞–∫—Ä—ã—Ç—å" onmouseover="this.style.color='#ff0'" onmouseout="this.style.color='#fff'" onclick="this.parentElement.style.opacity='0'; this.parentElement.style.transform='translateY(-20px)'; setTimeout(() => { if (this.parentElement.parentNode) this.parentElement.parentNode.removeChild(this.parentElement); }, 400);">&times;</button>
  `;

  container.appendChild(toast);

  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(-20px)';
    toast.style.boxShadow = '0 12px 24px rgba(0,0,0,0.4)';
  }, 10);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
    setTimeout(() => {
      if (toast.parentNode) toast.parentNode.removeChild(toast);
    }, 400);
  }, 5000);
}
document.getElementById('prevGraph').addEventListener('click', () => {
  if (csvFilesData.length <= 1) return;
  currentCsvIndex = (currentCsvIndex - 1 + csvFilesData.length) % csvFilesData.length;
  processCSV(csvFilesData[currentCsvIndex]);
  updateChart();
  renderFileNames(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
  showToast(`–ì—Ä–∞—Ñ–∏–∫ ${currentCsvIndex + 1} –∏–∑ ${csvFilesData.length}`, 'info');
});

document.getElementById('nextGraph').addEventListener('click', () => {
  if (csvFilesData.length <= 1) return;
  currentCsvIndex = (currentCsvIndex + 1) % csvFilesData.length;
  processCSV(csvFilesData[currentCsvIndex]);
  updateChart();
  renderFileNames(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
  showToast(`–ì—Ä–∞—Ñ–∏–∫ ${currentCsvIndex + 1} –∏–∑ ${csvFilesData.length}`, 'info');
});
function updateGraphSwitchButtons() {
  document.getElementById('prevGraph').disabled = csvFilesData.length <= 1;
  document.getElementById('nextGraph').disabled = csvFilesData.length <= 1;
}
function renderFileNames() {
  const container = document.getElementById('fileNamesContainer');
  container.innerHTML = '';

  fileNames.forEach((name, index) => {
    const span = document.createElement('span');
    span.textContent = name;
    span.style.cursor = 'pointer';
    span.style.padding = '6px 12px';
    span.style.borderRadius = '8px';
    span.style.backgroundColor = index === currentCsvIndex ? 'rgba(102, 126, 234, 0.3)' : 'transparent';
    span.style.border = '1px solid #ccc';

    span.onclick = () => {
      if (index !== currentCsvIndex) {
        currentCsvIndex = index;
        processCSV(csvFilesData[currentCsvIndex]);
        updateChart();
        renderFileNames(); // –û–±–Ω–æ–≤–∏–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
      }
    };

    container.appendChild(span);
  });
}
</script>
</body>
</html>
