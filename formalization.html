<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- Шрифты Google -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
<!-- Иконки Font Awesome 6 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<style>
  :root {
    --bg-color: #f0f2f5;
    --text-color: #222;
    --section-bg: #fff;
    --border-color: #d0d0d0;
    --primary-gradient: linear-gradient(135deg, #4CAF50, #66bb6a);
    --hover-gradient: linear-gradient(135deg, #45a049, #5fa362);
    --shadow: rgba(0,0,0,0.1);
  }
  body {
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 30px;
    background: var(--bg-color);
    color: var(--text-color);
    transition: background 0.5s, color 0.5s;
    line-height: 1.6;
  }
 /* Тёмная тема */
  body.dark-theme {
  --bg-color: #1a1a1a;
  --text-color: #e0e0e0;
  --section-bg: #2d2d2d;
  --border-color: #404040;
  --primary-gradient: linear-gradient(135deg, #66bb6a, #4CAF50);
  --hover-gradient: linear-gradient(135deg, #5fa362, #45a049);
  --shadow: rgba(0,0,0,0.4);
  --editor-bg: #333;
  --editor-text: #e0e0e0;
  --editor-border: #555;
  --toolbar-bg: #3a3a3a;
  --toolbar-border: #444;
  --toolbar-hover: #4a4a4a;
}
/* Стили для переключателя темы в тёмной теме */
body.dark-theme .custom-theme-switcher {
  color: #e0e0e0;
}
/* Стили для редакторов в тёмной теме */
body.dark-theme .ql-editor {
  background: var(--editor-bg);
  color: var(--editor-text);
}
body.dark-theme .ql-toolbar {
  background: var(--toolbar-bg);
  border-color: var(--toolbar-border) !important;
}
body.dark-theme .ql-container {
  border-color: var(--editor-border) !important;
  background: var(--editor-bg);
}
body.dark-theme .ql-snow .ql-stroke {
  stroke: var(--text-color) !important;
}
body.dark-theme .ql-snow .ql-fill {
  fill: var(--text-color) !important;
}
body.dark-theme .ql-snow.ql-toolbar button:hover,
body.dark-theme .ql-snow .ql-toolbar button:hover {
  background: var(--toolbar-hover) !important;
}
body.dark-theme .ql-snow .ql-picker {
  color: var(--text-color) !important;
}
body.dark-theme .ql-snow .ql-picker-options {
  background: var(--toolbar-bg);
  color: var(--text-color);
}
/* Стиль для кнопки инструкции */
.instruction-btn {
  position: fixed;
  top: 8px;
  left: 75px;
  z-index: 999;
  width: 40px;
  height: 40px;
  padding: 0;
  color: #fff;
  background-color: #f44336 !important;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: background-color 0.3s, transform 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.instruction-btn::before {
  content: "\f059";
  font-family: "Font Awesome 5 Free";
  font-weight: 900;
  font-size: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
/* Стиль для кнопки "Назад" вверху */
.back-btn-top {
   width: 40px;
  height: 40px;
  position: fixed;
  top: 80px; /* под переключателем темы */
  left: 20px;
   z-index: 999;
  padding: 10px 8px;
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  background-color: #ff5722;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: background-color 0.3s, transform 0.2s;
  display: block;
  align-items: center;
  gap: 8px;
}
.back-btn-top:hover {
  background-color: #e64a19;
  transform: translateY(-2px);
}
/* Подсказка при наведении (сокращенная) */
.back-btn-top:hover::before {
  content: "На главную";
  position: absolute;
  bottom: -35px;
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 4px;
  font-size: 11px;
  white-space: nowrap;
  z-index: 1000;
}
/* Контейнеры для редакторов */
.editor-block {
  margin-bottom: 20px;
  padding: 15px;
  background: var(--section-bg);
  border-radius: 12px;
  border: 1px solid var(--border-color);
}
.list-block {
  margin-bottom: 25px;
  padding: 15px;
  background: var(--section-bg);
  border-radius: 12px;
  border: 1px solid var(--border-color);
}


  /* Переключатель темы */
  .theme-switcher {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 999;
    font-size: 14px;
    background: var(--section-bg);
    padding: 8px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .theme-switcher input[type="checkbox"] {
    width: 50px;
    height: 25px;
    appearance: none;
    background: #c6c6c6;
    outline: none;
    border-radius: 25px;
    position: relative;
    transition: background 0.3s;
    cursor: pointer;
  }
  .theme-switcher input[type="checkbox"]:checked {
    background: #66bb6a;
  }
  .theme-switcher input[type="checkbox"]::before {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 21px;
    height: 21px;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: 0.3s;
  }
  input[type="checkbox"]:checked::before {
    transform: translateX(25px);
  }

  h1 {
     margin-top: 50px;
    text-align: center;
    margin-bottom: 30px;
    font-size: 36px;
    font-weight: 600;
    color: var(--text-color);
  }
  /* Блок выбора */
.select-container {
  max-width: 600px;
  margin: 0 auto 40px auto;
  background: var(--section-bg);
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 16px 32px var(--shadow);
  transition: box-shadow 0.3s, transform 0.3s, background 0.3s;
}
.select-container:hover {
  box-shadow: 0 20px 40px var(--shadow);
  transform: translateY(-4px);
}
label {
  display: block;
  font-weight: 600;
  margin-bottom: 10px;
}
select {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  font-size: 16px;
  transition: border-color 0.3s, box-shadow 0.3s;
}
select:focus {
  border-color: #4CAF50;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.2);
  outline: none;
}

/* Скрытые разделы инструментов */
.tools {
  display: none;
  max-width: 700px;
  margin: 0 auto;
}
.tool-section {
  display: none;
  background: var(--section-bg);
  padding: 20px;
  margin-bottom: 30px;
  border-radius: 16px;
  box-shadow: 0 16px 32px var(--shadow);
}
h2 {
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 24px;
  font-weight: 600;
  color: var(--text-color);
  display: flex;
  align-items: center;
}
h2 i {
  margin-right: 10px;
  font-size: 24px;
  color: #4CAF50;
}
label {
  display: block;
  margin-bottom: 15px;
  font-weight: 500;
}
input[type="text"], textarea {
  width: 100%;
  box-sizing: border-box;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  font-size: 16px;
}
input[type="text"]:focus, textarea:focus {
  border-color: #4CAF50;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.2);
  outline: none;
}

/* Кнопки */
button {
  padding: 14px 30px;
  font-size: 17px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: var(--primary-gradient);
  color: #fff;
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  font-weight: 600;
}
button:hover {
  background: var(--hover-gradient);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
}
button i {
  margin-right: 12px;
  font-size: 20px;
}

/* Таблица */
#tableContainer {
  margin-top: 40px;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  background: #fff;
  transition: background 0.3s, box-shadow 0.3s;
}
body.dark-theme table {
  background: #444;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
}
thead {
  background: linear-gradient(135deg, #f7f7f7, #e0e0e0);
}
body.dark-theme thead {
  background: linear-gradient(135deg, #555, #333);
}
th, td {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
  font-size: 16px;
}
td.editable {
  background-color: #fff8dc;
  cursor: text;
}
body.dark-theme td.editable {
  background-color: #777;
}
td:hover {
  background-color: #f0f0f0;
}
body.dark-theme td:hover {
  background-color: #666;
}

/* Кнопка сохранения */
#saveBtn {
  display: block;
  margin: 30px auto;
}

/* Модальное окно */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 10000;
  align-items: center;
  justify-content: center;
}
.modal.active {
  display: flex;
}
.modal-content {
  background: var(--section-bg);
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  max-width: 600px;
  width: 90%;
  max-height: 80%;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  position: relative;
}
.modal-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-color);
  cursor: pointer;
}
.modal-header {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 20px;
  color: var(--text-color);
}
.modal-body {
  font-size: 16px;
  line-height: 1.6;
  color: var(--text-color);
}

/* Футер */
#footer {
  position: fixed;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-family: 'Arial', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  padding: 12px 20px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  border-radius: 16px 16px 0 0;
}

/* Уведомление */
#notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #4CAF50;
  color: #fff;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  font-size: 16px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
#notification.show {
  opacity: 1;
}

/* Блок информационной плашки */
#infoBoxContainer {
  max-width: 600px;
  margin: 20px auto;
  padding: 20px;
  background: var(--section-bg);
  border-radius: 16px;
  box-shadow: 0 16px 32px var(--shadow);
  display: none;
}
#infoBoxContainer.active {
  display: block;
}
#infoPreview {
  margin-top: 20px;
  padding: 10px;
  background: var(--section-bg);
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  min-height: 40px;
  width: 100%;
}
#previewText {
  font-size: 20px;
  font-weight: 700;
  color: #d84315;
  word-wrap: break-word;
  word-break: break-word;
  white-space: pre-wrap;
  width: 100%;
  min-height: 40px;
}

/* Остальные стили без изменений */

.warning {
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #fff0f5, #ffe0ec);
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
.warning:hover {
  box-shadow: 0 6px 25px rgba(0,0,0,0.2);
  background: linear-gradient(135deg, #ffe0ec, #fff0f5);
}
.warning-text {
  font-size: 25px;
  font-weight: 700;
  color: #d84315;
}

/* Медиазапрос для мобильных устройств */
@media(max-width:600px) {
  .warning {
    align-items: center;
  }
  .warning-text {
    font-size: 20px !important;
  }
}

/* Стиль для иконки-инфо с высоким z-index */
#infoIcon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  cursor: pointer;
  background: #4CAF50;
  color: #fff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  font-size: 24px;
  display: none;
}
#tooltip {
  position: absolute;
  padding: 8px 12px;
  background: #333;
  color: #fff;
  border-radius: 8px;
  font-size: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  display: none;
  z-index: 10000;
  max-width: 300px;
  word-wrap: break-word;
}

/* Добавлены стили для иконок Yes и No */
.copied-table td.icon-yes {
  text-align: center;
}
.copied-table td.icon-no {
  text-align: center;
}
.icon-yes {
  color: green;
  font-size: 22px;
}
.icon-no {
  color: red;
  font-size: 22px;
}
/* Стили для контейнера маркированного списка */
#listContainer {
  max-width: 700px;
  margin: 20px auto;
  padding: 20px;
  background: var(--section-bg);
  border-radius: 16px;
  box-shadow: 0 16px 32px var(--shadow);
}
.list-block {
  margin-bottom: 25px;
  padding: 15px;
  border: 1px solid var(--border-color);
  border-radius: 12px;
}
.list-block-header {
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 18px;
}
/* Стили для блока подсказок */
#styleHints {
  margin-top: 20px;
  padding: 15px;
  background: var(--section-bg);
  border-radius: 10px;
  font-family: Arial, sans-serif;
  font-size: 16px;
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

#styleHints h3 {
  margin-top: 0;
  font-family: 'Montserrat', sans-serif;
  font-size: 22px;
  color: var(--text-color);
}

#styleHints span {
  color: #66bb6a;
  font-weight: 700;
  font-size: 18px;
}

#styleHints code {
  background: var(--bg-color);
  color: var(--text-color);
  padding: 2px 5px;
  border-radius: 3px;
  font-family: monospace;
}
/* Стили для Changelog - обновленные */
#changelogContainer {
  display: none;
  position: fixed;
  top: 120px;
  left: 20px;
  width: 420px;
  max-height: 500px;
  overflow-y: auto;
  background: var(--section-bg);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  z-index: 9999;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  color: var(--text-color);
  border: 1px solid var(--border-color);
  transition: opacity 0.3s ease, transform 0.3s ease;
  opacity: 0;
  transform: translateY(-10px);
}

#changelogContainer.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

#changelogContainer h4 {
  margin-top: 0;
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
  border-bottom: 2px solid var(--border-color);
  padding-bottom: 8px;
  color: var(--text-color);
}

/* Стиль для каждой записи */
.changelog-entry {
  margin-bottom: 10px;
  padding: 12px 15px;
  background-color: var(--section-bg);
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
}

.changelog-entry:hover {
  background-color: var(--section-bg);
  transform: translateY(-2px);
}

/* Заголовки внутри записи */
.changelog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.changelog-version {
  font-weight: 600;
  font-size: 15px;
  color: var(--text-color);
}

.changelog-date {
  font-size: 15px;
  color: #7f8c8d;
   margin-left: 1px;  
}

.changelog-type {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  color: #fff;
  background-color: #3498db;
}

/* Цвета для типов */
.changelog-type.Добавлено { background-color: #27ae60; }
.changelog-type.Исправлено { background-color: #f39c12; }
.changelog-type.Общее { background-color: #8e44ad; }
/* Стиль для описания в changelog */
.changelog-description {
  margin: 8px 0 0 0;
  padding-left: 20px;
  list-style-type: disc;
}

.changelog-description li {
  margin-bottom: 4px;
  font-size: 13px;
  line-height: 1.4;
  color: var(--text-color);
}

</style>
</head>
<body>

<h1>Оформление текста</h1>

<div class="select-container">
  <label for="formatSelect">Выберите вид оформления:</label>
  <select id="formatSelect">
    <option value="">--Выберите--</option>
    <option value="table">Таблица</option>
    <option value="infoBox">Информационная плашка</option>
    <option value="blocks">Блоки описаний</option>
    <option value="list">Описание с маркированным списком</option>
  </select>
</div>

<div class="tools">

  <!-- Инструменты для таблицы -->
  <div id="section-table" class="tool-section">
    <h2><i class="fas fa-table"></i>Инструменты для таблицы</h2>
    <label>Количество строк:
      <input type="number" min="1" />
    </label>
    <label>Количество столбцов:
      <input type="number" min="1" />
    </label>
  </div>

  <!-- Инструменты для информационной плашки -->
  <div id="section-infoBox" class="tool-section">
    <h2><i class="fas fa-info-circle"></i>Инструменты для информационной плашки</h2>
    <label>Заголовок:
      <input type="text" />
    </label>
    <label>Текст:
      <textarea rows="4"></textarea>
    </label>
  </div>

  <!-- Инструменты для блоков описаний -->
  <div id="section-blocks" class="tool-section">
    <h2><i class="fas fa-th-large"></i>Инструменты для блоков описаний</h2>
    <label>Количество блоков:
      <input type="number" min="1" />
    </label>
  </div>
  
  <!-- Инструменты для маркированного списка -->
  <div id="section-list" class="tool-section">
    <h2><i class="fas fa-list"></i>Инструменты для маркированного списка</h2>
    <label>Количество пунктов:
      <input type="number" min="1" />
    </label>
  </div>

</div>
<!-- Кнопка Changelog -->
<div style="position: fixed; top: 60px; left: 20px; z-index: 999;">
  <button id="changelogToggle"
          style="background: var(--primary-gradient); 
           color: #fff; 
           border: none; 
           border-radius: 8px; 
           padding: 12px 20px; 
           cursor: pointer; 
           font-weight: 600;
           box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
           transition: background-color 0.3s, transform 0.2s;">
    <i class="fas fa-history"></i> Changelog
  </button>
</div>

<!-- Контейнер для Changelog -->
<!-- Контейнер для Changelog -->
<div id="changelogContainer">
  <h4>История изменений</h4>
  <div id="changelogContent"></div>
</div>
<!-- Переключатель темы -->
<div class="custom-theme-switcher">
  <div id="custom-theme-toggle" style="width: 60px; height: 35px; background: #FFA500; border-radius: 25px; cursor: pointer; display: flex; align-items: center; padding: 0 5px; transition: background 0.5s; position: fixed; top: 20px; right: 20px; z-index: 999;">
    <!-- Иконка луны -->
    <div class="icon-moon" style="position: absolute; left: 10px; font-size: 18px; color: #fff;">
      <i class="fas fa-moon"></i>
    </div>
    <!-- Иконка солнца -->
    <div class="icon-sun" style="position: absolute; right: 10px; font-size: 18px; color: #fff;">
      <i class="fas fa-sun"></i>
    </div>
    <!-- бегунок -->
    <div class="knob" style="position: absolute; top: 3px; width: 30px; height: 30px; background: white; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.3); transition: all 0.5s ease; left: 5px;"></div>
  </div>
</div>
<!-- назад на главную - ВЕРХ -->
<div style="position: fixed; top: 10px; left: 20px; z-index: 999;">
  <button class="back-btn-top" onclick="window.open('index.html', '_self')" style="top: 10px;">
     <i class="fas fa-home"></i>
    </button>
</div>
<!-- Кнопка инструкции -->
<button class="instruction-btn" id="instructionBtn" style="background: #f44336 !important;"></button>

<!-- Модальное окно инструкции -->
<div id="instructionModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" id="closeModal">
      <i class="fas fa-times"></i>
    </button>
    <h3 class="modal-header"><i class="fas fa-question-circle"></i> Инструкция по использованию</h3>
    <div class="modal-body">
      <h4><i class="fas fa-check-circle"></i> Основные возможности:</h4>
      <ul>
        <li><strong>Таблица</strong> - создание и редактирование таблиц</li>
        <li><strong>Информационная плашка</strong> - выделение важной информации</li>
        <li><strong>Блоки описаний</strong> - структурированное описание с раскрывающимися секциями</li>
        <li><strong>Описание с маркированным списком</strong> - форматирование списков характеристик</li>
      </ul>
      <h3 class="modal-header"><i class="fas fa-table"></i> Таблица</h3>
      <ul>
        <li>Выберите в селекторе режим <strong>Таблица</strong></li>
        <li>С помощью <strong>кнопок на верхней панели</strong> можно добавлять новые строки снизу и новые столбцы справа. Также есть возможность удалить строку снизу и столбец справа</li>
        <li><strong>Первый столбец</strong> автоматически форматируется при копировании жирным выделением</li>
        <li>Чтобы получить в таблице значок <i class="fas fa-check-circle icon-yes"></i>, поставьте в ячейке <strong style="font-size: 30px;">+</strong>. При копировании стиль наложится автоматически. </li>
        <li>Чтобы получить в таблице значок <i class="fas fa-times-circle icon-no"></i>, поставьте в ячейке <strong style="font-size: 30px;">-</strong>. При копировании стиль наложится автоматически. </li>
        <li>Нажмите кнопку <strong>Копировать</strong> - код скопируется в буфер обмена. Вставьте код в описание карточки под режимом <strong>Источник</strong></li>
      </ul>
      <h4><i class="fas fa-keyboard"></i> Горячие клавиши для таблицы:</h4>
      <ul>
        <li><strong>Ctrl+Enter</strong> - новая строка</li>
        <li><strong>Ctrl+i</strong> - новый столбец</li>
        <li><strong>Ctrl+Delete</strong> - удаление строки</li>
        <li><strong>Ctrl+Backspace</strong> - удаление столбца</li>
      </ul>
      <h3 class="modal-header"><i class="fas fa-info-circle"></i> Информационная плашка</h3>
      <ul>
        <li>Выберите в селекторе режим <strong>Информационная плашка</strong></li>
        <li>Введите текст в поле на странице. Ниже будет отображаться предпросмотр</li>
        <li>Под полем предпросмотра есть подсказки по адаптации HTML кода после копирования, если нужно изменить внешний вид текста</li>
        <li>Нажмите кнопку <strong>Копировать</strong> - код скопируется в буфер обмена. Вставьте код в описание карточки под режимом <strong>Источник</strong></li>
      </ul>
      <h3 class="modal-header"><i class="fas fa-align-left"></i> Блоки описаний</h3>
      <ul>
        <li>Выберите в селекторе режим <strong>Блоки описаний</strong></li>
        <li>Автоматически на странице появляется одно поле для ввода текста. </br> Для увеличения количества блоков нажмите кнопку <strong>Добавить блок</strong>.</br> Для удаления лишнего блока нажмите кнопку <strong>Удалить блок</strong> (кнопка появляется, если на странице больше одного блока).</li>
        <li>У каждого блока есть инструменты для форматирования текста. форматирование учитывается при копировании</li>
        <li>Каждый блок после копирования будет отдельной сворачиваемой секцией. Нажав на кнопку <strong>Показать предпросмотр</strong>, вы увидите готовый вид на странице.</li>
        <li>Нажмите кнопку <strong>Копировать</strong> - код скопируется в буфер обмена. Вставьте код в описание карточки под режимом <strong>Источник</strong></li>
      </ul>
      <h3 class="modal-header"><i class="fas fa-list-ul"></i> Описание с маркированным списком</h3>
      <ul>
        <li>Выберите в селекторе режим <strong>Описание с маркированным списком</strong></li>
        <li>У вас на странице появится три блока для ввода текста. У каждого блока есть свои инструменты для форматирования текста.</li>
        <li><strong>Заголовок:</strong> после копирования станет зелёным полем с крупным текстом.</li>
        <li><strong>Описание:</strong> после копирования станет отдельным блоком текста с заданным форматированием.</li>
        <li><strong>Маркированный список:</strong> после копирования станет отдельным блоком, в шапке которого будет надпись "Характеристики", а каждая новая строка будет пунктом маркированного списка. 
         </br>Каждая новая строка <strong>автоматически</strong> при копировании становится пунктом маркированного списка.
         </br>Чтобы сделать подпункт, нажмите на кнопку <strong>Маркировки списка</strong> в шапке форматирования текста и примените маркировку для строк, которые вы хотите сделать подпунктами.</li>
          <li>Нажав на кнопку <strong>Показать предпросмотр</strong>, вы увидите готовый вид на странице.</li>
      <li>Нажмите кнопку <strong>Копировать</strong> - код скопируется в буфер обмена. Вставьте код в описание карточки под режимом <strong>Источник</strong></li>
      </ul>
      <h3 class="modal-header"><i class="fas fa-cogs"></i> Дополнительные возможности</h3>
      <ol>
        <li><strong>Тёмная тема:</strong> переключатель в правом верхнем углу страницы, выбор темы сохраняется</li>
        <li><strong>Инструкция:</strong> читаете сейчас, описаны все основные функции</li>
        <li><strong>Changelog:</strong> описаны все изменения и нововведения</li>
        <li><strong>Обратная связь:</strong> можно сообщить о баге или высказать пожелания по улучшению сайта</li>
      </ol>
    </div>
  </div>
</div>
<!-- Блоки описаний -->
<div id="descriptionBlocksContainer" style="display:none; max-width: 600px; margin: 20px auto;">
  <h2>Блоки описаний</h2>
  <div id="blocksContainer"></div>
  <div style="margin-top: 10px; display: flex; gap: 10px;">
    <button id="addBlockBtn"><i class="fas fa-plus"></i> Добавить блок</button>
    <button id="removeBlockBtn" style="display:none;"><i class="fas fa-trash"></i> Удалить блок</button>
  </div>
  </div>

<!-- Новая секция для информационной плашки -->
<div id="infoBoxContainer" class="">
  <h2>Настройка информационной плашки</h2>
  <label>Текст для плашки:
    <textarea id="infoText" rows="4" placeholder="Введите текст"></textarea>
  </label>
  <div id="infoPreview" class="">
    <div class="warning-text" id="previewText">⚠️ Вводимый текст</div>
  </div>
  <!-- Блок подсказок -->
 <div id="styleHints">
    <h3 style="margin-top:0; font-family: 'Montserrat', sans-serif;font-size: 22px;">Подсказки по стилям текста</h3>
    <ul style="margin:0; padding-left:20px; list-style-type: disc;">
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Размер шрифта:</span> измените свойство <code>font-size</code> в стиле <code>.warning-text</code>.</li>
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Цвет текста:</span> поменяйте <code>color</code> в стиле <code>.warning-text</code>.</li>
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Положение блока:</span> используйте <code>margin</code> для изменения расположения блока <code>.warning</code> относительно страницы: <ul> 
        <li><code>margin: 0 auto </code>- горизонтальное выравнивание по центру</li> 
        <li><code>margin-left: 50px; </code> - сдвиг вправо на 50px</li> 
        <li><code>margin-left: -50px;</code> - сдвиг влево на 50px</li> 
        <li><code>margin: 10px 20px 30px 40px;</code> - заданные отступы сверху, справа, снизу, слева</li></ul></li>
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Положения текста внутри блока:</span> используйте <code>padding</code> в стиле <code>.warning-text</code>, чтобы увеличить или уменьшить отступы относительно краев поля:<ul>
        <li><code> padding-left: 10px;</code> - отступ слева</li> 
        <li> <code>padding-right: 10px;</code> - отступ справа</li> 
      </ul></li>
        <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Положения текста внутри блока:</span> используйте <code>margin</code> в стиле <code>.warning-text</code>, чтобы сместить текст внутри блока:<ul>
        <li><code>  margin-left: 20px;</code> - сдвиг вправо на 20px</li> 
        <li> <code>margin-left: -10px;</code> - сдвиг влево на 10px</li>
        <li><code>margin-top: 10px</code> - отступ сверху</li>
        <li><code>margin-bottom: 10px;</code> - отступ снизу</li> </ul> </li>
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Максимальная ширина блока:</span> используйте <code>max-width</code> в <code>.warning</code>, чтобы увеличить или уменьшить максимальную ширину блока</li>
      <li><span style="color: #4CAF50; font-weight: 700;font-size: 18px;">Толщина шрифта:</span> задавайте через свойство <code>font-weight</code> в стиле <code>.warning-text</code>: значение от 100 до 800, где 800 - самое жирное выделение</li>
    </ul>
  </div>
</div>

<!-- Интерактивная таблица -->
<div id="tableContainer" style="display:none; max-width: 800px; margin: 20px auto;">
  <h2><i class="fas fa-table"></i>Интерактивная таблица</h2>
  <div style="margin-bottom: 10px; display:flex; gap:10px;">
    <button id="addRowBtn"><i class="fas fa-plus"></i> Добавить строку</button>
    <button id="removeRowBtn"><i class="fas fa-minus"></i> Удалить строку</button>
    <button id="addColBtn"><i class="fas fa-plus"></i> Добавить столбец</button>
    <button id="removeColBtn"><i class="fas fa-minus"></i> Удалить столбец</button>
  </div>
  <div style="overflow-x:auto;">
    <table id="interactiveTable" style="width:100%; border-collapse:collapse; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1);">
      <thead>
        <tr></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<!-- Секция для маркированного списка -->
<div id="listContainer" style="display:none;">
  <h2><i class="fas fa-list"></i>Описание с маркированным списком</h2>
  <div id="listBlocksContainer"></div>
</div>

<!-- Кнопка копировать -->
<div style="text-align:center; margin-top:50px;">
  <button id="copyBtn"><i class="fas fa-copy"></i> Копировать</button>
</div>

<!-- Футер -->
<div id="footer">
  <span>Создатель сайта: An_Isu &copy; 2025</span>
</div>

<!-- Иконка информации -->
<div id="infoIcon">
  <i class="fas fa-info-circle"></i>
</div>

<!-- Всплывающая подсказка -->
<div id="tooltip"></div>

<!-- Уведомление -->
<div id="notification"></div>
<!-- Кнопка для предпросмотра -->
<div style="text-align:center; margin-top:20px;">
  <button id="showPreviewBtn"><i class="fas fa-eye"></i> Показать предпросмотр</button>
</div>

<!-- Блок предпросмотра -->
<div id="previewContainer" style="display:none; max-width: 700px; margin: 20px auto; padding: 15px; background:#f0f0f0; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
  <h3 style="margin-top:0; color:#333;">Предпросмотр блоков</h3>
  <div id="previewContent"></div>
</div>
<!-- Кнопка обратной связи -->
<button id="feedbackBtn" style="
  position: fixed;
  top: 8px;
  left: 130px; /* 250px (инструкция) + 60px (расстояние) */
  z-index: 999;
  background: #f44336; 
  color: #fff; 
  border: none; 
  border-radius: 50%; 
  width: 40px; 
  height: 40px; 
  cursor: pointer; 
  box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  padding: 0;
  margin: 0;
  line-height: 1;
  text-align: center;
">
  <i class="fas fa-comment" style="font-size:24px; margin: 0;"></i>
</button>

<!-- Всплывающее окно для обратной связи -->
<div id="feedbackModal" class="modal">
  <div class="modal-content" style="max-width:500px; padding:20px; position:relative;">
    <button class="modal-close" id="closeFeedback" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer;">
      <i class="fas fa-times"></i>
    </button>
    <h3 style="margin-top:0;">Обратная связь</h3>
    <div style="margin-bottom:15px;">
      <button id="reportBugBtn" style="background:#f44336; color:#fff; border:none; padding:10px 15px; border-radius:6px; cursor:pointer; margin-right:10px;">Сообщить о баге</button>
      <button id="wishBtn" style="background:#4CAF50; color:#fff; border:none; padding:10px 15px; border-radius:6px; cursor:pointer;">Пожелание</button>
    </div>
    <div id="feedbackForm" style="display:none;">
      <p id="feedbackPrompt" style="margin-bottom:10px; font-weight:600;">Опишите проблему / что можно улучшить</p>
      <textarea id="feedbackInput" rows="4" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-color); resize:none;" placeholder="Введите текст..."></textarea>
      <div style="margin-top:10px; display:flex; justify-content:flex-end; gap:10px;">
        <button id="sendFeedbackBtn" style="background:#2196F3; color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">Отправить</button>
        <button id="cancelFeedbackBtn" style="background:#ccc; color:#000; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">Отмена</button>
      </div>
    </div>
  </div>
</div>

<script>
const select = document.getElementById('formatSelect');
const sections = {
  'table': document.getElementById('section-table'),
  'infoBox': document.getElementById('section-infoBox'),
  'blocks': document.getElementById('section-blocks'),
  'list': document.getElementById('section-list')
};

const infoBox = document.getElementById('infoBoxContainer');
const infoTextArea = document.getElementById('infoText');
const previewText = document.getElementById('previewText');

const descriptionBlocksContainer = document.getElementById('descriptionBlocksContainer');
const blocksContainer = document.getElementById('blocksContainer');
const addBlockBtn = document.getElementById('addBlockBtn');
const removeBlockBtn = document.getElementById('removeBlockBtn');

// Новые переменные для режима маркированного списка
const listContainer = document.getElementById('listContainer');
const listBlocksContainer = document.getElementById('listBlocksContainer');

let quillEditors = []; // массив для редакторов блоков
let listQuillEditors = []; // массив для редакторов маркированного списка

select.addEventListener('change', () => {
  for (let key in sections) {
    sections[key].classList.remove('active');
  }
  const val = select.value;
  if (sections[val]) {
    sections[val].classList.add('active');
  }
  
  // Сначала скрываем все контейнеры
  document.getElementById('descriptionBlocksContainer').style.display = 'none';
  document.getElementById('listContainer').style.display = 'none';
  document.getElementById('tableContainer').style.display = 'none';
  document.getElementById('infoIcon').style.display = 'none';
  
  // Затем показываем только нужный контейнер
  if (val === 'blocks') {
    document.getElementById('descriptionBlocksContainer').style.display = 'block';
    showPreviewBtn.style.display = 'inline-block';
    previewContainer.style.display = 'none';
    if (quillEditors.length === 0) {
      addNewBlock();
    }
  } else if (val === 'list') {
    document.getElementById('listContainer').style.display = 'block';
    showPreviewBtn.style.display = 'inline-block';
    previewContainer.style.display = 'none';
    if (listQuillEditors.length === 0) {
      initListBlocks();
    }
  } else if (val === 'table') {
    document.getElementById('tableContainer').style.display = 'block';
    document.getElementById('infoIcon').style.display = 'flex';
    showPreviewBtn.style.display = 'none';
    previewContainer.style.display = 'none';
    if (!table.dataset.initialized) {
      initTable();
      table.dataset.initialized = 'true';
    }
  } else {
      if (val === 'blocks' || val === 'list') {
    showPreviewBtn.style.display = 'inline-block';
    previewContainer.style.display = 'none';
  } else {
    // Для всех остальных режимов скрываем кнопку и предпросмотр
    showPreviewBtn.style.display = 'none';
    previewContainer.style.display = 'none';
  }
  }
  
  // Управление infoBox
  if (val === 'infoBox') {
    infoBox.classList.add('active');
  } else {
    infoBox.classList.remove('active');
  }
});

// Обновляем содержимое превью при вводе текста в информационной плашке
infoTextArea.addEventListener('input', () => {
  const text = infoTextArea.value;
  document.getElementById('previewText').innerHTML = `
    <div class="warning">
      <div class="warning-text">⚠️ ${text}</div>
    </div>
  `;
});

// Таблица и управление ею
const tableContainer = document.getElementById('tableContainer');
const table = document.getElementById('interactiveTable');
const theadRow = table.querySelector('thead tr');
const tbody = table.querySelector('tbody');

const addRowBtn = document.getElementById('addRowBtn');
const removeRowBtn = document.getElementById('removeRowBtn');
const addColBtn = document.getElementById('addColBtn');
const removeColBtn = document.getElementById('removeColBtn');

let colCount = 5;
let rowCount = 3;
let selectedCell = null;

// Инициализация таблицы
function initTable() {
  for (let i = 0; i < colCount; i++) {
    const th = document.createElement('th');
    th.contentEditable = true;
    th.innerText = `Колонка ${i + 1}`;
    th.onclick = () => selectCell(th);
    theadRow.appendChild(th);
  }
  for (let i = 0; i < rowCount; i++) {
    const tr = document.createElement('tr');
    for (let j = 0; j < colCount; j++) {
      const td = document.createElement('td');
      td.contentEditable = true;
      td.innerText = `Ячейка ${i + 1}-${j + 1}`;
      if (j === 0) td.classList.add('product-name');
      td.onclick = () => selectCell(td);
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
}

function selectCell(cell) {
  if (selectedCell) selectedCell.classList.remove('selected');
  selectedCell = cell;
  selectedCell.classList.add('selected');
  selectedCell.focus();
}

document.getElementById('addRowBtn').onclick = () => {
  addRow();
};
document.getElementById('addColBtn').onclick = () => {
  addColumn();
};
document.getElementById('removeRowBtn').onclick = () => {
  removeLastRow();
};
document.getElementById('removeColBtn').onclick = () => {
  removeLastColumn();
};

function addRow() {
  const newRow = document.createElement('tr');
  for (let i = 0; i < colCount; i++) {
    const td = document.createElement('td');
    td.contentEditable = true;
    td.innerText = `Ячейка ${tbody.children.length + 1}-${i + 1}`;
    if (i === 0) td.classList.add('product-name');
    td.onclick = () => selectCell(td);
    newRow.appendChild(td);
  }
  tbody.appendChild(newRow);
  rowCount++;
}
function addColumn() {
  const headerRow = document.querySelector('#interactiveTable thead tr');
  const colIndex = headerRow.children.length;
  const newHeader = document.createElement('th');
  newHeader.contentEditable = true;
  newHeader.innerText = `Заголовок ${colIndex + 1}`;
  newHeader.onclick = () => selectCell(newHeader);
  headerRow.appendChild(newHeader);
  Array.from(tbody.children).forEach((tr, index) => {
    const newTd = document.createElement('td');
    newTd.contentEditable = true;
    newTd.innerText = `Ячейка ${index + 1}-${colIndex + 1}`;
    if (0 === 0) newTd.classList.add('product-name');
    newTd.onclick = () => selectCell(newTd);
    tr.appendChild(newTd);
  });
  colCount++;
}
function removeLastRow() {
  if (tbody.children.length > 0) {
    tbody.removeChild(tbody.lastElementChild);
    rowCount--;
  }
}
function removeLastColumn() {
  const headerRow = document.querySelector('#interactiveTable thead tr');
  if (headerRow.children.length > 0) {
    const lastIndex = headerRow.children.length -1;
    headerRow.removeChild(headerRow.children[lastIndex]);
    Array.from(tbody.children).forEach((row) => {
      if (row.children[lastIndex]) row.children[lastIndex].remove();
    });
    colCount--;
  }
}

document.addEventListener('keydown', (e) => {
  if (!selectedCell) return;
  if (e.key === 'Delete' && e.ctrlKey) {
    deleteRow();
    e.preventDefault();
  } else if (e.key === 'Backspace' && e.ctrlKey) {
    deleteColumn();
    e.preventDefault();
  } else if (e.key === 'Enter' && e.ctrlKey) {
    addRow();
    e.preventDefault();
  } else if (e.key === 'i' && e.ctrlKey) {
    addColumn();
    e.preventDefault();
  }
});

function deleteRow() {
  if (!selectedCell) return;
  const row = selectedCell.closest('tr');
  if (row) {
    row.remove();
    selectedCell = null;
  }
}
function deleteColumn() {
  if (!selectedCell) return;
  const cellIndex = Array.prototype.indexOf.call(selectedCell.parentElement.children, selectedCell);
  const table = selectedCell.closest('table');
  if (table) {
    Array.from(table.rows).forEach((row) => {
      if (row.children.length > cellIndex) row.deleteCell(cellIndex);
    });
    selectedCell = null;
  }
}

// Обработка режима информационной плашки и копирования
const infoIcon = document.getElementById('infoIcon');
const tooltip = document.getElementById('tooltip');

infoIcon.addEventListener('mouseenter', (e) => {
  const rect = infoIcon.getBoundingClientRect();
  const message = `
<ul style="margin:0; padding-left:20px; list-style-type: disc; font-family:'Montserrat', sans-serif; font-size:14px;">
  <li><strong>Ctrl+Enter</strong> — новая строка</li>
  <li><strong>Ctrl+i</strong> — новый столбец</li>
  <li><strong>Ctrl+Delete</strong> — удаление строки с выбранной ячейкой</li>
  <li><strong>Ctrl+Backspace</strong> — удаление столбца с выбранной ячейкой</li>
  <li><strong>Плюс в ячейке</strong> — преобразуется в "галочку"</li>
  <li><strong>Минус в ячейке</strong> — преобразуется в "крестик"</li>
</ul>`;
  tooltip.innerHTML = message;
  tooltip.style.display = 'block';
  tooltip.style.width = '250px'; // чуть больше, чтобы вместить список
  tooltip.style.height = 'auto';
  tooltip.style.visibility = 'hidden';

  const tooltipWidth = tooltip.offsetWidth;
  const tooltipHeight = tooltip.offsetHeight;
  const scrollX = window.scrollX;
  const scrollY = window.scrollY;

  let top = rect.top + scrollY - tooltipHeight - 8;
  if (top < scrollY) top = rect.bottom + scrollY + 8;
  let left = rect.left + scrollX + (rect.width - tooltipWidth) / 2;
  if (left < scrollX + 50) left = scrollX + 20;
  else if (left + tooltipWidth > scrollX + window.innerWidth - 20) left = scrollX + window.innerWidth - tooltipWidth - 20;

  tooltip.style.top = top + 'px';
  tooltip.style.left = left + 'px';
  tooltip.style.visibility = 'visible';
});

document.addEventListener('mousemove', (e) => {
  const tooltipEl = document.getElementById('tooltip');
  if (!tooltipEl || tooltipEl.style.display !== 'block') return;
  const tooltipWidth = tooltipEl.offsetWidth;
  const tooltipHeight = tooltipEl.offsetHeight;
  const rect = infoIcon.getBoundingClientRect();
  const scrollX = window.scrollX;
  const scrollY = window.scrollY;
  let top = rect.top + scrollY - tooltipHeight - 8;
  if (top < scrollY) top = rect.bottom + scrollY + 8;
  let left = rect.left + scrollX + (rect.width - tooltipWidth) / 2;
  if (left < scrollX) left = scrollX;
  if (left + tooltipWidth > scrollX + window.innerWidth) left = scrollX + window.innerWidth - tooltipWidth;
  tooltip.style.top = top + 'px';
  tooltip.style.left = left + 'px';
});

document.querySelector('#infoIcon').addEventListener('mouseleave', () => {
  document.getElementById('tooltip').style.display = 'none';
});

// Обработка копирования для режима "информационная плашка" и "таблица"
const copyBtn = document.getElementById('copyBtn');
copyBtn.onclick = () => {
  const mode = document.getElementById('formatSelect').value;
    if (mode === 'table') {
    // Клонируем таблицу
    const table = document.getElementById('interactiveTable');
    const tableHtml = table.outerHTML;

    const styles = `
<style type="text/css">
/* Стили для таблицы с классом .copied-table */
.my-custom-section .copied-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  background: #fff;
  font-family: 'Montserrat', sans-serif;
}
.my-custom-section .copied-table thead {
  background: linear-gradient(135deg, #66bb6a, #43a047);
  color: #fff;
}
.my-custom-section .copied-table thead th {
  padding: 16px;
  font-size: 15px;
  text-align: center;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  font-weight: 600;
}
.my-custom-section .copied-table tbody tr {
  transition: all 0.3s ease;
}
.my-custom-section .copied-table tbody tr:nth-child(even) {
  background-color: #f9fafb;
}
.my-custom-section .copied-table tbody tr:nth-child(odd) {
  background-color: #ffffff;
}
.my-custom-section .copied-table tbody tr:hover {
  background-color: #dcedc8;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  transform: translateY(-2px);
}
.my-custom-section .copied-table td, .my-custom-section .copied-table th {
  padding: 14px 12px;
  font-size: 15px;
  border: none;
  vertical-align: middle;
}
.my-custom-section .copied-table td.product-name {
  text-align: left;
  font-weight: 600;
  color: #37474f;
}
/* Иконки для ячеек "+" и "-" */
.my-custom-section .copied-table td.icon-yes {
  text-align: center;
}
.my-custom-section .copied-table td.icon-no {
  text-align: center;
}
.my-custom-section td.icon-yes, .my-custom-section td.icon-no {
  text-align: center;
  font-size: 22px;
}
.my-custom-section .icon-yes::before {
  content: "✔";
  color: #2e7d32;
  font-size: 22px;
  display: inline-block;
}
.my-custom-section .icon-no::before {
  content: "✘";
  color: #c62828;
  font-size: 22px;
  display: inline-block;
}
</style>
`;

    // Клонируем таблицу и назначаем класс
    const tableWithClass = table.cloneNode(true);
    tableWithClass.className = 'copied-table';

    // Обработка ячеек "+" и "-"
    Array.from(tableWithClass.querySelectorAll('td')).forEach(td => {
      const cellText = td.innerText.trim();
      if (cellText === '+') {
        td.innerHTML = '<i class="fas fa-check-circle icon-yes"></i>';
        td.className = '';
      } else if (cellText === '-') {
        td.innerHTML = '<i class="fas fa-times-circle icon-no"></i>';
        td.className = '';
      }
    });

    const tableContent = tableWithClass.outerHTML;

    // Обертываем в my-custom-section
    const fullHtml = styles + `<div class="my-custom-section">${tableContent}</div>`;

    if (navigator.clipboard) {
      navigator.clipboard.writeText(fullHtml).then(() => {
        alert('Таблица с стилями скопирована в буфер обмена!');
      }).catch(() => {
        fallbackCopy(fullHtml);
      });
    } else {
      fallbackCopy(fullHtml);
    }

    } else if (mode === 'blocks') {
      // Собираем все блоки редакторов
      const blocks = quillEditors;
      let resultHtml = '';

      resultHtml += `<div class="my-custom-section">`;

      blocks.forEach((quill, index) => {
        const content = quill.quill ? quill.quill.root.innerHTML : 'Нет текста';
        resultHtml += `
        <div class="card">
          <input type="checkbox" id="toggle-${index}" />
          <label for="toggle-${index}" class="toggle-label">Блок ${index + 1}</label>
          <div class="toggle-content">
            <div class="special-paragraph">${content}</div>
          </div>
        </div>`;
      });

      resultHtml += `</div>`;

      const styles = `
<style type="text/css">/* Стиль для блока .card */
  .my-custom-section {
    padding: 10px 10px;
    max-width: 950px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  /* Заголовки секций */
  .my-custom-section .section-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 16px;
    position: relative;
    display: inline-block;
    padding-bottom: 8px;
    color: #2d7f1b;
  }

  .my-custom-section .section-title::after {
    content: "";
    display: block;
    width: 60px;
    height: 4px;
    margin: 8px auto 0;
    border-radius: 2px;
    background: linear-gradient(90deg, #2d7f1b, #2575fc);
  }

    .my-custom-section .special-paragraph {
    font-size: 16px;
    text-align: start;
  }

  /* Карточки */
  .my-custom-section .card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    padding: 5px 30px;
    margin: 10px auto;
    max-width: 1000px;
    transition:
      box-shadow 0.3s,
      transform 0.3s;
  }

  .my-custom-section .card:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    transform: translateY(-4px);
  }

  /* Стиль для заголовка-активатора */
  .my-custom-section .toggle-label {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 1px;
    position: relative;
    display: block;
    padding-bottom: 5px;
    color: #2d7f1b;
    cursor: pointer;
    user-select: none;
    text-align: center;
    margin-top: 10px;
  }

  .my-custom-section .toggle-label::after {
    content: "";
    display: block;
    width: 65px;
    height: 4px;
    margin: 10px auto 0;
    border-radius: 20px;
    background: #2d7f1b;
  }

  /* Скрытый чекбокс */
  .my-custom-section input[type="checkbox"] {
    display: none;
  }

  /* Контейнер для содержимого, скрытого по умолчанию */
  .my-custom-section .toggle-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    padding-right: 25px;
  }

  /* Раскрытие содержимого при выбранном чекбоксе */
  .my-custom-section input[type="checkbox"]:checked + .toggle-label + .toggle-content {
    max-height: 2000px; /* достаточно большое значение */
    transition: max-height 0.5s ease-in;
  }

  .my-custom-section ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  .my-custom-section li {
    position: relative;
    padding-left: 15px;
    margin-bottom: 16px;
    font-size: 16px;
    line-height: 1.2;
    color: #555;
    text-align: start;
  }

  .my-custom-section li::before {
    content: "•";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 22px;
    color: #2d7f1b;
  }

  .my-custom-section .special-paragraph {
    font-size: 16px;
  }

  /* Адаптация для мобильных устройств */
  @media (max-width: 600px) {
    /* Уменьшаем размеры шрифтов */
    .my-custom-section .section-title {
      font-size: 18px;
    }
    .my-custom-section .info-block strong {
      font-size: 16px;
    }
    .my-custom-section .special-paragraph {
      font-size: 12px;
    }
    .my-custom-section .section-title {
      font-size: 18px;
    }
    .my-custom-section li {
      font-size: 12px;
    }
    .my-custom-section li::before {
      font-size: 16px;
    }
    /* Стиль для заголовка-активатора */
    .my-custom-section .toggle-label {
      font-size: 18px;
    }
  }
</style>
`;

      // Объединяем и копируем
      const fullHtml = styles + resultHtml;

      if (navigator.clipboard) {
        navigator.clipboard.writeText(fullHtml).then(() => {
          alert('Блоки описаний скопированы в буфер обмена! Можете редактировать заголовки и содержимое.');
        }).catch(() => {
          fallbackCopy(fullHtml);
        });
      } else {
        fallbackCopy(fullHtml);
      }
      
      } else if (mode === 'list') {
    // Копирование для режима маркированного списка
    const headerContent = listQuillEditors.find(item => item.type === 'Заголовок')?.quill.root.innerHTML || '';
    const descriptionContent = listQuillEditors.find(item => item.type === 'Описание')?.quill.root.innerHTML || '';
    const listContent = listQuillEditors.find(item => item.type === 'Маркированный список')?.quill.root.innerHTML || '';

    // Формируем полный HTML для копирования с нужной структурой
    const contentHtml = `
<div class="warning">
  <div class="warning-text" style="text-align: center;">${headerContent}</div>
</div>

<div class="section">
  <p>${descriptionContent}</p>
</div>

<div class="section">
  <h3>Характеристики</h3>
  <ul>
    ${listContent.replace(/<p>(.*?)<\/p>/g, '<li>$1</li>')}
  </ul>
</div>
    `;

    const styles = `
<style type="text/css">
/* Общие стили */
.warning {
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #3b8340, #3b8331);
  padding: 20px 10px;
  margin-bottom: 10px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  transition: box-shadow 1s ease, background 1s ease;
}

.warning:hover {
  box-shadow: 0 6px 25px rgba(0,0,0,0.02);
  background: linear-gradient(135deg, #3b8331, #3b8340);
  transform: translateY(3px);
  transition: box-shadow 0.3s ease, transform 0.3s ease;
}

.warning-text {
  font-size: 28px;
  font-weight: 700;
  color: #fff;
}

/* Остальные стили */
.section {
  transition: box-shadow 0.3s ease, transform 0.3s ease;
  max-width: 950px;
  margin: 0 auto 10px auto;
  background: rgba(255, 255, 255, 0.85);
  padding: 15px;
  border-radius: 30px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.1);
}

.section h3 {
  font-size: 22px;
  margin-top: 3px;
  margin-bottom: 8px;
  color: #34495e;
  border-bottom: 2px solid #bdc3c7;
  padding-bottom: 15px;
}

.section ul {
  list-style: none;
  padding-left: 0;
}

/* Стили для вложенных списков */
.section ul ul {
  list-style: none;
  padding-left: 20px;
  margin-top: 10px;
}

.section ul li {
  position: relative;
  font-size: 16px;
  padding-left: 4px;
  margin-bottom: -10px;
  color: #050505;
}

.section ul li::before {
  content: "•";
  font-weight: 900;
  position: relative;
  left: -3px;
  top: 3.5px;
  transform: translateY(-50%);
  font-size: 26px;
  color: #27ae60;
}

.section ul ul li {
  position: relative;
  padding-left: 20px;
  font-size: 16px;
  margin-bottom: 10px;
  color: #050505;
}

/* Можно добавить свои маркеры для подпунктов */
.section ul ul li::before {
  content: "*";
  position: relative;
  left: -5px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 16px;
  color: #27ae60;
}

.section p {
  font-size: 16px;
  line-height: 1.2;
  color: #050505;
  padding-left: 13px;
}

.section:hover {
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
  transform: translateY(-4px);
}

/* Медиазапрос для мобильных устройств */
@media (max-width:600px) {
  /* Уменьшение шрифтов для мобильных */
  .warning-text {
    font-size: 16px !important;
  }

  .section h3 {
    font-size: 18px !important;
  }

  .section ul li {
    font-size: 12px !important;
    padding-right: 5px;
  }

  .section p {
    font-size: 13px !important;
    text-align: start;
  }

  .section ul li::before {
    content: "•";
    left: -2%;
    padding-right: -15px;
    top: 5px;
  }
}
</style>
 `;
   const fullHtml = styles + `<div class="my-custom-section">${contentHtml}</div>`;

    if (navigator.clipboard) {
      navigator.clipboard.writeText(fullHtml).then(() => {
        alert('Маркированный список с стилями скопирован в буфер обмена!');
      }).catch(() => {
        fallbackCopy(fullHtml);
      });
    } else {
      fallbackCopy(fullHtml);
    }
    
  } else {
      // остальные режимы
      const htmlContent = document.querySelector('#previewText').innerHTML;

      const styles = `
<style>
/* Стили для warning блока, без конфликтов с таблицей */
.custom-section .warning {
  display: flex;
  align-items: flex-start; 
  justify-content: center;
  background: linear-gradient(135deg, #fff0f5, #ffe0ec);
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  max-width: 100%; 
  box-sizing: border-box; 
  margin: 0 auto;
}
.custom-section .warning:hover {
  box-shadow: 0 6px 25px rgba(0,0,0,0.2);
  background: linear-gradient(135deg, #ffe0ec, #fff0f5);
}
.warning-text {
  font-size: 25px;
  font-weight: 700;
  color: #d84315;
}
</style>
`;

      const fullHtml = `
<section class="custom-section">
  ${styles}
  ${htmlContent}
</section>
`;

      if (navigator.clipboard) {
        navigator.clipboard.writeText(fullHtml).then(() => {
          alert('Код скопирован в буфер обмена!');
        }).catch(() => {
          fallbackCopy(fullHtml);
        });
      } else {
        fallbackCopy(fullHtml);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        alert('Копировано в буфер обмена!');
      } catch (err) {
        alert('Ошибка копирования.');
      }
      document.body.removeChild(textarea);
    }
  };
  
  // Обработка для блока "Блоки описаний"
function addNewBlock() {
  // создаем обертку
  const wrapperDiv = document.createElement('div');
  wrapperDiv.className = 'editor-block'; // можно добавить стили, если нужно

  // создаем заголовок
  const header = document.createElement('div');
  header.innerText = `Блок ${quillEditors.length + 1}`;
  header.style.fontWeight = 'bold';
  header.style.marginBottom = '5px';

  // создаем контейнер редактора
  const editorDiv = document.createElement('div');
  editorDiv.style.width = '100%';
  editorDiv.style.height = '120px';
  editorDiv.style.border = '1px solid var(--border-color)';
  editorDiv.style.borderRadius = '12px';
  editorDiv.style.padding = '10px';

  // добавляем все внутрь обертки
  wrapperDiv.appendChild(header);
  wrapperDiv.appendChild(editorDiv);
  blocksContainer.appendChild(wrapperDiv);

  // создаем редактор
  const quill = new Quill(editorDiv, {
    theme: 'snow',
    modules: {
      toolbar: [
        ['bold', 'italic', 'underline', 'strike'],
        ['blockquote', 'code-block'],
        [{ 'header': 1 }, { 'header': 2 }],
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],
        [{ 'indent': '-1'}, { 'indent': '+1' }],
        [{ 'direction': 'rtl' }],
        [{ 'size': ['small', false, 'large', 'huge'] }],
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
        [{ 'color': [] }, { 'background': [] }],
        [{ 'font': [] }],
        [{ 'align': [] }],
        ['clean']
      ]
    }
  });

  // сохраняем редактор и обертку
  quillEditors.push({ quill: quill, wrapper: wrapperDiv });
  updateRemoveButtonVisibility();
}

// Обновляем видимость кнопки удаления
function updateRemoveButtonVisibility() {
   if (quillEditors.length > 1) {
    removeBlockBtn.style.display = 'inline-block';
  } else {
    removeBlockBtn.style.display = 'none';
  }
}

// Обработчик для кнопки добавления блока
addBlockBtn.onclick = () => {
  addNewBlock();
};
// Обработчик для кнопки удаления блока
removeBlockBtn.onclick = () => {
  if (quillEditors.length > 1) {
    const { quill, wrapper } = quillEditors.pop();
    // удаляем весь обертку со всем содержимым
    if (wrapper && wrapper.parentNode) {
      wrapper.parentNode.removeChild(wrapper);
    }
    updateRemoveButtonVisibility();
  }
};

// Изначально при смене режима, если блоки активны, создаем первый редактор
select.addEventListener('change', () => {
  if (val === 'blocks') {
    if (quillEditors.length === 0) {
      addNewBlock();
    }
    // Обновить видимость
    updateRemoveButtonVisibility();
  }
});
const showPreviewBtn = document.getElementById('showPreviewBtn');
const previewContainer = document.getElementById('previewContainer');
const previewContent = document.getElementById('previewContent');

showPreviewBtn.onclick = () => {
  const mode = document.getElementById('formatSelect').value;
  
  if (mode === 'blocks') {
    updateBlocksPreview();
  } else if (mode === 'list') {
    updateListPreview();
  }
  
  // Показываем контейнер
  if (previewContainer.style.display === 'none') {
    previewContainer.style.display = 'block';
  } else {
    previewContainer.style.display = 'none';
  }
};

// Функция обновления содержимого предпросмотра
function updateBlocksPreview() {
  let html = '';

  // Вставляем стили для предпросмотра
  const style = `
  <style>
  /* Весь CSS для блока .card и др., который копируется */
   .my-custom-section {
    padding: 10px 10px;
    max-width: 950px;
    margin: 0 auto;
    box-sizing: border-box;
  }

  /* Заголовки секций */
  .my-custom-section .section-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 16px;
    position: relative;
    display: inline-block;
    padding-bottom: 8px;
    color: #2d7f1b;
  }

  .my-custom-section .section-title::after {
    content: "";
    display: block;
    width: 60px;
    height: 4px;
    margin: 8px auto 0;
    border-radius: 2px;
    background: linear-gradient(90deg, #2d7f1b, #2575fc);
  }

    .my-custom-section .special-paragraph {
    font-size: 16px;
    text-align: start;
  }

  /* Карточки */
  .my-custom-section .card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    padding: 5px 30px;
    margin: 10px auto;
    max-width: 1000px;
    transition:
      box-shadow 0.3s,
      transform 0.3s;
  }

  .my-custom-section .card:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    transform: translateY(-4px);
  }

  /* Стиль для заголовка-активатора */
  .my-custom-section .toggle-label {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 1px;
    position: relative;
    display: block;
    padding-bottom: 5px;
    color: #2d7f1b;
    cursor: pointer;
    user-select: none;
    text-align: center;
    margin-top: 10px;
  }

  .my-custom-section .toggle-label::after {
    content: "";
    display: block;
    width: 65px;
    height: 4px;
    margin: 10px auto 0;
    border-radius: 20px;
    background: #2d7f1b;
  }

  /* Скрытый чекбокс */
  .my-custom-section input[type="checkbox"] {
    display: none;
  }

  /* Контейнер для содержимого, скрытого по умолчанию */
  .my-custom-section .toggle-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    padding-right: 25px;
  }

  /* Раскрытие содержимого при выбранном чекбоксе */
  .my-custom-section input[type="checkbox"]:checked + .toggle-label + .toggle-content {
    max-height: 2000px; /* достаточно большое значение */
    transition: max-height 0.5s ease-in;
  }

  .my-custom-section ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  .my-custom-section li {
    position: relative;
    padding-left: 15px;
    margin-bottom: 16px;
    font-size: 16px;
    line-height: 1.2;
    color: #555;
    text-align: start;
  }

  .my-custom-section li::before {
    content: "•";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 22px;
    color: #2d7f1b;
  }

  .my-custom-section .special-paragraph {
    font-size: 16px;
  }

  /* Адаптация для мобильных устройств */
  @media (max-width: 600px) {
    /* Уменьшаем размеры шрифтов */
    .my-custom-section .section-title {
      font-size: 18px;
    }
    .my-custom-section .info-block strong {
      font-size: 16px;
    }
    .my-custom-section .special-paragraph {
      font-size: 12px;
    }
    .my-custom-section .section-title {
      font-size: 18px;
    }
    .my-custom-section li {
      font-size: 12px;
    }
    .my-custom-section li::before {
      font-size: 16px;
    }
    /* Стиль для заголовка-активатора */
    .my-custom-section .toggle-label {
      font-size: 18px;
    }
  }
  </style>
  `;

    // Обрабатываем каждый блок редактора
  quillEditors.forEach((item, index) => {
    const content = item.quill.root.innerHTML;
    html += `
      <div class="card">
          <input type="checkbox" id="toggle-${index}" />
          <label for="toggle-${index}" class="toggle-label">Блок ${index + 1}</label>
          <div class="toggle-content">
            <div class="special-paragraph">${content}</div>
          </div>
        </div>`;
  });

  // Объединяем стили и содержимое
  previewContent.innerHTML = style + `<div class="my-custom-section">${html}</div>`;
}
//отображение в нудном режиме
// Функционал для режима маркированного списка
function initListBlocks() {
  // Очищаем контейнер
  listBlocksContainer.innerHTML = '';
  listQuillEditors = [];

  // Создаем три блока с редакторами
  const blockTypes = ['Заголовок', 'Описание', 'Маркированный список'];
  
  blockTypes.forEach((type, index) => {
    const blockDiv = document.createElement('div');
    blockDiv.className = 'list-block';
    
    const header = document.createElement('div');
    header.className = 'list-block-header';
    header.innerText = `${type}:`;
    
    const editorDiv = document.createElement('div');
    editorDiv.style.width = '100%';
    editorDiv.style.height = '120px';
    editorDiv.style.border = '1px solid var(--border-color)';
    editorDiv.style.borderRadius = '12px';
    editorDiv.style.padding = '10px';
    
    blockDiv.appendChild(header);
    blockDiv.appendChild(editorDiv);
    listBlocksContainer.appendChild(blockDiv);
    
    // Создаем редактор
    const quill = new Quill(editorDiv, {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          ['blockquote', 'code-block'],
          [{ 'header': 1 }, { 'header': 2 }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'script': 'sub'}, { 'script': 'super' }],
          [{ 'indent': '-1'}, { 'indent': '+1' }],
          [{ 'direction': 'rtl' }],
          [{ 'size': ['small', false, 'large', 'huge'] }],
          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'font': [] }],
          [{ 'align': [] }],
          ['clean']
        ]
      }
    });
    
    listQuillEditors.push({ quill: quill, type: type });
  }); 
}
function updateListPreview() {
  let html = '';

  // Собираем содержимое из всех редакторов
  const headerContent = listQuillEditors.find(item => item.type === 'Заголовок')?.quill.root.innerHTML || '';
  const descriptionContent = listQuillEditors.find(item => item.type === 'Описание')?.quill.root.innerHTML || '';
  const listContent = listQuillEditors.find(item => item.type === 'Маркированный список')?.quill.root.innerHTML || '';

  // Обработка заголовка - добавляем стиль text-align: center
  const headerHtml = `
<div class="warning">
  <div class="warning-text" style="text-align: center;">${headerContent}</div>
</div>
  `;

  // Обработка описания - оборачиваем в <p> и <div class="section">
  const descriptionHtml = `
<div class="section">
  <p>${descriptionContent}</p>
</div>
  `;

  // Обработка маркированного списка - добавляем структуру с h3 и ul
  const listHtml = `
<div class="section">
  <h3>Характеристики</h3>
  <ul>
    ${listContent.replace(/<p>(.*?)<\/p>/g, '<li>$1</li>')}
</ul>
</div>
  `;

  // Объединяем все блоки
  html = headerHtml + descriptionHtml + listHtml;

  // Стили для предпросмотра маркированного списка
  const style = `
  <style type="text/css">/* Общие стили */

.warning {
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #3b8340, #3b8331);
  padding: 20px 10px;
  margin-bottom: 10px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  transition: box-shadow 1s ease, background 1s ease;
}

.warning:hover {
  box-shadow: 0 6px 25px rgba(0,0,0,0.02);
  background: linear-gradient(135deg, #3b8331, #3b8340);
  transform: translateY(3px);
  transition: box-shadow 0.3s ease, transform 0.3s ease;
}

.warning-text {
  font-size: 28px;
  font-weight: 700;
  color: #fff;
}

/* Остальные стили */
.section {
  transition: box-shadow 0.3s ease, transform 0.3s ease;
  max-width: 950px;
  margin: 0 auto 10px auto;
  background: rgba(255, 255, 255, 0.85);
  padding: 15px;
  border-radius: 30px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.1);
}

.section h3 {
  font-size: 22px;
  margin-top: 3px;
  margin-bottom: 8px;
  color: #34495e;
  border-bottom: 2px solid #bdc3c7;
  padding-bottom: 15px;
}

.section ul {
  list-style: none;
  padding-left: 0;
}
/* Стили для вложенных списков */
.section ul ul {
  list-style: none; /* отключить стандартные маркеры */
  padding-left: 20px;
  margin-top: 10px;
}
.section ul li {
  position: relative;
  font-size: 16px;
  padding-left: 4px;
  margin-bottom: -10px;
  color: #050505;
}
.section ul li::before {
  content: "•";
  font-weight: 900;
  position: relative;
  left: -3px;
  top: 3.5px;
  transform: translateY(-50%);
  font-size: 26px;
  color: #27ae60;
}
.section ul ul li {
  position: relative;
  padding-left: 20px;
  font-size: 16px;
  margin-bottom: 10px;
  color: #050505;
}

/* Можно добавить свои маркеры для подпунктов */
.section ul ul li::before {
  content: "*"; /* или любой другой символ */
  position: relative;
  left: -5px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 16px;
  color: #27ae60;
}

.section p {
  font-size: 16px;
  line-height: 1.2;
  color: #050505;
  padding-left: 13px;
}

.section:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      transform: translateY(-4px);
   }
/* Медиазапрос для мобильных устройств */
@media (max-width:600px) {
  /* Уменьшение шрифтов для мобильных */
  .warning-text {
    font-size: 16px !important;
  }

  .section h3 {
    font-size: 18px !important;
  }

  .section ul li {
    font-size: 12px !important;
    padding-right: 5px
  }

  .section p {
    font-size: 13px !important;
    text-align: start
  }
  .section ul li::before {
  content: "•";
  left: -2%;
  padding-right: -15px;
  top: 5px;
}
}
  </style>
  `;

  // Объединяем стили и содержимое
  previewContent.innerHTML = style + `<div class="list-preview-container">${html}</div>`;
}
// Переключатель темы
const customToggle = document.getElementById('custom-theme-toggle');
const knob = customToggle.querySelector('.knob');

// Функция для загрузки сохраненной темы
function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  // По умолчанию светлая тема
  if (savedTheme === 'dark') {
    document.body.classList.add('dark-theme');
    customToggle.style.background = '#555';
    knob.style.transform = 'translateX(30px)';
  } else {
    // Светлая тема по умолчанию
    document.body.classList.remove('dark-theme');
    customToggle.style.background = '#FFA500';
    knob.style.transform = 'translateX(0)';
  }
}

// Функция для сохранения темы
function saveTheme(isDark) {
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
}

// Инициализация темы при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
  loadTheme();
});

customToggle.addEventListener('click', () => {
  const isDark = !document.body.classList.contains('dark-theme');
  document.body.classList.toggle('dark-theme');

  // Обновляем внешний вид переключателя
  if (isDark) {
    customToggle.style.background = '#555';
    knob.style.transform = 'translateX(30px)';
  } else {
    customToggle.style.background = '#FFA500';
    knob.style.transform = 'translateX(0)';
  }
  
  // Сохраняем выбор пользователя
  saveTheme(isDark);
});

// Убедитесь, что переключатель правильно отображает текущее состояние
// Добавьте этот код в DOMContentLoaded для синхронизации
document.addEventListener('DOMContentLoaded', () => {
  // Проверяем начальное состояние
  if (document.body.classList.contains('dark-theme')) {
    customToggle.style.background = '#555';
    knob.style.transform = 'translateX(30px)';
  } else {
    customToggle.style.background = '#FFA500';
    knob.style.transform = 'translateX(0)';
  }
});
// Обработчики для модального окна инструкции
const instructionBtn = document.getElementById('instructionBtn');
const instructionModal = document.getElementById('instructionModal');
const closeModal = document.getElementById('closeModal');

instructionBtn.onclick = () => {
  instructionModal.classList.add('active');
};

closeModal.onclick = () => {
  instructionModal.classList.remove('active');
};

// Закрытие модального окна при клике вне его
instructionModal.addEventListener('click', (e) => {
  if (e.target === instructionModal) {
    instructionModal.classList.remove('active');
  }
});

// Закрытие модального окна по клавише Escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && instructionModal.classList.contains('active')) {
    instructionModal.classList.remove('active');
  }
});
//скрипт баг-баг-репорта
const feedbackBtn = document.getElementById('feedbackBtn');
const feedbackModal = document.getElementById('feedbackModal');
const closeFeedback = document.getElementById('closeFeedback');
const reportBugBtn = document.getElementById('reportBugBtn');
const wishBtn = document.getElementById('wishBtn');
const feedbackForm = document.getElementById('feedbackForm');
const feedbackPrompt = document.getElementById('feedbackPrompt');
const feedbackInput = document.getElementById('feedbackInput');
const sendBtn = document.getElementById('sendFeedbackBtn');
const cancelBtn = document.getElementById('cancelFeedbackBtn');

feedbackBtn.onclick = () => {
  feedbackModal.classList.add('active');
  // Сброс формы
  feedbackForm.style.display = 'none';
  feedbackInput.value = '';
};

closeFeedback.onclick = () => {
  feedbackModal.classList.remove('active');
};

feedbackModal.addEventListener('click', (e) => {
  if (e.target === feedbackModal) {
    feedbackModal.classList.remove('active');
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && feedbackModal.classList.contains('active')) {
    feedbackModal.classList.remove('active');
  }
});

// Выбор типа сообщения
reportBugBtn.onclick = () => {
  feedbackForm.style.display = 'block';
  feedbackPrompt.innerText = 'Опишите проблему';
  feedbackInput.placeholder = 'Опишите проблему или баг';
};

wishBtn.onclick = () => {
  feedbackForm.style.display = 'block';
  feedbackPrompt.innerText = 'Что можно улучшить';
  feedbackInput.placeholder = 'Введите пожелание или предложение';
};

// Отправка формы
sendBtn.onclick = () => {
  const text = feedbackInput.value.trim();
  if (!text) {
    alert('Пожалуйста, введите текст.');
    return;
  }
  // Тут можно отправить данные на сервер или сохранить
  alert('Ваше сообщение отправлено! Благодарим за отзыв.');
  feedbackModal.classList.remove('active');
};

// Отмена
cancelBtn.onclick = () => {
  feedbackModal.classList.remove('active');
};
// Обработка отправки бага
const BUG_REPORT_URL = 'https://script.google.com/macros/s/AKfycbyMukNiNzcTtsmydQQJZeJJpVL3lsI17Oy8h_kDliY4WJybvSDZxM6-MS8GFzniKbuu/exec';
document.getElementById('sendFeedbackBtn').addEventListener('click', () => {
  const description = document.getElementById('feedbackInput').value.trim();
  if (description === '') {
    alert('Пожалуйста, опишите проблему.');
    return;
  }
  // Отправляем POST-запрос
  fetch(BUG_REPORT_URL, {
    method: 'POST',
    contentType: 'application/json',
    body: JSON.stringify({description: description})
  })
  .then(response => response.json())
  .then(data => {
    clearTimeout(spinnerTimeout);
      spinner.style.display = 'none';
    if (data.result === 'success') {
      showNotification('Сообщение успешно отправлено!');
    } else {
      showNotification('Ошибка при отправке сообщения.');
    }
  })
    // Очистка поля
  document.getElementById('bugDescription').value = '';
  
});
// Функция для загрузки changelog из Google Sheets
// Обработчик для кнопки "Changelog"
const changelogBtn = document.getElementById('changelogToggle');
const changelogContainer = document.getElementById('changelogContainer');

changelogBtn.addEventListener('click', () => {
  if (changelogContainer.classList.contains('show')) {
    changelogContainer.classList.remove('show');
  } else {
    loadChangelogFromSheet();
    changelogContainer.classList.add('show');
  }
});

// Функция для загрузки changelog из Google Sheets
// Функция для загрузки changelog из Google Sheets
function loadChangelogFromSheet() {
  const sheetUrl = 'https://docs.google.com/spreadsheets/d/11i0Nwwbw09aJQFNkztrAUfx0G8PXzUfg1sZyjeIKjxQ/gviz/tq?sheet=Лист5';

  fetch(sheetUrl)
    .then(response => response.text())
    .then(text => {
      const jsonData = JSON.parse(text.substring(47).slice(0, -2));
      const rows = jsonData.table.rows;
      let entriesHtml = '';

      function formatDateToDDMMYY(dateStr) {
        const dateMatch = /Date\((\d+),\s*(\d+),\s*(\d+)\)/.exec(dateStr);
        if (dateMatch) {
          let year = parseInt(dateMatch[1], 10);
          let month = parseInt(dateMatch[2], 10);
          let day = parseInt(dateMatch[3], 10);

          month += 1;

          const dd = day.toString().padStart(2, '0');
        const mm = month.toString().padStart(2, '0');
        const yy = (year % 100).toString().padStart(2, '0');

          return `${dd}.${mm}.${yy}`;
        }
        return dateStr;
      }

      rows.forEach(row => {
        const version = row.c[0].v;
        const rawDate = row.c[1].v;
        const date = formatDateToDDMMYY(rawDate);
        const type = row.c[2].v.trim();
        let description = row.c[3].v;

        // Обработка описания - каждая новая строка становится пунктом списка
        const descriptionHtml = description
          .split('\n')
          .map(line => line.trim().startsWith('•') ? `<li>${line.trim()}</li>` : `<li>${line.trim()}</li>`)
          .join('');

        entriesHtml += `
          <div class="changelog-entry">
            <div class="changelog-header">
              <span class="changelog-version">Версия ${version}</span>
              <span class="changelog-date">${date}</span>
              <span class="changelog-type ${type}">${type}</span>
            </div>
            <ul class="changelog-description">${descriptionHtml}</ul>
          </div>`;
      });

      document.getElementById('changelogContent').innerHTML = entriesHtml;
    })
    .catch(() => {
      document.getElementById('changelogContent').innerHTML = 'Не удалось загрузить историю изменений.';
    });
}
// Инициализация при загрузке страницы - скрыть кнопку предпросмотра
document.addEventListener('DOMContentLoaded', () => {
  showPreviewBtn.style.display = 'none';
  previewContainer.style.display = 'none';
});
</script>
</body>
</html>
